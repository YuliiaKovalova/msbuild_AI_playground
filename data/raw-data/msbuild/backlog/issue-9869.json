{
  "number": 9869,
  "title": "[Bug]: Project object can no longer be created if the change wave 17.10 is in use.",
  "body": "### Issue Description\n\nConsider the following code:\r\n```csharp\r\nusing Microsoft.Build.Evaluation;\r\nusing Microsoft.Build.Locator;\r\n\r\ninternal class Program\r\n{\r\n    private static void Main(string[] args)\r\n    {\r\n        Environment.SetEnvironmentVariable(\"MSBUILDDISABLEFEATURESFROMVERSION\", new Version(17, 10).ToString());\r\n        var msbuildDir = GetMSBuildDir();\r\n\r\n        if (string.IsNullOrEmpty(msbuildDir))\r\n        {\r\n            MSBuildLocator.RegisterDefaults();\r\n        }\r\n        else\r\n        {\r\n            MSBuildLocator.RegisterMSBuildPath(msbuildDir);\r\n        }\r\n        Run(SLN_DIR_PATH, SLN_DIR_PATH + CSPROJ_REL_PATH);\r\n    }\r\n\r\n    private static void Run(string slnDirPath, string csprojPath)\r\n    {\r\n        new Project(csprojPath, new Dictionary<string, string>\r\n        {\r\n            [\"SolutionDir\"] = Path.GetDirectoryName(slnDirPath) + \"\\\\\"\r\n        }, null);\r\n    }\r\n\r\n    private static string? GetMSBuildDir()\r\n    {\r\n        var vsInstallDir = Environment.GetEnvironmentVariable(\"VSINSTALLDIR\");\r\n        if (vsInstallDir == null)\r\n        {\r\n            vsInstallDir = Environment.GetEnvironmentVariable(\"VSAPPIDDIR\");\r\n            if (!string.IsNullOrEmpty(vsInstallDir))\r\n            {\r\n                vsInstallDir = Path.GetFullPath(vsInstallDir + \"\\\\..\\\\..\\\\\");\r\n            }\r\n        }\r\n        if (!string.IsNullOrEmpty(vsInstallDir))\r\n        {\r\n            vsInstallDir += \"MSBuild\\\\Current\\\\Bin\\\\\";\r\n        }\r\n\r\n        return vsInstallDir;\r\n    }\r\n}\r\n```\r\nAnd assume `SLN_DIR_PATH + CSPROJ_REL_PATH` point at an existing csproj file with a solution file inside `SLN_DIR_PATH`.\r\n\r\nWhen I run this code - it succeeds. However, if I comment the `MSBUILDDISABLEFEATURESFROMVERSION` line, then it fails with the following exception:\r\n```\r\nMicrosoft.Build.Exceptions.InvalidProjectFileException\r\n  HResult=0x80131500\r\n  Message=The SDK resolver assembly \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Professional\\MSBuild\\Current\\Bin\\SdkResolvers\\Microsoft.DotNet.MSBuildSdkResolver\\Microsoft.DotNet.MSBuildSdkResolver.dll\" could not be loaded. Could not load file or assembly 'Microsoft.DotNet.MSBuildSdkResolver, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified.  C:\\dayforce\\CSTool\\scratch\\scratch.csproj\r\n  Source=Microsoft.Build\r\n  StackTrace:\r\n   at Microsoft.Build.Shared.ProjectFileErrorUtilities.VerifyThrowInvalidProjectFile(Boolean condition, String errorSubCategoryResourceName, BuildEventFileInfo projectFile, Exception innerException, String resourceName, Object[] args)\r\n   at Microsoft.Build.Shared.ProjectFileErrorUtilities.ThrowInvalidProjectFile(BuildEventFileInfo projectFile, Exception innerException, String resourceName, Object[] args)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolvers(String resolverPath, ElementLocation location, List`1 resolvers)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolversFromManifest(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.<>n__0(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.<>c__DisplayClass10_0.<LoadResolversFromManifest>b__0(SdkResolverManifest manifest)\r\n   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.LoadResolversFromManifest(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.GetResolvers(IList`1 resolversManifests, LoggingContext loggingContext, ElementLocation sdkReferenceLocation)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdkUsingResolversWithPatternsFirst(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.<>n__0(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.<>c__DisplayClass3_0.<ResolveSdk>b__2()\r\n   at System.Lazy`1.ViaFactory(LazyThreadSafetyMode mode)\r\n   at System.Lazy`1.ExecutionAndPublication(LazyHelper executionAndPublication, Boolean useDefaultConstructor)\r\n   at System.Lazy`1.CreateValue()\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate()\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion)\r\n   at Program.Run(String slnDirPath, String csprojPath) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 24\r\n   at Program.Main(String[] args) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 19\r\n\r\n  This exception was originally thrown at this call stack:\r\n    System.Reflection.RuntimeAssembly.InternalLoad(System.Reflection.AssemblyName, ref System.Threading.StackCrawlMark, System.Runtime.Loader.AssemblyLoadContext, System.Reflection.RuntimeAssembly, bool)\r\n    System.Reflection.Assembly.Load(System.Reflection.AssemblyName)\r\n    Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolverAssembly(string)\r\n    Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolvers(string, Microsoft.Build.Construction.ElementLocation, System.Collections.Generic.List<Microsoft.Build.Framework.SdkResolver>)\r\n\r\nInner Exception 1:\r\nFileNotFoundException: Could not load file or assembly 'Microsoft.DotNet.MSBuildSdkResolver, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified.\r\n```\r\n\n\n### Steps to Reproduce\n\n[scratch.zip](https://github.com/dotnet/msbuild/files/14607298/scratch.zip)\r\n[msbuild.zip](https://github.com/dotnet/msbuild/files/14607324/msbuild.zip)\r\n\r\nSince the binary log is small and without any secrets, I just renamed `msbuild.binlog` to `msbuild.,zip` and uploaded here.\r\n\r\nTo show the issue pass the 3rd parameter `exp`.\r\n\r\n**Good run**\r\n```\r\nC:\\scratch> .\\bin\\Debug\\net8.0\\scratch.exe . .\\scratch.csproj\r\nC:\\scratch>\r\n```\r\n**Bad run**\r\n```\r\nC:\\scratch> .\\bin\\Debug\\net8.0\\scratch.exe . .\\scratch.csproj exp\r\nUnhandled exception. Microsoft.Build.Exceptions.InvalidProjectFileException: The SDK resolver assembly \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Professional\\MSBuild\\Current\\Bin\\SdkResolvers\\Microsoft.DotNet.MSBuildSdkResolver\\Microsoft.DotNet.MSBuildSdkResolver.dll\" could not be loaded. Could not load file or assembly 'Microsoft.DotNet.MSBuildSdkResolver, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified.  C:\\dayforce\\CSTool\\scratch\\scratch.csproj\r\n ---> System.IO.FileNotFoundException: Could not load file or assembly 'Microsoft.DotNet.MSBuildSdkResolver, Culture=neutral, PublicKeyToken=null'. The system cannot find the file specified.\r\nFile name: 'Microsoft.DotNet.MSBuildSdkResolver, Culture=neutral, PublicKeyToken=null'\r\n   at System.Reflection.RuntimeAssembly.InternalLoad(AssemblyName assemblyName, StackCrawlMark& stackMark, AssemblyLoadContext assemblyLoadContext, RuntimeAssembly requestingAssembly, Boolean throwOnFileNotFound)\r\n   at System.Reflection.Assembly.Load(AssemblyName assemblyRef)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolverAssembly(String resolverPath)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolvers(String resolverPath, ElementLocation location, List`1 resolvers)\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.Shared.ProjectFileErrorUtilities.VerifyThrowInvalidProjectFile(Boolean condition, String errorSubCategoryResourceName, BuildEventFileInfo projectFile, Exception innerException, String resourceName, Object[] args)\r\n   at Microsoft.Build.Shared.ProjectFileErrorUtilities.ThrowInvalidProjectFile(BuildEventFileInfo projectFile, Exception innerException, String resourceName, Object[] args)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolvers(String resolverPath, ElementLocation location, List`1 resolvers)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverLoader.LoadResolversFromManifest(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.<>n__0(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.<>c__DisplayClass10_0.<LoadResolversFromManifest>b__0(SdkResolverManifest manifest)\r\n   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverLoader.LoadResolversFromManifest(SdkResolverManifest manifest, ElementLocation location)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.GetResolvers(IList`1 resolversManifests, LoggingContext loggingContext, ElementLocation sdkReferenceLocation)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdkUsingResolversWithPatternsFirst(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.<>n__0(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.<>c__DisplayClass3_0.<ResolveSdk>b__2()\r\n   at System.Lazy`1.ViaFactory(LazyThreadSafetyMode mode)\r\n   at System.Lazy`1.ExecutionAndPublication(LazyHelper executionAndPublication, Boolean useDefaultConstructor)\r\n   at System.Lazy`1.CreateValue()\r\n   at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate()\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion)\r\n   at Program.Run(String slnDirPath, String csprojPath) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 54\r\n   at Program.Main(String[] args) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 48\r\nC:\\scratch>\r\n```\n\n### Expected Behavior\n\nThe code succeeds without disabling the latest change wave.\n\n### Actual Behavior\n\nThe code fails.\n\n### Analysis\n\n_No response_\n\n### Versions & Configurations\n\nSee the attached msbuild binary log, but here it is:\r\n```\r\nC:\\scratch> msbuild --version\r\nMSBuild version 17.9.5+33de0b227 for .NET Framework\r\n17.9.5.7608\r\nC:\\scratch>\r\n```",
  "state": "CLOSED",
  "createdAt": "2024-03-14T20:02:11Z",
  "updatedAt": "2024-05-27T07:36:56Z",
  "closedAt": "2024-03-20T14:29:46Z",
  "author": {
    "login": "MarkKharitonov"
  },
  "labels": [
    "bug"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "ladipro"
      }
    ]
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "@MarkKharitonov you are loading MSBuild from VS, which is built to target .NET Framework - into a .NET 8 app. I'm afraid this is unsupported and the fact that it worked before 17.9 would be considered a lucky accident.\r\n\r\n@rainersigwald have we ever made such guarantees before? Do you think it's generally a reasonable expectation for the NetFx MSBuild to be usable in a .NET process, at least to the point that it can evaluate a project?\r\n\r\n(Incidentally, the change that broke this is being reverted for other reasons and the next servicing release of 17.9 should work for you again. We have another change lined up for 17.10, though, which will have a similar effect.)",
        "createdAt": "2024-03-19T17:07:04Z",
        "updatedAt": "2024-03-19T17:07:04Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "@ladipro - would you be able to recommend the proper way to do it?\r\n\r\nMy goal is to have a tool written in the modern .NET stack (like .NET 8) that analyzes projects targeting .NET 4. Some of these projects are not even SDK style projects.\r\n\r\nThe code I have attached is what I have used so far with success. But if it is wrong, I will gladly change it with your help (hopefully).\r\nThank you very much.",
        "createdAt": "2024-03-19T17:59:22Z",
        "updatedAt": "2024-03-19T17:59:22Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "> @rainersigwald have we ever made such guarantees before? Do you think it's generally a reasonable expectation for the NetFx MSBuild to be usable in a .NET process, at least to the point that it can evaluate a project?\r\n\r\nNo, and actually we should probably put an explicit break in MSBuildLocator for this (cc @YuliiaKovalova).\r\n\r\n@MarkKharitonov Unfortunately if you want to analyze non-SDK projects targeting .NET 4 (or 3.5 or whatever) your tool must run on .NET Framework today.",
        "createdAt": "2024-03-19T18:02:01Z",
        "updatedAt": "2024-03-19T18:02:01Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "That is indeed very unfortunate, since there is a ton of legacy code out there to be analyzed.\r\n\r\nThis requirement for a tool to be written in .NET Framework in order to analyze code written in .NET Framework (using msbuild API) - was it documented anywhere? Maybe I have missed that part. For me (granted, not the mainstream case) this is a breaking change.",
        "createdAt": "2024-03-19T19:14:22Z",
        "updatedAt": "2024-03-19T19:14:22Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "That's how it's been since the first port of MSBuild in .NET Core 1.0; MSBuild on .NET Framework is the compatible can-load-anything solution. I'm genuinely surprised you ever got it to work even partially.",
        "createdAt": "2024-03-19T19:20:03Z",
        "updatedAt": "2024-03-19T19:20:03Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Some analysis tools will use a modern .NET process that will spawn a child process to use MSBuild to extract information about non-SDK projects and pass it back via IPC.",
        "createdAt": "2024-03-19T19:20:56Z",
        "updatedAt": "2024-03-19T19:20:56Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "I cannot explain it, of course, since I do not understand the root of the problem. But it did work and still does if I disable the new feature through that environment variable.\r\n\r\nIt is very problematic to target .NET 4, because it prevents me from using the latest versions of all kinds of packages I depend on. And to implement IPC and spawn child processes is, of course, possible, but it makes the tool so much more complicated...\r\n\r\n",
        "createdAt": "2024-03-19T19:27:04Z",
        "updatedAt": "2024-03-19T19:28:02Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "> I cannot explain it, of course, since I do not understand the root of the problem.\r\n\r\nI think the best way to describe the problem is that .NET (Core) API is not a superset of .NET Framework API and it is certainly not bug-for-bug compatible. So while the VS MSBuild and the .NET SDK MSBuild share most of the code, there are places where the code is platform-specific, such as to take advantage of a feature present in one but not the other. I believe in this case we're looking at differences in assembly binding behavior.\r\n\r\nIt probably would be technically possible to keep the scenario of cross-loading working, but it would mean additional code complexity and a larger test matrix, so more dev burden for something that's not architecturally sound to begin with.",
        "createdAt": "2024-03-19T21:06:57Z",
        "updatedAt": "2024-03-19T21:06:57Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "Closing as won't fix. @MarkKharitonov you should be good with `MSBUILDDISABLEFEATURESFROMVERSION=17.10` for now but unfortunately we can't officially support this scenario.",
        "createdAt": "2024-03-20T14:29:46Z",
        "updatedAt": "2024-03-20T14:29:46Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "@ladipro - may I get a moment of your time once more?\r\n\r\nI changed the csproj file by replacing\r\n```\r\n<TargetFramework>net8.0</TargetFramework>\r\n```\r\nWith\r\n```\r\n <TargetFramework>net472</TargetFramework>\r\n <LangVersion>12.0</LangVersion>\r\n```\r\nBut it still does not work. This time the error is different and it is the same whether the environment variable is set or unset:\r\n```\r\nC:\\scratch> .\\bin\\Debug\\net472\\scratch.exe . .\\scratch.csproj\r\n\r\nUnhandled Exception: Microsoft.Build.Exceptions.InvalidProjectFileException: SDK Resolver Failure: \"The SDK resolver \"Microsoft.DotNet.MSBuildSdkResolver\" failed while attempting to resolve the SDK \"Microsoft.NET.Sdk\". Exception: \"System.IO.FileNotFoundException: Could not load file or assembly 'System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies. The system cannot find the file specified.\r\nFile name: 'System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'\r\n   at Microsoft.NET.Sdk.WorkloadMSBuildSdkResolver.CachingWorkloadResolver.Resolve(String sdkReferenceName, String dotnetRootPath, String sdkVersion, String userProfileDir, String globalJsonPath)\r\n   at Microsoft.DotNet.MSBuildSdkResolver.DotNetMSBuildSdkResolver.Resolve(SdkReference sdkReference, SdkResolverContext context, SdkResultFactory factory)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.TryResolveSdkUsingSpecifiedResolvers(IReadOnlyList`1 resolvers, Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, SdkResult& sdkResult, IEnumerable`1& errors, IEnumerable`1& warnings)\r\n\r\n=== Pre-bind state information ===\r\nLOG: DisplayName = System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\r\n (Fully-specified)\r\nLOG: Appbase = file:///C:/scratch/bin/Debug/net472/\r\nLOG: Initial PrivatePath = NULL\r\nCalling assembly : System.Collections.Immutable, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a.\r\n===\r\nLOG: This bind starts in LoadFrom load context.\r\nWRN: Native image will not be probed in LoadFrom context. Native image will only be probed in default load context, like with Assembly.Load().\r\nLOG: Using application configuration file: C:\\dayforce\\CSTool\\scratch\\bin\\Debug\\net472\\scratch.exe.Config\r\nLOG: Using host configuration file:\r\nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\config\\machine.config.\r\nLOG: Post-policy reference: System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\r\nLOG: Attempting download of new URL file:///C:/scratch/bin/Debug/net472/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/scratch/bin/Debug/net472/System.Runtime/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/scratch/bin/Debug/net472/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/scratch/bin/Debug/net472/System.Runtime/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime/System.Runtime.EXE.\r\n\"\"  C:\\dayforce\\CSTool\\scratch\\scratch.csproj\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate()\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion)\r\n   at Program.Run(String slnDirPath, String csprojPath) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 54\r\n   at Program.Main(String[] args) in C:\\dayforce\\CSTool\\scratch\\Program.cs:line 48\r\nC:\\scratch>\r\n```\r\n\r\nWould you be able to indicate what I am doing wrong?\r\n\r\nThank you so much.",
        "createdAt": "2024-03-29T00:51:12Z",
        "updatedAt": "2024-03-29T00:51:12Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "I also asked the question here - https://stackoverflow.com/questions/78253252/what-is-the-correct-method-to-analyze-net-4-7-2-projects-using-msbuild-api",
        "createdAt": "2024-04-01T01:50:40Z",
        "updatedAt": "2024-04-01T01:50:40Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "@MarkKharitonov I don't reproduce your failure--your code works fine for me. What versions of EVERYTHING are set up in the repro environment?",
        "createdAt": "2024-04-01T14:25:11Z",
        "updatedAt": "2024-04-01T14:25:11Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@rainersigwald - I have pushed a small test code to GitHub - https://github.com/MarkKharitonov/test_load_msbuild_project.\r\n\r\nI will copy here the Introduction and the final Summary from the README:\r\n\r\n---\r\n# Introduction\r\n\r\nThis README shows the result of running the tool in 3 different environments x 2 different target frameworks x 3 kinds of projects to be parsed:\r\n\r\n**3 different run environments**:\r\n1. From within VS IDE\r\n2. On a shell with VS Dev environment loaded\r\n3. On a bare shell without any VS Dev environment\r\n\r\n**2 different target frameworks** (for which the tool is compiled):\r\n1. .NET 8\r\n2. .NET Framework 4.7.2\r\n\r\n**3 kinds of projects to be parsed**:\r\n1. Legacy style project targeting .NET Framework 4.7.2 - **sample_net472_legacy.proj**\r\n2. SDK style project targeting .NET Framework 4.7.2 - **sample_net472_sdk.proj**\r\n3. A project targeting .NET 8 (SDK style, of course) - **sample_net8.proj**\r\n\r\nBy default **sample_net472_legacy.proj** is parsed. To parse another project pass its path on the command line.\r\n\r\nThe runs where done with Visual Studio 2022 version 17.9.5 and .NET 8 CLI:\r\n```\r\nMicrosoft Visual Studio Professional 2022\r\nVersion 17.9.5\r\nVisualStudio.17.Release/17.9.5+34723.18\r\nMicrosoft .NET Framework\r\nVersion 4.8.04161\r\n```\r\n```\r\nC:\\work\\test_load_msbuild_project> dotnet --version\r\n8.0.202\r\nC:\\work\\test_load_msbuild_project> msbuild --version\r\nMSBuild version 17.9.8+b34f75857 for .NET Framework\r\n17.9.8.16306\r\nC:\\work\\test_load_msbuild_project [master +10 ~0 -0 ~]>\r\n```\r\n...\r\n\r\n# Summary\r\nThe code must target .NET 8 in order to be able to parse both SDK and non SDK style projects targeting .NET or .NET Framework.\r\nWhen targeting .NET Framework 4.7.2 only legacy style projects can be parsed.\r\n\r\n| Target Framework | Project | Environment | Result |\r\n| --- | --- | --- | --- |\r\n| .NET 8 | All | All | OK |\r\n| .NET Framework 4.7.2 | legacy | All | OK |\r\n| .NET Framework 4.7.2 | SDK style | All | Error |\r\n\r\nAll the errors are the same one:\r\n```\r\nUnhandled Exception: Microsoft.Build.Exceptions.InvalidProjectFileException: SDK Resolver Failure: \"The SDK resolver \"Microsoft.DotNet.MSBuildSdkResolver\" failed while attempting to resolve the SDK \"Microsoft.NET.Sdk\". Exception: \"System.IO.FileNotFoundException: Could not load file or assembly 'System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies. The system cannot find the file specified.\r\nFile name: 'System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'\r\n   at Microsoft.NET.Sdk.WorkloadMSBuildSdkResolver.CachingWorkloadResolver.Resolve(String sdkReferenceName, String dotnetRootPath, String sdkVersion, String userProfileDir, String globalJsonPath)\r\n   at Microsoft.DotNet.MSBuildSdkResolver.DotNetMSBuildSdkResolver.Resolve(SdkReference sdkReference, SdkResolverContext context, SdkResultFactory factory)\r\n   at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.TryResolveSdkUsingSpecifiedResolvers(IReadOnlyList`1 resolvers, Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, SdkResult& sdkResult, IEnumerable`1& errors, IEnumerable`1& warnings)\r\n\r\n=== Pre-bind state information ===\r\nLOG: DisplayName = System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\r\n (Fully-specified)\r\nLOG: Appbase = file:///C:/work/test_load_msbuild_project/bin/Debug/net472/\r\nLOG: Initial PrivatePath = NULL\r\nCalling assembly : System.Collections.Immutable, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a.\r\n===\r\nLOG: This bind starts in LoadFrom load context.\r\nWRN: Native image will not be probed in LoadFrom context. Native image will only be probed in default load context, like with Assembly.Load().\r\nLOG: Using application configuration file: C:\\work\\test_load_msbuild_project\\bin\\Debug\\net472\\test_load_msbuild_project.exe.Config\r\nLOG: Using host configuration file:\r\nLOG: Using machine configuration file from C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\config\\machine.config.\r\nLOG: Post-policy reference: System.Runtime, Version=7.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\r\nLOG: Attempting download of new URL file:///C:/work/test_load_msbuild_project/bin/Debug/net472/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/work/test_load_msbuild_project/bin/Debug/net472/System.Runtime/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/work/test_load_msbuild_project/bin/Debug/net472/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/work/test_load_msbuild_project/bin/Debug/net472/System.Runtime/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime/System.Runtime.DLL.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime.EXE.\r\nLOG: Attempting download of new URL file:///C:/Program Files/Microsoft Visual Studio/2022/Professional/MSBuild/Current/Bin/SdkResolvers/Microsoft.DotNet.MSBuildSdkResolver/System.Runtime/System.Runtime.EXE.\r\n\"\"  C:\\work\\test_load_msbuild_project\\sample_net8.proj\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate()\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext)\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile)\r\n   at Program.Run(String csprojFileName) in C:\\work\\test_load_msbuild_project\\Program.cs:line 33\r\n   at Program.Main(String[] args) in C:\\work\\test_load_msbuild_project\\Program.cs:line 24\r\n```\r\n---\r\n\r\nAs far as I understand, my tool must target .NET 4.7.2 , but I just cannot make it work. Your help is greatly appreciated.\r\n",
        "createdAt": "2024-04-01T16:35:17Z",
        "updatedAt": "2024-04-01T16:35:17Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "@MarkKharitonov, I cannot reproduce this either. It looks like on your system the tool is picking up \r\nthe .NET Core version of `System.Collections.Immutable`. The .NET Framework version does not depend on `System.Runtime` so it couldn't fail in this way. Can you check where it's loading `System.Collections.Immutable` from?",
        "createdAt": "2024-04-02T07:56:34Z",
        "updatedAt": "2024-04-02T07:56:34Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "@ladipro - sure I can do it. But I have multiple run environments comprised of different target frameworks, ways to run (IDE, dev console, bare) and projects to parse (legacy/sdk, .NET Framework/.NET). Which one would you like me to run?",
        "createdAt": "2024-04-02T17:02:19Z",
        "updatedAt": "2024-04-02T17:02:19Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "@MarkKharitonov, oh, any environment where you're getting the `FileNotFoundException: Could not load file or assembly 'System.Runtime` error.",
        "createdAt": "2024-04-02T20:14:00Z",
        "updatedAt": "2024-04-02T20:14:00Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "When ran from IDE it is loaded from C:\\Program Files\\Microsoft Visual Studio\\2022\\Professional\\MSBuild\\Current\\Bin\\SdkResolvers\\Microsoft.DotNet.MSBuildSdkResolver\\:\r\n\r\n![image](https://github.com/dotnet/msbuild/assets/489792/c66a5999-337c-4270-ba77-3737486e15f0)\r\n",
        "createdAt": "2024-04-02T20:56:08Z",
        "updatedAt": "2024-04-02T20:56:08Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "This screenshot is from my 17.9.5 install - the file is not there:\r\n\r\n<img width=\"434\" alt=\"image\" src=\"https://github.com/dotnet/msbuild/assets/12206368/77db4b16-15a1-4c63-8b17-50cf90c565a9\">\r\n\r\nIs it possible that the file was copied to this location manually, maybe as a workaround?",
        "createdAt": "2024-04-02T21:16:04Z",
        "updatedAt": "2024-04-02T21:16:04Z",
        "author": {
          "login": "ladipro"
        }
      },
      {
        "body": "Ouch. Stupid me. I must have placed it there while trying to make it work with the previous version of Visual Studio.\r\n\r\nI removed the file and now all the matrix cases work beautifully.\r\n\r\nSince it works I will continue to target .NET 8 in my tool even if it parses projects targeting .NET Framework 4.7.2. It would be fantastic if this ability is not broken in the future, even though you guys are saying it will be.",
        "createdAt": "2024-04-02T21:36:52Z",
        "updatedAt": "2024-04-02T21:36:52Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "@ladipro I hate to bother you again, but with the release of 17.10 the code that worked before no longer works. The test project is still available at https://github.com/MarkKharitonov/test_load_msbuild_project.git. I pushed a change where I hard code the location of the msbuild.exe to the locally built one (from this repo).\r\n\r\nWhen I build msbuild at v17.9.8 and then run my app here is what I get:\r\n```\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe sample_net472_legacy.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.9.8+b34f75857bacf5ecd5531f7ff763a5739d3ae435\r\ncsprojFileName          = \"sample_net472_legacy.proj\"\r\nMSBuildExtensionsPath   = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\r\nMSBuildToolsVersion     = Current\r\nMSBuildBinPath          = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\amd64\r\nVSToolsPath             = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Microsoft\\VisualStudio\\v17.0\r\nTargetPath              = C:\\work\\test_load_msbuild_project\\Bin\\xyz.dll\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe .\\sample_net472_sdk.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.9.8+b34f75857bacf5ecd5531f7ff763a5739d3ae435\r\ncsprojFileName          = \".\\sample_net472_sdk.proj\"\r\nMSBuildExtensionsPath   = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\r\nMSBuildToolsVersion     = Current\r\nMSBuildBinPath          = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\amd64\r\nVSToolsPath             =\r\nTargetPath              = C:\\work\\test_load_msbuild_project\\bin\\Debug\\net472\\sample_net472_sdk.dll\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe .\\sample_net8.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.9.8+b34f75857bacf5ecd5531f7ff763a5739d3ae435\r\ncsprojFileName          = \".\\sample_net8.proj\"\r\nMSBuildExtensionsPath   = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\r\nMSBuildToolsVersion     = Current\r\nMSBuildBinPath          = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\amd64\r\nVSToolsPath             =\r\nTargetPath              = C:\\work\\test_load_msbuild_project\\bin\\Debug\\net8\\sample_net8.dll\r\nC:\\work\\test_load_msbuild_project [master \u2261]>\r\n```\r\nAll is great.\r\n\r\nHowever, when I build msbuild at v17.10.4 and rerun the same commands, I get this result:\r\n```\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe sample_net472_legacy.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.10.4+10fbfbf2eeb0597fdc1f600d87d38c7f57317bdc\r\ncsprojFileName          = \"sample_net472_legacy.proj\"\r\nMSBuildExtensionsPath   = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\r\nMSBuildToolsVersion     = Current\r\nMSBuildBinPath          = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\amd64\r\nVSToolsPath             = c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Microsoft\\VisualStudio\\v17.0\r\nTargetPath              = C:\\work\\test_load_msbuild_project\\Bin\\xyz.dll\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe .\\sample_net472_sdk.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.10.4+10fbfbf2eeb0597fdc1f600d87d38c7f57317bdc\r\ncsprojFileName          = \".\\sample_net472_sdk.proj\"\r\nUnhandled exception. Microsoft.Build.Exceptions.InvalidProjectFileException: The expression \"[MSBuild]::GetTargetFrameworkIdentifier(net472)\" cannot be evaluated. Method not found: 'System.AppDomain System.AppDomain.CreateDomain(System.String, System.Security.Policy.Evidence, System.AppDomainSetup)'.  C:\\Program Files\\dotnet\\sdk\\8.0.300\\Sdks\\Microsoft.NET.Sdk\\targets\\Microsoft.NET.TargetFrameworkInference.targets\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args) in C:\\work\\msbuild\\src\\Shared\\ProjectErrorUtilities.cs:line 268\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject[T1,T2](IElementLocation elementLocation, String resourceName, T1 arg0, T2 arg1) in C:\\work\\msbuild\\src\\Shared\\ProjectErrorUtilities.cs:line 65\r\n   at Microsoft.Build.Evaluation.Expander`2.Function`1.Execute(Object objectInstance, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 3537\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertyBody(String propertyBody, Object propertyValue, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1401\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertiesLeaveTypedAndEscaped(String expression, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1249\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertiesLeaveEscaped(String expression, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1110\r\n   at Microsoft.Build.Evaluation.Expander`2.ExpandIntoStringLeaveEscaped(String expression, ExpanderOptions options, IElementLocation elementLocation, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 452\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluatePropertyElement(ProjectPropertyElement propertyElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1297\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluatePropertyGroupElement(ProjectPropertyGroupElement propertyGroupElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 981\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 894\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 910\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 910\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 935\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate() in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 639\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 341\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3719\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3689\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3672\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3305\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3807\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 472\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 450\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 431\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 413\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 396\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 383\r\n   at Program.Run(String csprojFileName) in C:\\work\\test_load_msbuild_project\\Program.cs:line 35\r\n   at Program.Main(String[] args) in C:\\work\\test_load_msbuild_project\\Program.cs:line 25\r\nC:\\work\\test_load_msbuild_project [master \u2261]> .\\bin\\Debug\\net8\\test_load_msbuild_project.exe .\\sample_net8.proj\r\nmsbuildDir              = \"c:\\work\\msbuild\\artifacts\\bin\\bootstrap\\net472\\MSBuild\\Current\\Bin\\\"\r\nInformationalVersion    = 17.10.4+10fbfbf2eeb0597fdc1f600d87d38c7f57317bdc\r\ncsprojFileName          = \".\\sample_net8.proj\"\r\nUnhandled exception. Microsoft.Build.Exceptions.InvalidProjectFileException: The expression \"[MSBuild]::GetTargetFrameworkIdentifier(net8)\" cannot be evaluated. Method not found: 'System.AppDomain System.AppDomain.CreateDomain(System.String, System.Security.Policy.Evidence, System.AppDomainSetup)'.  C:\\Program Files\\dotnet\\sdk\\8.0.300\\Sdks\\Microsoft.NET.Sdk\\targets\\Microsoft.NET.TargetFrameworkInference.targets\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args) in C:\\work\\msbuild\\src\\Shared\\ProjectErrorUtilities.cs:line 268\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject[T1,T2](IElementLocation elementLocation, String resourceName, T1 arg0, T2 arg1) in C:\\work\\msbuild\\src\\Shared\\ProjectErrorUtilities.cs:line 65\r\n   at Microsoft.Build.Evaluation.Expander`2.Function`1.Execute(Object objectInstance, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 3537\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertyBody(String propertyBody, Object propertyValue, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1401\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertiesLeaveTypedAndEscaped(String expression, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1249\r\n   at Microsoft.Build.Evaluation.Expander`2.PropertyExpander`1.ExpandPropertiesLeaveEscaped(String expression, IPropertyProvider`1 properties, ExpanderOptions options, IElementLocation elementLocation, UsedUninitializedProperties usedUninitializedProperties, IFileSystem fileSystem, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 1110\r\n   at Microsoft.Build.Evaluation.Expander`2.ExpandIntoStringLeaveEscaped(String expression, ExpanderOptions options, IElementLocation elementLocation, LoggingContext loggingContext) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Expander.cs:line 452\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluatePropertyElement(ProjectPropertyElement propertyElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1297\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluatePropertyGroupElement(ProjectPropertyGroupElement propertyGroupElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 981\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 894\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 910\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 910\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 1462\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 935\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate() in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 639\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Evaluation\\Evaluator.cs:line 341\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3719\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3689\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3672\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.ReevaluateIfNecessary(EvaluationContext evaluationContext) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3305\r\n   at Microsoft.Build.Evaluation.Project.ProjectImpl.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 3807\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory, Boolean interactive) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 472\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 450\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 431\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectCollection projectCollection) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 413\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 396\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile) in C:\\work\\msbuild\\src\\Build\\Definition\\Project.cs:line 383\r\n   at Program.Run(String csprojFileName) in C:\\work\\test_load_msbuild_project\\Program.cs:line 35\r\n   at Program.Main(String[] args) in C:\\work\\test_load_msbuild_project\\Program.cs:line 25\r\nC:\\work\\test_load_msbuild_project [master \u2261]>\r\n```\r\nI am pretty sure it is related to https://github.com/dotnet/msbuild/pull/9446.\r\n\r\nPlease, advise.",
        "createdAt": "2024-05-24T04:31:36Z",
        "updatedAt": "2024-05-24T04:31:36Z",
        "author": {
          "login": "MarkKharitonov"
        }
      },
      {
        "body": "@MarkKharitonov so this is still loading the net472 build of MSBuild into a .NET 8 process, is that correct? As discussed before, it's unfortunately not a supported scenario. Though in this case, there may be a relatively simple workaround, let me try something.",
        "createdAt": "2024-05-27T07:36:55Z",
        "updatedAt": "2024-05-27T07:36:55Z",
        "author": {
          "login": "ladipro"
        }
      }
    ]
  }
}