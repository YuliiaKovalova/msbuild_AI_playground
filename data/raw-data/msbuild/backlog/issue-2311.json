{
  "number": 2311,
  "title": "Inline code tasks do not support latest C# features",
  "body": "Even if you use the latest & greatests Tasks.Core.dll, you still get an old-ish C# support for inline tasks. \r\n\r\nRepro:\r\n\r\n```\r\n<Project DefaultTargets=\"Build\">\r\n\r\n    <Target Name=\"Build\">\r\n        <Dump />\r\n    </Target>\r\n\r\n    <UsingTask TaskName=\"Dump\" TaskFactory=\"CodeTaskFactory\" AssemblyFile=\"$(MSBuildBinPath)\\Microsoft.Build.Tasks.Core.dll\">\r\n        <Task>\r\n            <Reference Include=\"Microsoft.Build\" />\r\n            <Reference Include=\"Microsoft.CSharp\" />\r\n            <Reference Include=\"System\" />\r\n            <Reference Include=\"System.Core\" />\r\n            <Using Namespace=\"System\" />\r\n            <Using Namespace=\"System.Linq\" />\r\n            <Using Namespace=\"Microsoft.Build.Framework\" />\r\n            <Using Namespace=\"Microsoft.Build.Utilities\" />\r\n            <Code Type=\"Fragment\" Language=\"cs\">\r\n                <![CDATA[\r\n            Log.LogMessage(MessageImportance.High, GetMessage(\"Foo={0}, Bar={1}\", \"foo\", \"bar\"));\r\n\r\n            string GetMessage(string message, params string[] args)\r\n            {\r\n                return \"Message: \" + string.Format(message, args);\r\n            }\r\n                ]]>\r\n            </Code>\r\n        </Task>\r\n    </UsingTask>\r\n</Project>\r\n```\r\n\r\nThis fails, but the generated code builds just fine in MSBuild 15/VS2017: \r\n\r\n```\r\n//------------------------------------------------------------------------------\r\n// <auto-generated>\r\n//     This code was generated by a tool.\r\n//     Runtime Version:4.0.30319.42000\r\n//\r\n//     Changes to this file may cause incorrect behavior and will be lost if\r\n//     the code is regenerated.\r\n// </auto-generated>\r\n//------------------------------------------------------------------------------\r\n\r\nnamespace InlineCode\r\n{\r\n    using System;\r\n    using System.Collections;\r\n    using System.Collections.Generic;\r\n    using System.Text;\r\n    using System.Linq;\r\n    using System.IO;\r\n    using Microsoft.Build.Framework;\r\n    using Microsoft.Build.Utilities;\r\n\r\n\r\n    public class Dump : Microsoft.Build.Utilities.Task\r\n    {\r\n\r\n        private bool _Success = true;\r\n\r\n        public virtual bool Success\r\n        {\r\n            get\r\n            {\r\n                return _Success;\r\n            }\r\n            set\r\n            {\r\n                _Success = value;\r\n            }\r\n        }\r\n\r\n        public override bool Execute()\r\n        {\r\n\r\n            Log.LogMessage(MessageImportance.High, GetMessage(\"Foo={0}, Bar={1}\", \"foo\", \"bar\"));\r\n\r\n            string GetMessage(string message, params string[] args)\r\n            {\r\n                return \"Message: \" + string.Format(message, args);\r\n            }\r\n\r\n            return _Success;\r\n        }\r\n    }\r\n}\r\n```\r\n",
  "state": "CLOSED",
  "createdAt": "2017-07-17T17:34:38Z",
  "updatedAt": "2024-02-21T17:17:56Z",
  "closedAt": "2017-07-17T17:47:39Z",
  "author": {
    "login": "kzu"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This is an artifact of implementing `CodeTaskFactory` using the (now) deprecated CodeDOM, which uses an older C# compiler (and thus only supports older versions of the C# language). Changing that is tracked by #304.\r\n\r\nDuplicate of #304.",
        "createdAt": "2017-07-17T17:47:39Z",
        "updatedAt": "2017-07-17T17:47:39Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Try out https://www.nuget.org/packages/RoslynCodeTaskFactory which I just released",
        "createdAt": "2017-09-20T18:11:53Z",
        "updatedAt": "2017-09-20T18:11:53Z",
        "author": {
          "login": "jeffkl"
        }
      }
    ]
  }
}