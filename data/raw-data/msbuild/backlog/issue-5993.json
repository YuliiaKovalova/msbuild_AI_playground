{
  "number": 5993,
  "title": "PublicResXFileCodeGenerator generates internal class",
  "body": "<!-- NOTE: The MSBuild team receives a lot of issues and we need to prioritize them accordingly. Please understand that we may not get to your issue for some time. -->\r\n<!-- This is a template that helps us provide quicker feedback. Please use any relevant sections and delete anything you don't need. -->\r\n\r\n<!--\r\n* Here are some useful links to help you figure out what's wrong.\r\n* Our wiki: https://github.com/microsoft/msbuild/blob/master/documentation/wiki/Home.md\r\n* General Help: https://github.com/microsoft/msbuild/blob/master/documentation/wiki/Something's-wrong-in-my-build.md\r\n* Tips & Tricks: https://github.com/microsoft/msbuild/blob/master/documentation/wiki/MSBuild-Tips-%26-Tricks.md\r\n-->\r\n\r\n### Issue Description\r\nI'm trying to generate `.Designer.cs` file for my `.resx` file with msbuild. I use these properties:\r\n\r\n```\r\n<ItemGroup>\r\n    <Compile Update=\"Resources\\Resource.Designer.cs\">\r\n      <DesignTime>True</DesignTime>\r\n      <AutoGen>True</AutoGen>\r\n      <DependentUpon>Resource.resx</DependentUpon>\r\n    </Compile>\r\n  </ItemGroup>\r\n\r\n  <ItemGroup>\r\n    <EmbeddedResource Update=\"Resources\\Resource.id.resx\">\r\n      <Generator>PublicResXFileCodeGenerator</Generator>\r\n    </EmbeddedResource>\r\n    <EmbeddedResource Update=\"Resources\\Resource.resx\">\r\n      <Generator>PublicResXFileCodeGenerator</Generator>\r\n      <StronglyTypedFileName>Resources\\Resource.Designer.cs</StronglyTypedFileName>\r\n      <StronglyTypedLanguage>CSharp</StronglyTypedLanguage>\r\n      <StronglyTypedNamespace>home_server.Client.Web.Resources</StronglyTypedNamespace>\r\n      <StronglyTypedClassName>Resource</StronglyTypedClassName>\r\n      <LastGenOutput>Resource.Designer.cs</LastGenOutput>\r\n    </EmbeddedResource>\r\n  </ItemGroup>\r\n```\r\nThose settings generates the `.Designer.cs` file but it has wrong access modifier:\r\n\r\n```\r\n//------------------------------------------------------------------------------\r\n// <auto-generated>\r\n//     This code was generated by a tool.\r\n//     Runtime Version:4.0.30319.42000\r\n//\r\n//     Changes to this file may cause incorrect behavior and will be lost if\r\n//     the code is regenerated.\r\n// </auto-generated>\r\n//------------------------------------------------------------------------------\r\n\r\nnamespace home_server.Client.Web.Resources {\r\n    using System;\r\n    \r\n    \r\n    /// <summary>\r\n    ///   A strongly-typed resource class, for looking up localized strings, etc.\r\n    ///   This class was generated by MSBuild using the GenerateResource task.\r\n    ///   To add or remove a member, edit your .resx file then rerun MSBuild.\r\n    /// </summary>\r\n    [global::System.CodeDom.Compiler.GeneratedCodeAttribute(\"Microsoft.Build.Tasks.StronglyTypedResourceBuilder\", \"15.1.0.0\")]\r\n    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]\r\n    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]\r\n    internal class Resource {\r\n        \r\n        private static global::System.Resources.ResourceManager resourceMan;\r\n        \r\n        private static global::System.Globalization.CultureInfo resourceCulture;\r\n        \r\n        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute(\"Microsoft.Performance\", \"CA1811:AvoidUncalledPrivateCode\")]\r\n        internal Resource() {\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Returns the cached ResourceManager instance used by this class.\r\n        /// </summary>\r\n        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]\r\n        internal static global::System.Resources.ResourceManager ResourceManager {\r\n            get {\r\n                if (object.ReferenceEquals(resourceMan, null)) {\r\n                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager(\"home_server.Client.Web.Resources.Resource\", typeof(Resource).Assembly);\r\n                    resourceMan = temp;\r\n                }\r\n                return resourceMan;\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Overrides the current thread's CurrentUICulture property for all\r\n        ///   resource lookups using this strongly typed resource class.\r\n        /// </summary>\r\n        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]\r\n        internal static global::System.Globalization.CultureInfo Culture {\r\n            get {\r\n                return resourceCulture;\r\n            }\r\n            set {\r\n                resourceCulture = value;\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to Cancel.\r\n        /// </summary>\r\n        internal static string cancel {\r\n            get {\r\n                return ResourceManager.GetString(\"cancel\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to Error.\r\n        /// </summary>\r\n        internal static string error {\r\n            get {\r\n                return ResourceManager.GetString(\"error\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to Go Home.\r\n        /// </summary>\r\n        internal static string go_home {\r\n            get {\r\n                return ResourceManager.GetString(\"go_home\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to Loading.\r\n        /// </summary>\r\n        internal static string loading {\r\n            get {\r\n                return ResourceManager.GetString(\"loading\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to No such thing.\r\n        /// </summary>\r\n        internal static string no_such_thing {\r\n            get {\r\n                return ResourceManager.GetString(\"no_such_thing\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to OK.\r\n        /// </summary>\r\n        internal static string ok {\r\n            get {\r\n                return ResourceManager.GetString(\"ok\", resourceCulture);\r\n            }\r\n        }\r\n        \r\n        /// <summary>\r\n        ///   Looks up a localized string similar to tes.\r\n        /// </summary>\r\n        internal static string tes {\r\n            get {\r\n                return ResourceManager.GetString(\"tes\", resourceCulture);\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nAnd this is the resx file content:\r\n\r\n![image](https://user-images.githubusercontent.com/12814796/103373840-9ebdea00-4b08-11eb-8677-fabb20fe526d.png)\r\n\r\n### Expected Behavior\r\n<!--\r\n* Include what you are trying to do, and the expected output or behavior.\r\n-->\r\nGenerate `.Designer.cs` file with `public` modifier.\r\n\r\n### Actual Behavior\r\n<!--\r\n* Include the actual output or behavior.\r\n-->\r\nGenerates the file with `internal` modifier instead.\r\n\r\nSorry if this has been discussed before as I cant find it anywhere else.\r\nThanks",
  "state": "CLOSED",
  "createdAt": "2020-12-30T18:38:46Z",
  "updatedAt": "2021-01-18T23:23:14Z",
  "closedAt": "2021-01-18T23:23:14Z",
  "author": {
    "login": "ivanjx"
  },
  "labels": [
    "needs-triage"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "AR-May"
      }
    ]
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Team Triage: We believe this is an issue with VS, not MSBuild. Can you [open a feedback ticket instead](https://docs.microsoft.com/visualstudio/ide/feedback-options)? ",
        "createdAt": "2021-01-06T17:05:58Z",
        "updatedAt": "2021-01-06T17:05:58Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "huh? i use `dotnet build` command to generate that file.\r\neven the file said:\r\n```\r\n///   To add or remove a member, edit your .resx file then rerun MSBuild.\r\n```",
        "createdAt": "2021-01-06T17:18:46Z",
        "updatedAt": "2021-01-06T17:19:19Z",
        "author": {
          "login": "ivanjx"
        }
      },
      {
        "body": "please reopen the issue. i believe this has nothing to do with visual studio. thank you.",
        "createdAt": "2021-01-07T07:54:08Z",
        "updatedAt": "2021-01-07T07:54:08Z",
        "author": {
          "login": "ivanjx"
        }
      },
      {
        "body": "@realivanjx \ud83d\udc4d we'll take another look at this in the next bug triage. In the meantime, could you provide a minimal project that reproduces this, or steps on doing so?",
        "createdAt": "2021-01-08T00:19:55Z",
        "updatedAt": "2021-01-08T00:19:55Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "here you go. the details are in readme.\r\n\r\n[test.zip](https://github.com/dotnet/msbuild/files/5785115/test.zip)\r\n",
        "createdAt": "2021-01-08T03:52:07Z",
        "updatedAt": "2021-01-08T03:52:07Z",
        "author": {
          "login": "ivanjx"
        }
      },
      {
        "body": "To check in the repro: Does the publicresxfilecodegenerator file already exist? and if you delete them, does it get generated in the same way?",
        "createdAt": "2021-01-13T16:47:17Z",
        "updatedAt": "2021-01-13T16:47:17Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "You mean the `.Designer.cs` file? I deleted it from the repro zip but if you run `dotnet build` it should be generated automatically, still with wrong modifiers of course.",
        "createdAt": "2021-01-13T16:58:24Z",
        "updatedAt": "2021-01-13T16:58:24Z",
        "author": {
          "login": "ivanjx"
        }
      },
      {
        "body": "Also please use the `dotnet build` command directly. If you build from visual studio it will be generated with resgen instead of msbuild.",
        "createdAt": "2021-01-13T17:03:52Z",
        "updatedAt": "2021-01-13T17:03:52Z",
        "author": {
          "login": "ivanjx"
        }
      },
      {
        "body": "Tested the repro. The `.Designer.cs` file is indeed generated by `dotnet build` with the internal modifier. When generating using the same repro in VS, the modifiers are public. I wonder if MSBuild supports the generator `PublicResXFileCodeGenerator` at all, that seems to be the VS feature (VS wrapper around StronglyTypedResourceBuilder Class). \r\n\r\nHowever, it is possible to generate the file with public modifiers, one need to set `PublicClass` to true: \r\n```\r\n  <ItemGroup>\r\n    <Compile Update=\"MyResource.Designer.cs\">\r\n      <DesignTime>True</DesignTime>\r\n      <AutoGen>True</AutoGen>\r\n      <DependentUpon>MyResource.resx</DependentUpon>\r\n    </Compile>\r\n  </ItemGroup>\r\n\r\n  <ItemGroup>\r\n    <EmbeddedResource Update=\"MyResource.resx\">\r\n      <Generator>PublicResXFileCodeGenerator</Generator>\r\n      <PublicClass>true</PublicClass>\r\n      <StronglyTypedFileName>MyResource.Designer.cs</StronglyTypedFileName>\r\n      <StronglyTypedLanguage>CSharp</StronglyTypedLanguage>\r\n      <StronglyTypedNamespace>test</StronglyTypedNamespace>\r\n      <StronglyTypedClassName>MyResource</StronglyTypedClassName>\r\n      <LastGenOutput>MyResource.Designer.cs</LastGenOutput>\r\n    </EmbeddedResource>\r\n  </ItemGroup>\r\n```",
        "createdAt": "2021-01-18T12:46:02Z",
        "updatedAt": "2021-01-18T12:52:43Z",
        "author": {
          "login": "AR-May"
        }
      },
      {
        "body": "Thanks @AR-May for pointing out. It seems that `PublicResXFileCodeGenerator` is not supported by msbuild. I ended up with this in my `csproj` file:\r\n\r\n```\r\n  <ItemGroup>\r\n    <Compile Update=\"Resources\\Resource.Designer.cs\">\r\n      <DesignTime>True</DesignTime>\r\n      <AutoGen>True</AutoGen>\r\n      <DependentUpon>Resource.resx</DependentUpon>\r\n    </Compile>\r\n  </ItemGroup>\r\n\r\n  <ItemGroup>\r\n    <EmbeddedResource Update=\"Resources\\Resource.id.resx\">\r\n      <Generator>ResXFileCodeGenerator</Generator>\r\n      <PublicClass>true</PublicClass>\r\n    </EmbeddedResource>\r\n    <EmbeddedResource Update=\"Resources\\Resource.resx\">\r\n      <Generator>ResXFileCodeGenerator</Generator>\r\n      <PublicClass>true</PublicClass>\r\n      <StronglyTypedFileName>Resources\\Resource.Designer.cs</StronglyTypedFileName>\r\n      <StronglyTypedLanguage>CSharp</StronglyTypedLanguage>\r\n      <StronglyTypedNamespace>home_server.Client.Web.Resources</StronglyTypedNamespace>\r\n      <StronglyTypedClassName>Resource</StronglyTypedClassName>\r\n      <LastGenOutput>Resource.Designer.cs</LastGenOutput>\r\n    </EmbeddedResource>\r\n  </ItemGroup>\r\n```\r\n\r\nThanks. I will close this issue now.",
        "createdAt": "2021-01-18T23:23:14Z",
        "updatedAt": "2021-01-18T23:23:14Z",
        "author": {
          "login": "ivanjx"
        }
      }
    ]
  }
}