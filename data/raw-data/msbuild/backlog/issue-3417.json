{
  "number": 3417,
  "title": "MSBuild locks xunit assemblies during compilation of some specs",
  "body": "### Steps to reproduce\r\nClone a copy of the Akka.NET project from here: https://github.com/akkadotnet/akka.net\r\n\r\nOpen the project in Visual Studio or JetBrains Rider.\r\n\r\nSelect the following project: https://github.com/akkadotnet/akka.net/tree/dev/src/core/Akka.Cluster.Tests\r\n\r\nAttempt to build it while the IDE is open.\r\n\r\n### Expected  behavior\r\nProject compiles with no issues and unit tests can be run / debugged from the Visual Studio test runner.\r\n\r\n### Actual behavior\r\nLooks as though the file gets locked by the Visual Studio `testhost.x86` process.\r\n\r\n```\r\n7>Akka.Cluster.Tests -> D:\\olympus\\akka.net\\src\\core\\Akka.Cluster.Tests\\bin\\Debug\\netcoreapp1.1\\Akka.Cluster.Tests.dll\r\n7>Done building project \"Akka.Cluster.Tests.csproj\".\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 2 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 3 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 4 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 5 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 6 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 7 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 8 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 9 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): warning MSB3026: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Beginning retry 10 in 1000ms. The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): error MSB3027: Could not copy \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". Exceeded retry count of 10. Failed. The file is locked by: \"testhost.x86 (20612)\"\r\n7>F:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Microsoft.Common.CurrentVersion.targets(4343,5): error MSB3021: Unable to copy file \"C:\\Users\\aaron\\.nuget\\packages\\xunit.abstractions\\2.0.1\\lib\\net35\\xunit.abstractions.dll\" to \"bin\\Debug\\net452\\xunit.abstractions.dll\". The process cannot access the file 'bin\\Debug\\net452\\xunit.abstractions.dll' because it is being used by another process.\r\n```\r\n\r\nIf you try running a command line build, i.e. `c:\\akkadotnet\\src> dotnet build` you'll see a variation of this error occur from the CLI _so long as the IDE is also open at the same time_.\r\n\r\n### Environment data\r\n`dotnet --version`: 2.0.0\r\n\r\nVS Info:\r\n\r\n```\r\nMicrosoft Visual Studio Professional 2017 \r\nVersion 15.7.3\r\nVisualStudio.15.Release/15.7.3+27703.2026\r\nMicrosoft .NET Framework\r\nVersion 4.7.03056\r\n\r\nInstalled Version: Professional\r\n\r\nASP.NET and Web Tools 2017   15.0.40522.0\r\nASP.NET and Web Tools 2017\r\n\r\nASP.NET Core Razor Language Services   15.7.31476\r\nProvides languages services for ASP.NET Core Razor.\r\n\r\nASP.NET Web Frameworks and Tools 2017   5.2.60419.0\r\nFor additional information, visit https://www.asp.net/\r\n\r\nAzure App Service Tools v3.0.0   15.0.40424.0\r\nAzure App Service Tools v3.0.0\r\n\r\nAzure Data Lake Node   1.0\r\nThis package contains the Data Lake integration nodes for Server Explorer.\r\n\r\nAzure Data Lake Tools for Visual Studio   2.3.3000.2\r\nMicrosoft Azure Data Lake Tools for Visual Studio\r\n\r\nAzure Functions and Web Jobs Tools   15.0.40424.0\r\nAzure Functions and Web Jobs Tools\r\n\r\nAzure Stream Analytics Tools for Visual Studio   2.3.3000.2\r\nMicrosoft Azure Stream Analytics Tools for Visual Studio\r\n\r\nC# Tools   2.8.3-beta6-62923-07. Commit Hash: 7aafab561e449da50712e16c9e81742b8e7a2969\r\nC# components used in the IDE. Depending on your project type and settings, a different version of the compiler may be used.\r\n\r\nCommon Azure Tools   1.10\r\nProvides common services for use by Azure Mobile Services and Microsoft Azure Tools.\r\n\r\nFabric.DiagnosticEvents   1.0\r\nFabric Diagnostic Events\r\n\r\nILSpy.AddIn   1.0\r\nIntegration of the ILSpy Decompiler into Visual Studio.\r\n\r\nJavaScript Language Service   2.0\r\nJavaScript Language Service\r\n\r\nJetBrains ReSharper Ultimate 2018.1.2    Build 112.0.20180530.113618\r\nJetBrains ReSharper Ultimate package for Microsoft Visual Studio. For more information about ReSharper Ultimate, visit http://www.jetbrains.com/resharper. Copyright \u00a9 2018 JetBrains, Inc.\r\n\r\nMicrosoft Azure HDInsight Azure Node   2.3.3000.2\r\nHDInsight Node under Azure Node\r\n\r\nMicrosoft Azure Hive Query Language Service   2.3.3000.2\r\nLanguage service for Hive query\r\n\r\nMicrosoft Azure Service Fabric Tools for Visual Studio   2.1\r\nMicrosoft Azure Service Fabric Tools for Visual Studio\r\n\r\nMicrosoft Azure Stream Analytics Language Service   2.3.3000.2\r\nLanguage service for Azure Stream Analytics\r\n\r\nMicrosoft Azure Stream Analytics Node   1.0\r\nAzure Stream Analytics Node under Azure Node\r\n\r\nMicrosoft Azure Tools   2.9\r\nMicrosoft Azure Tools for Microsoft Visual Studio 2017 - v2.9.10420.2\r\n\r\nMicrosoft Continuous Delivery Tools for Visual Studio   0.3\r\nSimplifying the configuration of continuous build integration and continuous build delivery from within the Visual Studio IDE.\r\n\r\nMicrosoft JVM Debugger   1.0\r\nProvides support for connecting the Visual Studio debugger to JDWP compatible Java Virtual Machines\r\n\r\nMicrosoft MI-Based Debugger   1.0\r\nProvides support for connecting Visual Studio to MI compatible debuggers\r\n\r\nMicrosoft Visual Studio Tools for Containers   1.1\r\nDevelop, run, validate your ASP.NET Core applications in the target environment. F5 your application directly into a container with debugging, or CTRL + F5 to edit & refresh your app without having to rebuild the container.\r\n\r\nNuGet Package Manager   4.6.0\r\nNuGet Package Manager in Visual Studio. For more information about NuGet, visit http://docs.nuget.org/.\r\n\r\nProjectServicesPackage Extension   1.0\r\nProjectServicesPackage Visual Studio Extension Detailed Info\r\n\r\nRedgate SQL Search   2.4.2.1439\r\nSearch functionality for SQL Server databases, from within Visual Studio\r\n\r\nResourcePackage Extension   1.0\r\nResourcePackage Visual Studio Extension Detailed Info\r\n\r\nSQL Server Data Tools   15.1.61804.210\r\nMicrosoft SQL Server Data Tools\r\n\r\nToolWindowHostedEditor   1.0\r\nHosting json editor into a tool window\r\n\r\nTypeScript Tools   15.7.20419.2003\r\nTypeScript Tools for Microsoft Visual Studio\r\n\r\nVisual Basic Tools   2.8.3-beta6-62923-07. Commit Hash: 7aafab561e449da50712e16c9e81742b8e7a2969\r\nVisual Basic components used in the IDE. Depending on your project type and settings, a different version of the compiler may be used.\r\n\r\nVisual F# Tools 10.1 for F# 4.1   15.7.0.0.  Commit Hash: 2527e6829ecdc8281ee60d83be8cfd0fa720a648.\r\nMicrosoft Visual F# Tools 10.1 for F# 4.1\r\n\r\nVisual Studio Code Debug Adapter Host Package   1.0\r\nInterop layer for hosting Visual Studio Code debug adapters in Visual Studio\r\n```\r\n\r\nOS info:\r\n\r\nWindows 10 Pro\r\nVersion: 1803\r\nOS Build: 17134.112\r\n",
  "state": "CLOSED",
  "createdAt": "2018-06-15T19:19:37Z",
  "updatedAt": "2024-02-21T17:12:42Z",
  "closedAt": "2018-06-15T22:32:43Z",
  "author": {
    "login": "Aaronontheweb"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Weird part about this is, I can sometimes compile other Test projects but never the `Akka.Cluster.Tests` project I linked to earlier.",
        "createdAt": "2018-06-15T19:20:05Z",
        "updatedAt": "2018-06-15T19:20:05Z",
        "author": {
          "login": "Aaronontheweb"
        }
      },
      {
        "body": "This does not look like an msbuild issue, but rather an IDE one. Can you please open the issue against Visual Studio (https://docs.microsoft.com/en-us/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017)? ",
        "createdAt": "2018-06-15T22:32:43Z",
        "updatedAt": "2018-06-15T22:32:43Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "Looks like this may have been the root cause of this issue: https://github.com/xunit/xunit/issues/1644",
        "createdAt": "2018-06-27T20:50:55Z",
        "updatedAt": "2018-06-27T20:50:55Z",
        "author": {
          "login": "Aaronontheweb"
        }
      }
    ]
  }
}