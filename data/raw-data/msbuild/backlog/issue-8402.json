{
  "number": 8402,
  "title": "OutOfMemoryException: Task 'GenerateAppxManifest' failed. Array dimensions exceeded supported range.",
  "body": "Stumbled upon this crash with a 100% repro rate. I've narrowed it down to the following setup:\r\n\r\n- A WinRT component project (ie. uap10.0 TFM, winmdobj output type)\r\n- A partial method declaration\r\n  - It can be static or not, and accessibility doesn't matter\r\n  - It also doesn't matter if it's in a type that implements a COM/WinRT interface or not\r\n- A source generator that implements that partial method\r\n\r\nIf you then build an app referencing this project, you get the following MSBuild crash:\r\n\r\n```\r\nError\t\tTask 'GenerateAppxManifest' failed. Array dimensions exceeded supported range.\r\nError\t\tThis is an unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE AT https://aka.ms/msbuild/unhandled.\r\n    System.OutOfMemoryException: Array dimensions exceeded supported range.\r\n   at Microsoft.Cci.MetadataReader.AttributeDecoder.ReadSerializedValue(ITypeReference type)\r\n   at Microsoft.Cci.MetadataReader.CustomAttributeDecoder..ctor(PEFileToObjectModel peFileToObjectModel, MemoryReader signatureMemoryReader, UInt32 customAttributeRowId, IMethodReference attributeConstructor)\r\n   at Microsoft.Cci.MetadataReader.PEFileToObjectModel.GetCustomAttributeAtRow(MetadataObject owningObject, UInt32 token, UInt32 customAttributeRowId)\r\n   at Microsoft.Cci.MetadataReader.ObjectModelImplementation.MetadataObject.GetAttributes()\r\n   at Microsoft.Cci.MetadataReader.ObjectModelImplementation.MetadataObject.get_Attributes()\r\n   at Microsoft.Cci.MetadataTraverser.TraverseChildren(ITypeDefinitionMember typeMember)\r\n   at Microsoft.Cci.MetadataTraverser.TraverseChildren(IMethodDefinition method)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IMethodDefinition method)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IEnumerable`1 methods)\r\n   at Microsoft.Cci.MetadataTraverser.TraverseChildren(ITypeDefinition typeDefinition)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(INamespaceTypeDefinition namespaceTypeDefinition)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IEnumerable`1 namespaceMembers)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(INestedUnitNamespace nestedUnitNamespace)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IEnumerable`1 namespaceMembers)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(INestedUnitNamespace nestedUnitNamespace)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IEnumerable`1 namespaceMembers)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IRootUnitNamespace rootUnitNamespace)\r\n   at Microsoft.Cci.MetadataTraverser.Traverse(IAssembly assembly)\r\n   at Microsoft.Build.AppxPackage.WinmdVisitor.Traverse(IAssembly assembly, Boolean swallowTraversalException)\r\n   at Microsoft.Build.AppxPackage.WinmdVisitor.TraverseAssembly(IAssembly assembly, Boolean swallowTraversalException)\r\n   at Microsoft.Build.AppxPackage.WinmdVisitor.Traverse(DefaultHost host, Boolean swallowTraversalException)\r\n   at Microsoft.Build.AppxPackage.WinmdVisitor.ProcessInternal(AppxPackagingTaskHelper taskHelper, ITaskItem[] winmdFiles, ITaskItem[] nonFrameworkSdkReferences, ITaskItem[] sdkWinmdFiles, String managedWinmdInprocImplementation, Boolean harvestRegistrationInformation, Boolean loadMscorlibIntoHost, WinMdCacheOptions cacheOptions)\r\n   at Microsoft.Build.AppxPackage.WinmdVisitor.Process(AppxPackagingTaskHelper taskHelper, ITaskItem[] winmdFiles, ITaskItem[] nonFrameworkSdkReferences, ITaskItem[] sdkWinmdFiles, String managedWinmdInprocImplementation, Boolean harvestRegistrationInformation, WinMdCacheOptions cacheOptions)\r\n   at Microsoft.Build.AppxPackage.GenerateAppxManifest.UpdateWinmdRegistration()\r\n   at Microsoft.Build.AppxPackage.GenerateAppxManifest.ProcessDocument()\r\n   at Microsoft.Build.AppxPackage.GenerateAppxManifest.ExecuteImplementation()\r\n   at Microsoft.Build.AppxPackage.AppxPackagingTaskHelper.Execute(String file)\r\n   at Microsoft.Build.AppxPackage.AppxPackagingTaskBase.Execute()\r\n   at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteInstantiatedTask>d__26.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<InitializeAndExecuteTask>d__24.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteBucket>d__19.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__18.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__13.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetEntry.<ProcessBucket>d__51.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetEntry.<ExecuteTarget>d__44.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__23.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__10.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext()\r\n```\r\n\r\nI'm happy to share additional info if needed (eg. logs or anything), though this happens in the Microsoft Store repo so I can't do so publicly. If there's anything else on my end that would help, feel free to ping me on Teams \ud83d\ude42",
  "state": "CLOSED",
  "createdAt": "2023-02-03T15:07:19Z",
  "updatedAt": "2024-02-21T16:59:38Z",
  "closedAt": "2023-02-03T16:52:43Z",
  "author": {
    "login": "Sergio0694"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Can you please [open a Visual Studio feedback ticket](https://docs.microsoft.com/visualstudio/ide/feedback-options)? That has confidential-to-Microsoft-only options for sharing, and you should be able to upload high-fidelity logs/repro instructions.\r\n\r\nAfter it's created, that will open an internal bug which will be routed to the right team. In this case, I think that's the Appx folks. If you post the link here we may be able to help that process go faster.",
        "createdAt": "2023-02-03T15:54:04Z",
        "updatedAt": "2023-02-03T15:54:04Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Sweet, thank you! I've opened a ticket [here](https://developercommunity.visualstudio.com/t/MSBuild:-OutOfMemoryException:-Task-Gen/10270567?port=1025&fsid=036dac17-7df6-4395-89d7-77ec62d93bab) and included a full recording of compiling the project that causes the crash.\r\nHopefully that'll help \ud83d\ude0a",
        "createdAt": "2023-02-03T16:33:27Z",
        "updatedAt": "2023-02-03T16:33:27Z",
        "author": {
          "login": "Sergio0694"
        }
      },
      {
        "body": "Perfect, thanks! We'll let that track it.",
        "createdAt": "2023-02-03T16:52:43Z",
        "updatedAt": "2023-02-03T16:52:43Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}