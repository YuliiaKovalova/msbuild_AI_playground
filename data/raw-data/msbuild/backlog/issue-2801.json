{
  "number": 2801,
  "title": "System.TypeInitializationException when building projects after 15.5 update",
  "body": "### Summary\r\n\r\nAfter updating to latest version of MSBuild 15.5.180.51428 via the Visual Studio Installer **not a single project** can be built with MSBuild. Exception being thrown:\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nSystem.TypeInitializationException: The type initializer for 'Microsoft.Build.Shared.NativeMethodsShared' threw an exception. ---> System.PlatformNotSupportedException: Operation is not supported on this platform.\r\n\r\n### Steps to reproduce\r\n\r\n1. Update to latest version of MSBuild\r\n2. Try to build any existing project with `msbuild.exe <projectName>.csproj` for example\r\n\r\n### Expected  behavior\r\nBeing able to build a project using MSBuild.exe\r\n\r\n### Actual behavior\r\nA System.TypeInitializationException is being thrown\r\n\r\n`msbuild <projectName>.csproj`\r\n\r\n![image](https://user-images.githubusercontent.com/5772421/33933331-0befa31c-dffe-11e7-9f14-af8fb599d48d.png)\r\n\r\n\r\n\r\n**New project in VS**\r\n![image](https://user-images.githubusercontent.com/5772421/33932834-b59502d8-dffc-11e7-9d5f-9c18087d72b5.png)\r\n\r\n**Solution Explorer in VS**\r\n![image](https://user-images.githubusercontent.com/5772421/33932830-b309044c-dffc-11e7-8856-0f2296d6c367.png)\r\n\r\n**Trying to Reload a project in VS**\r\n![image](https://user-images.githubusercontent.com/5772421/33932866-cd3cf062-dffc-11e7-98ee-cbe3dfa4f9dd.png)\r\n\r\n### Environment data\r\nMSBuild version : Build Engine version 15.5.180.51428 for .NET Framework\r\nOutput: \r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nSystem.TypeInitializationException: The type initializer for 'Microsoft.Build.Shared.NativeMethodsShared' threw an exception. ---> System.PlatformNotSupportedException: Operation is not supported on this platform.\r\n   at System.Runtime.InteropServices.OSPlatform.get_Linux()\r\n   at Microsoft.Build.Shared.NativeMethodsShared.get_IsLinux()\r\n   at Microsoft.Build.Shared.NativeMethodsShared..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.Shared.NativeMethodsShared.get_IsMono()\r\n   at Microsoft.Build.BackEnd.Logging.LoggingService..ctor(LoggerMode loggerMode, Int32 nodeId)\r\n   at Microsoft.Build.Evaluation.ProjectCollection.CreateLoggingService(Int32 maxCPUCount, Boolean onlyLogCriticalEvents)\r\n   at Microsoft.Build.Evaluation.ProjectCollection..ctor(IDictionary`2 globalProperties, IEnumerable`1 loggers, IEnumerable`1 remoteLoggers, ToolsetDefinitionLocations toolsetDefinitionLocations, Int32 maxNodeCount, Boolean onlyLogCriticalEvents)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n\r\nUnhandled Exception: System.TypeInitializationException: The type initializer for 'Microsoft.Build.Shared.NativeMethodsShared' threw an exception. ---> System.PlatformNotSupportedException: Operation is not supported on this platform.\r\n   at System.Runtime.InteropServices.OSPlatform.get_Linux()\r\n   at Microsoft.Build.Shared.NativeMethodsShared.get_IsLinux()\r\n   at Microsoft.Build.Shared.NativeMethodsShared..cctor()\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.Shared.NativeMethodsShared.get_IsMono()\r\n   at Microsoft.Build.BackEnd.Logging.LoggingService..ctor(LoggerMode loggerMode, Int32 nodeId)\r\n   at Microsoft.Build.Evaluation.ProjectCollection.CreateLoggingService(Int32 maxCPUCount, Boolean onlyLogCriticalEvents)\r\n   at Microsoft.Build.Evaluation.ProjectCollection..ctor(IDictionary`2 globalProperties, IEnumerable`1 loggers, IEnumerable`1 remoteLoggers, ToolsetDefinitionLocations toolsetDefinitionLocations, Int32 maxNodeCount, Boolean onlyLogCriticalEvents)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n\r\n**OS info:**\r\nWindows specifications\r\nEdition: Windows 10 Enterprise\r\nVersion: 1709\r\nOS Buld: 16299.98\r\n\r\nSome additional notes. Visual studio can't load or create any projects either after the update. Also older versions of MSBuild work just fine. I haven't fiddled with my OS in any way other than installing the standard MS updates whenever prompted.\r\n\r\nSo far I have tried:\r\nRepairing VS\r\nReinstalling VS\r\nReinstalling VS Installer\r\nManually uninstalling/installing MSBuild Tools (which includes msbuild.exe)\r\nRunning older versions of MSBuild (this has worked)\r\n",
  "state": "CLOSED",
  "createdAt": "2017-12-13T10:07:31Z",
  "updatedAt": "2024-02-21T17:15:15Z",
  "closedAt": "2020-07-01T16:20:23Z",
  "author": {
    "login": "jicata"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Team triage: closing due to age. If you're still seeing this problem, please let us know and we can reactivate it.",
        "createdAt": "2020-07-01T16:20:23Z",
        "updatedAt": "2020-07-01T16:20:23Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}