{
  "number": 1648,
  "title": "GenerateCompiledExpressionsTempFile does not clean up the files it creates",
  "body": "1. Create a new .NET Framework project\r\n2. Build\r\n3. Clean\r\n\r\n**Expected:** Obj to be empty\r\n**Actual:** 3 files generated by GenerateCompiledExpressionsTempFile are still present:\r\n\r\n```\r\nTemporaryGeneratedFile_036C0B5B-1481-4323-8D20-8F5ADCB23D92.cs\r\nTemporaryGeneratedFile_5937a670-0e60-4077-877b-f7221da3dda1.cs\r\nTemporaryGeneratedFile_E7A71F73-0F8D-4B9B-B56E-8E70B10BC5D3.cs\r\n```",
  "state": "CLOSED",
  "createdAt": "2017-02-01T11:34:09Z",
  "updatedAt": "2024-02-21T17:22:19Z",
  "closedAt": "2019-02-11T16:17:25Z",
  "author": {
    "login": "davkean"
  },
  "labels": [
    "bug",
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Related to #1577, maybe fix them both at the same time?",
        "createdAt": "2017-02-01T15:32:58Z",
        "updatedAt": "2017-02-01T15:32:58Z",
        "author": {
          "login": "jeffkl"
        }
      },
      {
        "body": "Unfortunately, like #1646 this is defined in `C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\Microsoft.WorkflowBuildExtensions.targets` which doesn't ship with MSBuild and would probably require a framework patch. We'll need to track down whoever owns workflow build internally.",
        "createdAt": "2017-02-01T16:26:44Z",
        "updatedAt": "2017-02-01T16:26:44Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Maybe we should set `$(GenerateCompiledExpressionsTempFile)` to `false`. \ud83d\ude01 \r\n\r\n```xml\r\n<Target Name =\"GenerateCompiledExpressionsTempFile\" \r\n        Condition = \"'$(GenerateCompiledExpressionsTempFilePathForEditing)' != ''\">  \r\n  <WriteLinesToFile\r\n    File=\"$(GenerateCompiledExpressionsTempFilePathForEditing)\" Condition = \"!Exists('$(GenerateCompiledExpressionsTempFilePathForEditing)')\" />\r\n  <WriteLinesToFile\r\n    File=\"$(GenerateCompiledExpressionsTempFilePathForValidation)\" Condition = \"!Exists('$(GenerateCompiledExpressionsTempFilePathForValidation)')\" />\r\n  <WriteLinesToFile\r\n    File=\"$(GenerateCompiledExpressionsTempFilePathForTypeInfer)\" Condition = \"!Exists('$(GenerateCompiledExpressionsTempFilePathForTypeInfer)')\" />\r\n  <ItemGroup>\r\n    <Compile Include=\"$(GenerateCompiledExpressionsTempFilePathForEditing)\" />\r\n    <Compile Include=\"$(GenerateCompiledExpressionsTempFilePathForValidation)\" />\r\n    <Compile Include=\"$(GenerateCompiledExpressionsTempFilePathForTypeInfer)\" />\r\n  </ItemGroup>  \r\n</Target>\r\n```",
        "createdAt": "2017-02-01T16:31:28Z",
        "updatedAt": "2017-02-01T16:31:28Z",
        "author": {
          "login": "jeffkl"
        }
      },
      {
        "body": "@Sarabeth-Jaffe-Microsoft can you please track down who owns this file and move this issue to then?",
        "createdAt": "2017-03-08T19:01:15Z",
        "updatedAt": "2017-03-08T19:01:15Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "Bug #392996 created in VSTS under the \"DevDiv\\Web Platform and Tools\\Workflow Tools\" area path.",
        "createdAt": "2017-03-08T19:37:37Z",
        "updatedAt": "2017-03-08T19:37:37Z",
        "author": {
          "login": "Sarabeth-Jaffe-Microsoft"
        }
      },
      {
        "body": "The plan is to fix this by fixing #1646.",
        "createdAt": "2019-02-11T16:17:25Z",
        "updatedAt": "2019-02-11T16:17:25Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "We were seeing this as well; it appears to be the root cause of causing our 1500 Solution Projects to rebuild upon opening Visual Studio; is there any temporary work around until the actual fix is shipped?",
        "createdAt": "2019-03-06T14:32:58Z",
        "updatedAt": "2019-03-06T14:32:58Z",
        "author": {
          "login": "aolszowka"
        }
      },
      {
        "body": "@aolszowka Unfortunately, the fix for creating the files (#1646) required a coordinated change between VS and MSBuild, so I don't think there's a good workaround for VS before 2019 preview 4.",
        "createdAt": "2019-03-06T15:46:54Z",
        "updatedAt": "2019-03-06T15:46:54Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@rainersigwald what about inserting the noop target into each one of the 1500 project files? I know that is a huge hammer; but this is really killing our Devs.",
        "createdAt": "2019-03-06T15:51:01Z",
        "updatedAt": "2019-03-06T15:51:01Z",
        "author": {
          "login": "aolszowka"
        }
      },
      {
        "body": "That would break VS, which depends on the existence of the files (before 16.0p4).",
        "createdAt": "2019-03-06T15:51:40Z",
        "updatedAt": "2019-03-06T15:51:40Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "When you say \"Break VS\" what do you mean? Is it a livable situation if we do not use Workflow (I do not believe we do; but maybe there is something I am missing here). I just tested it and as far as I can tell I am getting an incremental build now.\r\n\r\nThank you for all the hard work you've been doing your fixes on the Long Path are also fixing another issue that we're encountering wherein the state files previously were not being written (we're working around that too by putting our IntermediateOutputPath basically in to the root of the C Drive and then flattening it out from there). Long term we just need to get to VS19/MSB16, because it includes tons of these changes I know, but this is just absolutely killing us (60 Devs; 200 in the whole company).",
        "createdAt": "2019-03-06T16:01:49Z",
        "updatedAt": "2019-03-06T16:01:49Z",
        "author": {
          "login": "aolszowka"
        }
      },
      {
        "body": "> Is it a livable situation if we do not use Workflow (I do not believe we do; but maybe there is something I am missing here)\r\n\r\nI _think_ the breakage is limited to the Workflow designer, but I'm not totally confident in that.\r\n\r\n> your fixes on the Long Path\r\n\r\nCan't take much credit for this; ccastanedaucf did the actual work there. Also note that the changes there don't apply inside VS so you're likely to continue to need output-path gymnastics for a while yet.",
        "createdAt": "2019-03-06T16:05:12Z",
        "updatedAt": "2019-03-06T16:05:12Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}