{
  "number": 4754,
  "title": "ReferenceCopyLocalPaths no longer content NuGetSourceType metadata",
  "body": "### Steps to reproduce\r\n\r\nI encounter some missing metadata to `ReferenceCopyLocalPaths` item since migrating to `Microsoft.NET.Sdk` format in project files.\r\n\r\nLets consider the following project file :\r\n\r\n```xml\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n\r\n  <PropertyGroup>\r\n    <TargetFramework>net471</TargetFramework>\r\n  </PropertyGroup>\r\n\r\n  <ItemGroup>\r\n    <PackageReference Include=\"Newtonsoft.Json\" Version=\"12.0.2\" />\r\n  </ItemGroup>\r\n\r\n</Project>\r\n```\r\n\r\nI use the following code to print metadata from `ReferenceCopyLocalPaths` items : \r\n\r\n```xml\r\n  <UsingTask TaskName=\"GetMetadataTask\" TaskFactory=\"CodeTaskFactory\" AssemblyFile=\"$(MSBuildToolsPath)\\Microsoft.Build.Tasks.v4.0.dll\" >\r\n    <ParameterGroup>\r\n      <Items ParameterType=\"Microsoft.Build.Framework.ITaskItem[]\" Required=\"true\" />\r\n      <MetadataString Output=\"true\" />\r\n    </ParameterGroup>\r\n    <Task>\r\n      <Using Namespace=\"System\"/>\r\n      <Code Type=\"Fragment\" Language=\"cs\">\r\n        <![CDATA[\r\n            StringBuilder metadata = new StringBuilder();\r\n            foreach (var item in Items)\r\n            {\r\n                metadata.AppendFormat(\"{0}\\r\\n\", item);\r\n                foreach (string name in item.MetadataNames)\r\n                {\r\n                    metadata.AppendFormat(\"  {0}={1}\\r\\n\", name, item.GetMetadata(name));\r\n                }\r\n                metadata.AppendFormat(\"\\r\\n\");\r\n            }\r\n            MetadataString = metadata.ToString();\r\n        ]]>\r\n      </Code>\r\n    </Task>\r\n  </UsingTask>\r\n\r\n  <Target Name=\"_SetNuGetSourceTypeToCopyLocal\" AfterTargets=\"ResolveAssemblyReferences\">\r\n    <ItemGroup>\r\n      <PrintItems Include=\"@(ReferenceCopyLocalPaths)\" Condition=\"'%(ReferenceCopyLocalPaths.NuGetPackageId)' != ''\" />\r\n    </ItemGroup>\r\n    <GetMetadataTask Items=\"@(PrintItems)\">\r\n      <Output TaskParameter=\"MetadataString\" PropertyName=\"MyBeautifulMetadata\"/>\r\n    </GetMetadataTask>\r\n    <Message Importance=\"High\" Text=\"$(MyBeautifulMetadata)\" />\r\n  </Target>\r\n```\r\n\r\n### Expected  behavior\r\nWhen using old project files format, I had the following metadata : \r\n\r\n```txt\r\n  ItemName=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    NuGetPackageId=Newtonsoft.Json\r\n    NuGetPackageVersion=12.0.2\r\n    Private=false\r\n    NuGetIsFrameworkReference=false\r\n    NuGetSourceType=Package\r\n    FullPath=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    RootDir=C:\\\r\n    Filename=Newtonsoft.Json\r\n    Extension=.dll\r\n    RelativeDir=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\\r\n    Directory=Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\\r\n    RecursiveDir=\r\n    Identity=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    ModifiedTime=2019-04-22 01:06:16.0000000\r\n    CreatedTime=2019-09-18 10:16:19.6451378\r\n    AccessedTime=2019-09-18 10:16:19.6451378\r\n    DefiningProjectFullPath=C:\\MyBeautifulProject\\Project.csproj\r\n    DefiningProjectDirectory=C:\\MyBeautifulProject\\\r\n    DefiningProjectName=Project\r\n    DefiningProjectExtension=.csproj\r\n```\r\n\r\n### Actual behavior\r\n\r\nNow I get the following : \r\n\r\n```txt\r\nItemName=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    NuGetPackageId=Newtonsoft.Json\r\n    NuGetPackageVersion=12.0.2\r\n    FullPath=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    RootDir=C:\\\r\n    Filename=Newtonsoft.Json\r\n    Extension=.dll\r\n    RelativeDir=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\\r\n    Directory=Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\\r\n    RecursiveDir=\r\n    Identity=C:\\Users\\joel.tankam\\.nuget\\packages\\newtonsoft.json\\12.0.2\\lib\\net45\\Newtonsoft.Json.dll\r\n    ModifiedTime=2019-04-22 01:06:16.0000000\r\n    CreatedTime=2019-09-18 10:16:19.6451378\r\n    AccessedTime=2019-09-18 10:16:19.6451378\r\n    DefiningProjectFullPath=C:\\MyBeautifulProject\\Project.csproj\r\n    DefiningProjectDirectory=C:\\MyBeautifulProject\\\r\n    DefiningProjectName=Project\r\n    DefiningProjectExtension=.csproj\r\n```\r\n\r\nThe difference being the absence of : \r\n\r\n```txt\r\n    Private=false\r\n    NuGetIsFrameworkReference=false\r\n    NuGetSourceType=Package\r\n```\r\n\r\nHowever, I need the `NuGetSourceType` metadata in my build process. \r\nIs there please any reason why this this metadata disappeared ? Is there a way to set it back ?\r\n\r\nI currently use this custom target to set back `NuGetSourceType` :\r\n\r\n```xml\r\n  <Target Name=\"_SetNuGetSourceTypeToCopyLocal\" AfterTargets=\"ResolveReferences\">\r\n    <ItemGroup>\r\n      <ReferenceCopyLocalPaths Update=\"@(ReferenceCopyLocalPaths)\" Condition=\"'%(ReferenceCopyLocalPaths.NuGetPackageId)' != ''\">\r\n        <NuGetSourceType>Package</NuGetSourceType>\r\n      </ReferenceCopyLocalPaths>\r\n    </ItemGroup>\r\n  </Target>\r\n```\r\n\r\n### Environment data\r\n`msbuild /version` output: 15.9.21.664\r\n.NET Core SDK version : 2.2.108\r\nVisual Studio : Professional 2017, v 15.9.16\r\n",
  "state": "CLOSED",
  "createdAt": "2019-09-20T14:22:39Z",
  "updatedAt": "2024-02-21T17:06:58Z",
  "closedAt": "2019-09-20T15:02:43Z",
  "author": {
    "login": "joeltankam"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This issue was moved to dotnet/sdk#3662",
        "createdAt": "2019-09-20T15:02:41Z",
        "updatedAt": "2019-09-20T15:02:41Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}