{
  "number": 2403,
  "title": "MSBuild parameter /p:GenerateDocumentation=false getting ignored",
  "body": "Hi,\r\n\r\nI use TFS Build agen on premise and I have configured my solution build to include the MSBuild parameter /p:GenerateDocumentation=false (as this is an internally deployed solution). However I notice that the XML documentation files are still being generated by the Roslyn compiler.\r\n\r\nDo I need to use another MSBuild swith to (globally) disable the XML documentation generation?\r\n\r\nCommand line :\r\n\r\n\"D:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\msbuild.exe\" \"D:\\Agent1\\_work\\12\\s\\Build\\A\\Solutions\\MyBuild.sln\" /nologo /nr:false /dl:CentralLogger,\"D:\\Agent1\\_work\\_tasks\\VSBuild_71a9a2d3-a98a-4caa-96ab-affca411ecda\\1.119.0\\ps_modules\\MSBuildHelpers\\Microsoft.TeamFoundation.DistributedTask.MSBuild.Logger.dll\";\"RootDetailId=f4898fed-92af-4959-8a0a-a738cf06b707|SolutionDir=D:\\Agent1\\_work\\12\\s\\Build\\A\\Solutions\"*ForwardingLogger,\"D:\\Agent1\\_work\\_tasks\\VSBuild_71a9a2d3-a98a-4caa-96ab-affca411ecda\\1.119.0\\ps_modules\\MSBuildHelpers\\Microsoft.TeamFoundation.DistributedTask.MSBuild.Logger.dll\" /p:OutDir=D:\\Agent1\\_work\\12\\b\\MyBuild /p:AllowedReferenceRelatedFileExtensions=\".pdb\" /p:GenerateDocumentation=false /p:platform=\"Any CPU\" /p:configuration=\"Release\" /p:VisualStudioVersion=\"15.0\" /p:_MSDeployUserAgent=\"TFS_f34008ba-370e-492f-9e2b-88fef545c6c0_build_1073_50124\"\r\n\r\nIn the MSBuild output I find following info :\r\n\r\n```\r\nCoreCompile:\r\n  D:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Roslyn\\vbc.exe /noconfig /imports:Microsoft.VisualBasic,System,System.Collections,System.Collections.Generic,System.Data,System.Diagnostics,System.Linq,System.Xml.Linq /doc- /optioncompare:Binary /optionexplicit+ /optionstrict+ /optioninfer+ /nostdlib /rootnamespace:AA /sdkpath:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\" /highentropyva+ /doc:obj\\Release\\A.xml /define:\"CODE_ANALYSIS=-1,CONFIG=\\\"Release\\\",TRACE=-1,_MyType=\\\"Windows\\\",PLATFORM=\\\"AnyCPU\\\"\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.Core.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.Data.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.Runtime.Serialization.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.ServiceModel.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.Xml.dll\",\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.5.2\\System.Xml.Linq.dll\" /debug:pdbonly /filealign:512 /optimize+ /out:obj\\Release\\A.dll /subsystemversion:6.00 /resource:obj\\Release\\A.Resources.resources /target:library /utf8output MyCode.vb \"My Project\\AssemblyInfo.vb\" \"My Project\\Application.Designer.vb\" \"My Project\\Resources.Designer.vb\" \"My Project\\Settings.Designer.vb\" \"C:\\Users\\TFSBUILD\\AppData\\Local\\Temp\\.NETFramework,Version=v4.5.2.AssemblyAttributes.vb\" /warnaserror+:41999,42016,42017,42018,42019,42020,42021,42022,42032,42036\r\n  Using shared compilation with compiler from directory: D:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Professional\\MSBuild\\15.0\\Bin\\Roslyn\r\n  \r\nCopyFilesToOutputDirectory:\r\n  Copying file from \"obj\\Release\\A.dll\" to \"D:\\Agent1\\_work\\12\\b\\MyBuild\\A.dll\".\r\n  A -> D:\\Agent1\\_work\\12\\b\\MyBuild\\A.dll\r\n  Copying file from \"obj\\Release\\A.pdb\" to \"D:\\Agent1\\_work\\12\\b\\MyBuild\\A.pdb\".\r\n  Copying file from \"obj\\Release\\A.xml\" to \"D:\\Agent1\\_work\\12\\b\\MyBuild\\A.xml\".\r\n```\r\n\r\nWith kind regards,\r\nHans",
  "state": "CLOSED",
  "createdAt": "2017-08-07T09:48:06Z",
  "updatedAt": "2024-02-21T17:17:27Z",
  "closedAt": "2017-08-08T15:37:55Z",
  "author": {
    "login": "Styxxy"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "The documentation file is [created by the `Vbc` task](https://github.com/dotnet/roslyn/blob/606ebc96a3ac39195a37e228de4be87b6c55659d/src/Compilers/Core/MSBuildTask/Microsoft.VisualBasic.Core.targets#L86) if the item `DocFileItem` has a value. That [item is created](https://github.com/Microsoft/msbuild/blob/27f37c5126cf99f8a86ade04cf48c1535e5e7a28/src/Tasks/Microsoft.CSharp.CurrentVersion.targets#L156) if the property `$(DocumentationFile)` is defined. The default templates generally populate that property in the `.vbproj` file explicitly.\r\n\r\nYou could edit your project files to make the `DocumentationFile` definition conditional, if you wanted to, but there doesn't appear to be a built-in off switch if your projects declare that they want documentation.\r\n\r\nI don't see any reference in a preprocessed `.csproj` to a property named `GenerateDocumentation`. How did you find that? Did you see it in documentation somewhere?",
        "createdAt": "2017-08-07T19:15:02Z",
        "updatedAt": "2017-08-07T19:15:02Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "On the Common MSBuild project properties page ([https://docs.microsoft.com/en-us/visualstudio/msbuild/common-msbuild-project-properties](https://docs.microsoft.com/en-us/visualstudio/msbuild/common-msbuild-project-properties)) you can find the property GenerateDocumentation:\r\n\r\n> A boolean parameter that indicates whether documentation is generated by the build. If true, the build generates documentation information and puts it in an .xml file together with the name of the executable file or library that the build task created.\r\n\r\nTogether with the MSBuild command line reference ([https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-command-line-reference](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-command-line-reference)) speficiation that you can use `/p:name=value` to override project properties:\r\n\r\n> Set or override the specified project-level properties, where name is the property name and value is the property value. Specify each property separately, or use a semicolon or comma to separate multiple properties, as the following example shows:\r\n> \r\n> /property:WarningLevel=2;OutDir=bin\\Debug\r\n\r\nAnd thus, I expected that adding the `/p:GenerateDocumentation=false` to the MSBuild command, that no XML documentation files would be generated.",
        "createdAt": "2017-08-08T13:21:05Z",
        "updatedAt": "2017-08-08T13:21:05Z",
        "author": {
          "login": "Styxxy"
        }
      },
      {
        "body": "Thanks! That explains why I didn't see it: this is a Visual Basic-only parameter.\r\n\r\nI can see in your command line that the `Vbc` task _is_ passing `/doc-`, but it appears to be overridden by the (later) `/doc:obj\\Release\\A.xml`.\r\n\r\nThat task is built from the Roslyn repo so I'm going to move this bug over there. I also sent a PR to the docs repo to clarify when this property is used.",
        "createdAt": "2017-08-08T15:37:19Z",
        "updatedAt": "2017-08-08T15:37:19Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "This issue was moved to dotnet/roslyn#21371",
        "createdAt": "2017-08-08T15:37:55Z",
        "updatedAt": "2017-08-08T15:37:55Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@rainersigwald  Thanks for the clarification and directing this issue to the correct repo.",
        "createdAt": "2017-08-09T08:03:53Z",
        "updatedAt": "2017-08-09T08:03:53Z",
        "author": {
          "login": "Styxxy"
        }
      }
    ]
  }
}