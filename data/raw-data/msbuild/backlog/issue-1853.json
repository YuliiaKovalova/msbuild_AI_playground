{
  "number": 1853,
  "title": "MSBuild node crashes with MSB0001: Internal MSBuild Error: Items already exist ",
  "body": "MSBuild -version: 15.1.548.43366\r\n\r\n```\r\ngit clone https://github.com/AArnott/CodeGeneration.Roslyn.git\r\ncd CodeGeneration.Roslyn\r\ngit checkout bugrepro/msbuild/1853\r\ncd src\r\nmsbuild /v:minimal /nologo /nr:false /m /t:restore\r\nmsbuild /v:minimal /nologo /nr:false /m\r\n\r\n\r\n  CodeGeneration.Roslyn.Attributes -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Attributes\\Debug\\netstandard1.0\\CodeGeneration.Roslyn.Attributes.dll\r\n  CodeGeneration.Roslyn.Attributes -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Attributes\\Debug\\net40\\CodeGeneration.Roslyn.Attributes.dll\r\n  CodeGeneration.Roslyn.Attributes -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Attributes\\Debug\\net20\\CodeGeneration.Roslyn.Attributes.dll\r\n  CodeGeneration.Roslyn.Tests.RunBuild -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tests.RunBuild\\Debug\\net46\\CodeGeneration.Roslyn.Tests.RunBuild.dll\r\n  CodeGeneration.Roslyn -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn\\Debug\\netstandard1.3\\CodeGeneration.Roslyn.dll\r\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\d15rel\\MSBuild\\15.0\\bin\\Microsoft.Common.CurrentVersion.targets(1964,5): warning MSB3277: Found conflicts between different versions of the same dependent assembly that could not be resolved.  These reference conflicts are listed in the build log when log verbosity is set to detailed. [C:\\git\\CodeGeneration.Roslyn\\src\\CodeGeneration.Roslyn.Tasks.Helper\\CodeGeneration.Roslyn.Tasks.Helper.csproj]\r\n  CodeGeneration.Roslyn.Tests.Generators -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tests.Generators\\Debug\\netstandard1.3\\CodeGeneration.Roslyn.Tests.Generators.dll\r\n  CodeGeneration.Roslyn.Tasks.Helper -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tasks.Helper\\Debug\\net46\\CodeGeneration.Roslyn.Tasks.Helper.dll\r\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\d15rel\\MSBuild\\15.0\\bin\\Microsoft.Common.CurrentVersion.targets(1964,5): warning MSB3277: Found conflicts between different versions of the same dependent assembly that could not be resolved.  These reference conflicts are listed in the build log when log verbosity is set to detailed. [C:\\git\\CodeGeneration.Roslyn\\src\\CodeGeneration.Roslyn.Tasks\\CodeGeneration.Roslyn.Tasks.csproj]\r\n  CodeGeneration.Roslyn.Tasks.Helper -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tasks.Helper\\Debug\\netcoreapp1.0\\CodeGeneration.Roslyn.Tasks.Helper.dll\r\n  CodeGeneration.Roslyn.Tasks -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tasks\\Debug\\net46\\CodeGeneration.Roslyn.Tasks.dll\r\n  CodeGeneration.Roslyn.Tasks -> C:\\git\\CodeGeneration.Roslyn\\bin\\CodeGeneration.Roslyn.Tasks\\Debug\\netcoreapp1.0\\CodeGeneration.Roslyn.Tasks.dll\r\nMSBUILD : error MSB4166: Child node \"4\" exited prematurely. Shutting down. Diagnostic information may be found in files in the temporary files directory named MSBuild_*.failure.txt.\r\n```\r\n\r\n```\r\nUNHANDLED EXCEPTIONS FROM PROCESS 35252:\r\n=====================\r\n3/11/2017 7:44:44 AM\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Items already exist for target ResolveReferences.\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n   at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0)\r\n   at Microsoft.Build.Execution.BuildResult.AddResultsForTarget(String target, TargetResult result)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__22.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__11.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__57.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__49.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<RequestThreadProc>d__48.MoveNext()\r\n===================\r\n3/11/2017 7:44:44 AM\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Items already exist for target ResolveReferences.\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n   at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0)\r\n   at Microsoft.Build.Execution.BuildResult.AddResultsForTarget(String target, TargetResult result)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__22.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__11.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__57.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__49.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<RequestThreadProc>d__48.MoveNext()\r\n===================\r\n```",
  "state": "CLOSED",
  "createdAt": "2017-03-11T15:51:03Z",
  "updatedAt": "2024-02-21T17:20:53Z",
  "closedAt": "2017-05-22T17:40:16Z",
  "author": {
    "login": "AArnott"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": {
    "title": "MSBuild 15.3"
  },
  "comments": {
    "nodes": [
      {
        "body": "dupe of https://github.com/Microsoft/msbuild/issues/1808 ?",
        "createdAt": "2017-03-22T03:47:40Z",
        "updatedAt": "2017-03-22T03:47:40Z",
        "author": {
          "login": "danmoseley"
        }
      }
    ]
  }
}