{
  "number": 10956,
  "title": "Flaky test - ReportsSimpleTaskParameters",
  "body": "I've noticed on our pipelines we have a test that fails at random, it is frequent enough to bother during PRs. \n\nThe failing test is: `Microsoft.Build.BuildCheck.UnitTests.TaskInvocationCheckDataTests.ReportsSimpleTaskParameters` during a `Windows Full` run of our PR pipeline. It also seems to fail during test clean-up and not at the test itself.\n\n### Stack trace\n```\nat Microsoft.Build.UnitTests.BuildFailureLogInvariant.AssertInvariant(ITestOutputHelper output) in /_/src/UnitTests.Shared/TestEnvironment.cs:line 533\nat Microsoft.Build.UnitTests.TestEnvironment.Cleanup() in src/UnitTests.Shared/TestEnvironment.cs:line 99\nat Microsoft.Build.UnitTests.TestEnvironment.Dispose() in src/UnitTests.Shared/TestEnvironment.cs:line 72\nat Microsoft.Build.BuildCheck.UnitTests.TaskInvocationCheckDataTests.BuildProject(String taskInvocation) in src\\BuildCheck.UnitTests\\TaskInvocationAnalysisDataTests.cs:line 109\nat Microsoft.Build.BuildCheck.UnitTests.TaskInvocationCheckDataTests.ReportsSimpleTaskParameters() in src\\BuildCheck.UnitTests\\TaskInvocationAnalysisDataTests.cs:line 115\n```",
  "state": "OPEN",
  "createdAt": "2024-11-08T12:50:41Z",
  "updatedAt": "2024-11-19T15:23:51Z",
  "closedAt": null,
  "author": {
    "login": "maridematte"
  },
  "labels": [
    "flaky-test",
    "Priority:1",
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This failure is a result of this upstream failure (from attachments):\n\n```\nBuild Error File MSBuild_pid-6040_50fe91d894c1450d95a1391f680ee8c4.failure.txt: UNHANDLED EXCEPTIONS FROM PROCESS 6040:\n=====================\n11/7/2024 9:17:51 PM\nSystem.NullReferenceException: Object reference not set to an instance of an object.\n   at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)\n   at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckManagerProvider.BuildCheckManager.ProcessProjectEvaluationStarted(ICheckContext checkContext, String projectFullPath) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckManagerProvider.cs:line 544\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleProjectEvaluationStartedEvent(ProjectEvaluationStartedEventArgs eventArgs) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 93\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.<.ctor>b__5_2(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 33\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleBuildEvent(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 59\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckConnectorLogger.EventSource_AnyEventRaised(Object sender, BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckConnectorLogger.cs:line 62\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 388\n===================\n11/7/2024 9:17:51 PM\nMicrosoft.Build.Exceptions.InternalLoggerException: The build stopped unexpectedly because of an unexpected logger failure. ---> System.NullReferenceException: Object reference not set to an instance of an object.\n   at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)\n   at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckManagerProvider.BuildCheckManager.ProcessProjectEvaluationStarted(ICheckContext checkContext, String projectFullPath) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckManagerProvider.cs:line 544\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleProjectEvaluationStartedEvent(ProjectEvaluationStartedEventArgs eventArgs) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 93\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.<.ctor>b__5_2(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 33\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleBuildEvent(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 59\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckConnectorLogger.EventSource_AnyEventRaised(Object sender, BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckConnectorLogger.cs:line 62\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 388\n   --- End of inner exception stack trace ---\n   at Microsoft.Build.Exceptions.InternalLoggerException.Throw(Exception innerException, BuildEventArgs e, String messageResourceName, Boolean initializationException, String[] messageArgs) in /_/src/Build/Errors/InternalLoggerException.cs:line 253\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 419\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseEvent[TArgs](TArgs buildEvent, ArgsHandler`1 handler, ArgsHandler`1 followUpHandler) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 371\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.Consume(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 273\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.Consume(BuildEventArgs buildEvent, Int32 sinkId) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 216\n   at Microsoft.Build.BackEnd.Logging.EventRedirectorToSink.Microsoft.Build.Framework.IEventRedirector.ForwardEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventRedirectorToSink.cs:line 57\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckForwardingLogger.EventSource_AnyEventRaised(Object sender, BuildEventArgs buildEvent) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckForwardingLogger.cs:line 56\n   at Microsoft.Build.Framework.AnyEventHandler.Invoke(Object sender, BuildEventArgs e)\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 388\n===================\n11/7/2024 9:17:51 PM\nMicrosoft.Build.Exceptions.InternalLoggerException: The build stopped unexpectedly because of an unexpected logger failure. ---> Microsoft.Build.Exceptions.InternalLoggerException: The build stopped unexpectedly because of an unexpected logger failure. ---> System.NullReferenceException: Object reference not set to an instance of an object.\n   at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)\n   at System.Collections.Generic.Dictionary`2.Add(TKey key, TValue value)\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckManagerProvider.BuildCheckManager.ProcessProjectEvaluationStarted(ICheckContext checkContext, String projectFullPath) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckManagerProvider.cs:line 544\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleProjectEvaluationStartedEvent(ProjectEvaluationStartedEventArgs eventArgs) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 93\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.<.ctor>b__5_2(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 33\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckBuildEventHandler.HandleBuildEvent(BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckBuildEventHandler.cs:line 59\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckConnectorLogger.EventSource_AnyEventRaised(Object sender, BuildEventArgs e) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckConnectorLogger.cs:line 62\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 388\n   --- End of inner exception stack trace ---\n   at Microsoft.Build.Exceptions.InternalLoggerException.Throw(Exception innerException, BuildEventArgs e, String messageResourceName, Boolean initializationException, String[] messageArgs) in /_/src/Build/Errors/InternalLoggerException.cs:line 253\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 419\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseEvent[TArgs](TArgs buildEvent, ArgsHandler`1 handler, ArgsHandler`1 followUpHandler) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 371\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.Consume(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 273\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.Consume(BuildEventArgs buildEvent, Int32 sinkId) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 216\n   at Microsoft.Build.BackEnd.Logging.EventRedirectorToSink.Microsoft.Build.Framework.IEventRedirector.ForwardEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventRedirectorToSink.cs:line 57\n   at Microsoft.Build.Experimental.BuildCheck.Infrastructure.BuildCheckForwardingLogger.EventSource_AnyEventRaised(Object sender, BuildEventArgs buildEvent) in /_/src/Build/BuildCheck/Infrastructure/BuildCheckForwardingLogger.cs:line 56\n   at Microsoft.Build.Framework.AnyEventHandler.Invoke(Object sender, BuildEventArgs e)\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 388\n   --- End of inner exception stack trace ---\n   at Microsoft.Build.Exceptions.InternalLoggerException.Throw(Exception innerException, BuildEventArgs e, String messageResourceName, Boolean initializationException, String[] messageArgs) in /_/src/Build/Errors/InternalLoggerException.cs:line 253\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseAnyEvent(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 419\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.RaiseEvent[TArgs](TArgs buildEvent, ArgsHandler`1 handler, ArgsHandler`1 followUpHandler) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 371\n   at Microsoft.Build.BackEnd.Logging.EventSourceSink.Consume(BuildEventArgs buildEvent) in /_/src/Build/BackEnd/Components/Logging/EventSourceSink.cs:line 273\n   at Microsoft.Build.BackEnd.Logging.LoggingService.RouteBuildEvent(BuildEventArgs eventArg) in /_/src/Build/BackEnd/Components/Logging/LoggingService.cs:line 1732\n   at Microsoft.Build.BackEnd.Logging.LoggingService.RouteBuildEvent(Object loggingEvent) in /_/src/Build/BackEnd/Components/Logging/LoggingService.cs:line 1687\n   at Microsoft.Build.BackEnd.Logging.LoggingService.LoggingEventProcessor(Object loggingEvent) in /_/src/Build/BackEnd/Components/Logging/LoggingService.cs:line 1520\n===================\n\n```",
        "createdAt": "2024-11-08T16:20:16Z",
        "updatedAt": "2024-11-08T16:20:16Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Still happening.",
        "createdAt": "2024-11-19T15:23:28Z",
        "updatedAt": "2024-11-19T15:23:28Z",
        "author": {
          "login": "maridematte"
        }
      }
    ]
  }
}