{
  "number": 455,
  "title": "MSB0001: Internal MSBuild Error: Node does not have a provider. ",
  "body": "We got a report of an intermittent msbuild failure (~once every 2 weeks) with the following message: \n\n```\nUNHANDLED EXCEPTIONS FROM PROCESS 4544: \n===================== \n\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider. \nat Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary) \nat Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine) \nat Microsoft.Build.CommandLine.MSBuildApp.Main() \n=================== \n```\n\nContext details: 6 C# projects, built on VS2015. The solution is a VS2010 solution with target .net 4.0.\n\nCmdline (with replaced project names): \nExecuting the command cmd.exe /C \" \"C:\\Program Files (x86)\\MSBuild\\14.0\\Bin\\msbuild.exe\" /t:Clean,Build /P:Configuration=Release;Platform=x86 /maxcpucount ProjectFolder\\Project.sln \" && exit %%ERRORLEVEL%% from H:\\Jenkins\\workspace\\Dev_Build \n[Dev_Build] $ cmd.exe /C \" \"C:\\Program Files (x86)\\MSBuild\\14.0\\Bin\\msbuild.exe\" /t:Clean,Build /P:Configuration=Release;Platform=x86 /maxcpucount ProjectFolder\\Project.sln \" && exit %%ERRORLEVEL%% \n",
  "state": "OPEN",
  "createdAt": "2016-01-29T17:35:01Z",
  "updatedAt": "2025-03-20T09:59:28Z",
  "closedAt": null,
  "author": {
    "login": "cdmihai"
  },
  "milestone": null,
  "assignees": {
    "nodes": []
  },
  "labels": [
    "bug",
    "help wanted",
    "triaged"
  ],
  "comments": {
    "nodes": [
      {
        "body": "I looked over the code to see how a node can get to have a null provider.\n\nIt seems possible to get into this state. One would have to:\n- Shutdown a node (BuildManager.Shutdown())\n- Send message to that node (BuildManager.PerformActions(), which at some point leads to NodeManager.SendData())\n\nI also saw some potential concurrency concerns that might lead to this interleaving:\n- Escaped node ints: When a node is created, an int token is created as a reference for that node. The node manager just seems to accept these tokens without validation, and I did not find code that invalidates an int node reference. In consequence, it could be possible to have an escaped int token representing a node that was shut down still circulating in the node manager and build manager.\n- NodeManager._NodesShutdown is not volatile. Are the possible callers confined to the same thread? If not, stale cache values of this boolean could cause missed shutdown messages to node manager. This could lead to messages being passed to nodes after shutdown.\n- BuildManager._ShuttingDown is not volatile. Same story as above. Accessed without a lock in BuildManager.Reset()\n- There's use of non thread safe collections (_activeNodes field in BuildManager)\n\nNext steps: \n- see if we can write a unit test invoking the BuildManager with the above steps that exposes this interleaving\n",
        "createdAt": "2016-01-29T17:36:17Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "New dump with stack available in internal issue: https://devdiv.visualstudio.com/DevDiv/_workitems?id=229584&_a=edit\n\nSummary of interesting things from the stack:\n**InProcNode**:\n\n```\n-       this    {Microsoft.Build.BackEnd.InProcNode}    Microsoft.Build.BackEnd.InProcNode\n+       buildRequestEngine  {Microsoft.Build.BackEnd.BuildRequestEngine}    Microsoft.Build.BackEnd.IBuildRequestEngine {Microsoft.Build.BackEnd.BuildRequestEngine}\n+       componentHost   {Microsoft.Build.Execution.BuildManager}    Microsoft.Build.BackEnd.IBuildComponentHost {Microsoft.Build.Execution.BuildManager}\n+       configurationProjectsLoaded Count = 0   System.Collections.Generic.HashSet<Microsoft.Build.Shared.NGen<int>>\n+       currentConfiguration    {Microsoft.Build.BackEnd.NodeConfiguration} Microsoft.Build.BackEnd.NodeConfiguration\n+       engineExceptionEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.EngineExceptionDelegate\n        loggingContext  null    Microsoft.Build.BackEnd.Logging.NodeLoggingContext\n+       newConfigurationRequestEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.NewConfigurationRequestDelegate\n+       nodeEndpoint    {Microsoft.Build.BackEnd.NodeEndpointInProc}    Microsoft.Build.BackEnd.INodeEndpoint {Microsoft.Build.BackEnd.NodeEndpointInProc}\n+       packetReceivedEvent {System.Threading.AutoResetEvent}   System.Threading.AutoResetEvent\n+       receivedPackets Count = 0   System.Collections.Generic.Queue<Microsoft.Build.BackEnd.INodePacket>\n+       requestBlockedEventHandler  {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.RequestBlockedDelegate\n+       requestCompleteEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.RequestCompleteDelegate\n        savedCurrentDirectory\n+       savedEnvironment    Count = 76  System.Collections.Generic.IDictionary<string, string> {System.Collections.Generic.Dictionary<string, string>}\n+       shutdownEvent   {System.Threading.AutoResetEvent}   System.Threading.AutoResetEvent\n+       shutdownException   null    System.Exception\n        shutdownReason  BuildCompleteReuse  Microsoft.Build.Execution.NodeEngineShutdownReason\n```\n\n**NodeProviderInProc**:\n\n```\n-       this    {Microsoft.Build.BackEnd.NodeProviderInProc}    Microsoft.Build.BackEnd.NodeProviderInProc\n        AvailableNodes  1   int\n        ProviderType    InProc  Microsoft.Build.BackEnd.NodeProviderType\n        componentHost   null    Microsoft.Build.BackEnd.IBuildComponentHost\n        disposed    true    bool\n+       endpointConnectedEvent  null    System.Threading.AutoResetEvent\n        exclusiveOperatingEnvironment   false   bool\n        inProcNode  null    Microsoft.Build.BackEnd.INode\n+       inProcNodeEndpoint  {Microsoft.Build.BackEnd.NodeEndpointInProc}    Microsoft.Build.BackEnd.INodeEndpoint {Microsoft.Build.BackEnd.NodeEndpointInProc}\n        inProcNodeId    0   int\n+       inProcNodeOwningOperatingEnvironment    null    System.Threading.Semaphore\n+       inProcNodeThread    {System.Threading.Thread}   System.Threading.Thread\n+       packetFactory   {Microsoft.Build.BackEnd.NodeManager}   Microsoft.Build.BackEnd.INodePacketFactory {Microsoft.Build.BackEnd.NodeManager}\n+       Static members      \n```\n\nBuildManager:\n\n```\n-       componentHost   {Microsoft.Build.Execution.BuildManager}    Microsoft.Build.BackEnd.IBuildComponentHost {Microsoft.Build.Execution.BuildManager}\n+       Microsoft.Build.BackEnd.IBuildComponentHost.BuildParameters {Microsoft.Build.Execution.BuildParameters} Microsoft.Build.Execution.BuildParameters\n+       Microsoft.Build.BackEnd.IBuildComponentHost.LegacyThreadingData {Microsoft.Build.Execution.LegacyThreadingData} Microsoft.Build.Execution.LegacyThreadingData\n+       Microsoft.Build.BackEnd.IBuildComponentHost.LoggingService  'this.componentHost.LoggingService' threw an exception of type 'System.NullReferenceException'  Microsoft.Build.BackEnd.Logging.ILoggingService {System.NullReferenceException}\n        Microsoft.Build.BackEnd.IBuildComponentHost.Name    \"Default\"   string\n        acquiredProjectRootElementCacheFromProjectInstance  false   bool\n+       activeNodes Count = 0   System.Collections.Generic.HashSet<Microsoft.Build.Shared.NGen<int>>\n        buildManagerState   Idle    Microsoft.Build.Execution.BuildManager.BuildManagerState\n+       buildParameters {Microsoft.Build.Execution.BuildParameters} Microsoft.Build.Execution.BuildParameters\n+       buildSubmissions    Count = 0   System.Collections.Generic.Dictionary<int, Microsoft.Build.Execution.BuildSubmission>\n+       componentFactories  {Microsoft.Build.BackEnd.BuildComponentFactoryCollection}   Microsoft.Build.BackEnd.BuildComponentFactoryCollection\n+       configCache {Microsoft.Build.BackEnd.ConfigCache}   Microsoft.Build.BackEnd.IConfigCache {Microsoft.Build.BackEnd.ConfigCache}\n        disposed    true    bool\n        hostName    \"Default\"   string\n+       legacyThreadingData {Microsoft.Build.Execution.LegacyThreadingData} Microsoft.Build.Execution.LegacyThreadingData\n+       loggingThreadExceptionEventHandler  {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.Logging.LoggingExceptionDelegate\n        nextBuildSubmissionId   1   int\n        nextUnnamedProjectId    1   int\n+       noActiveSubmissionsEvent    null    System.Threading.AutoResetEvent\n+       noNodesActiveEvent  null    System.Threading.AutoResetEvent\n        nodeConfiguration   null    Microsoft.Build.BackEnd.NodeConfiguration\n+       nodeIdToKnownConfigurations Count = 0   System.Collections.Generic.Dictionary<Microsoft.Build.Shared.NGen<int>, System.Collections.Generic.HashSet<Microsoft.Build.Shared.NGen<int>>>\n        nodeManager null    Microsoft.Build.BackEnd.INodeManager\n        overallBuildSuccess true    bool\n+       projectFinishedEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.Framework.ProjectFinishedEventHandler\n+       projectStartedEventHandler  {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.Framework.ProjectStartedEventHandler\n+       projectStartedEvents    Count = 0   System.Collections.Generic.Dictionary<int, Microsoft.Build.Framework.BuildEventArgs>\n+       resultsCache    {Microsoft.Build.BackEnd.ResultsCache}  Microsoft.Build.BackEnd.IResultsCache {Microsoft.Build.BackEnd.ResultsCache}\n        scheduler   null    Microsoft.Build.BackEnd.IScheduler\n        shuttingDown    false   bool\n        syncLock    {object}    object\n+       taskHostNodeManager {Microsoft.Build.BackEnd.TaskHostNodeManager}   Microsoft.Build.BackEnd.INodeManager {Microsoft.Build.BackEnd.TaskHostNodeManager}\n+       threadException {\"MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\"}   System.Exception {Microsoft.Build.Shared.InternalErrorException}\n+       unnamedProjectInstanceToNames   Count = 0   System.Collections.Generic.Dictionary<Microsoft.Build.Execution.ProjectInstance, string>\n        workQueue   null    System.Threading.Tasks.Dataflow.ActionBlock<System.Action>\n+       Static members      \n+       configurationProjectsLoaded Count = 0   System.Collections.Generic.HashSet<Microsoft.Build.Shared.NGen<int>>\n+       currentConfiguration    {Microsoft.Build.BackEnd.NodeConfiguration} Microsoft.Build.BackEnd.NodeConfiguration\n+       engineExceptionEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.EngineExceptionDelegate\n        loggingContext  null    Microsoft.Build.BackEnd.Logging.NodeLoggingContext\n+       newConfigurationRequestEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.NewConfigurationRequestDelegate\n+       nodeEndpoint    {Microsoft.Build.BackEnd.NodeEndpointInProc}    Microsoft.Build.BackEnd.INodeEndpoint {Microsoft.Build.BackEnd.NodeEndpointInProc}\n+       packetReceivedEvent {System.Threading.AutoResetEvent}   System.Threading.AutoResetEvent\n+       receivedPackets Count = 0   System.Collections.Generic.Queue<Microsoft.Build.BackEnd.INodePacket>\n+       requestBlockedEventHandler  {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.RequestBlockedDelegate\n+       requestCompleteEventHandler {Method = Inspecting the state of an object in the debuggee of type System.Delegate is not supported while minidump debugging.} Microsoft.Build.BackEnd.RequestCompleteDelegate\n        savedCurrentDirectory   \"H:\\\\Jenkins\\\\workspace\\\\GUI_1.4.0.0_Dev_Build\" string\n+       savedEnvironment    Count = 76  System.Collections.Generic.IDictionary<string, string> {System.Collections.Generic.Dictionary<string, string>}\n+       shutdownEvent   {System.Threading.AutoResetEvent}   System.Threading.AutoResetEvent\n+       shutdownException   null    System.Exception\n        shutdownReason  BuildCompleteReuse  Microsoft.Build.Execution.NodeEngineShutdownReason\n```\n\nBuildManager has shuttingDown = False, nodeManager = null, disposed = true, and buildManagerState = Idle suggests that BuildManager.Reset was called. This only gets call on EndBuild, which looks like it's called from the command line after the build finished.\n",
        "createdAt": "2016-06-29T00:53:24Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "We have been getting this same issue intermittently as well.  Any updates? or if it has been fixed in a newer version? \r\n```\r\n **********************************************************************\r\n\r\n\r\n** Visual Studio 2017 Developer Command Prompt v15.6.4\r\n\r\n\r\n** Copyright (c) 2017 Microsoft Corporation\r\n\r\n\r\n**********************************************************************\r\n\r\n\r\nMSBUILD : error MSB4166: Child node \"4\" exited prematurely. Shutting down. Diagnostic information may be found in files in the temporary files directory named MSBuild_*.failure.txt.\r\n\r\n\r\n\r\n\r\n\r\nBuild succeeded.\r\n\r\n\r\n    0 Warning(s)\r\n\r\n\r\n    1 Error(s)\r\n\r\n\r\n\r\n\r\n\r\nTime Elapsed 00:00:01.15\r\n\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\n\r\n\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 4 does not have a provider.\r\n\r\n\r\n   at Microsoft.Build.Execution.BuildManager.EndBuild()\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler)\r\n\r\n\r\n\r\n\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\n\r\n\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 4 does not have a provider.\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler)\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n\r\n\r\n\r\n\r\n\r\n\r\nUnhandled Exception: Microsoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 4 does not have a provider.\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean debugger, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler)\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n\r\n\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n\r\n```",
        "createdAt": "2018-06-21T19:58:07Z",
        "author": {
          "login": "wilstoff"
        }
      },
      {
        "body": "@wilstoff It hasn't been fixed. Do you have a repro you can zip up and attach here?",
        "createdAt": "2018-06-21T21:45:17Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "Nothing i can attach, all work related code.  It's in a code base with about 95 solutions, that we build in parallel tiers based on dependencies.  So it could be something where we are calling msbuild too many times from one box in parallel (even if for different solutions).  It's not easily recreate-able and we have since lost any data from this particular build.",
        "createdAt": "2018-06-21T22:25:04Z",
        "author": {
          "login": "wilstoff"
        }
      },
      {
        "body": "Got the same problem:\r\n```\r\nUNHANDLED EXCEPTIONS FROM PROCESS 716:\r\n=====================\r\n1/18/2019 8:28:43 PM\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n===================\r\n```\r\nMicrosoft Visual Studio Professional 2017 \r\nVersion 15.9.4\r\nVisualStudio.15.Release/15.9.4+28307.222",
        "createdAt": "2019-01-18T15:46:49Z",
        "author": {
          "login": "vok1980"
        }
      },
      {
        "body": "Is there any workaround for it?",
        "createdAt": "2019-01-18T15:47:28Z",
        "author": {
          "login": "vok1980"
        }
      },
      {
        "body": "@vok1980 turning off parallel builds would probably fix it. If you have a consistent repro, feel free to share it.",
        "createdAt": "2019-01-18T17:29:31Z",
        "author": {
          "login": "cdmihai"
        }
      },
      {
        "body": "I had a problem with sequential builds on CI. Looks like msbuild does not finish process after build immediately and some collision with next build happens. \r\nAnd I found that option `/nodeReuse:false`  solves the problem.",
        "createdAt": "2019-01-18T19:30:11Z",
        "author": {
          "login": "vok1980"
        }
      },
      {
        "body": "> msbuild does not finish process after build immediately\r\n\r\nTrue, when `/nodeReuse:true` (which is the default).\r\n\r\n> some collision with next build happens\r\n\r\nThat shouldn't happen, and doesn't in most cases. If you can narrow down any repro steps, we'd love to know them so we can fix the bug.",
        "createdAt": "2019-01-18T21:08:51Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Unfortunately, the only thing I can tell you about my project that its rather big. Build time is about 1h40m with 8 cores & 16G mem. And it does not matter if builds are taking place on the same workspace or separate workspaces. Hope, it can help you.",
        "createdAt": "2019-01-21T05:10:51Z",
        "author": {
          "login": "vok1980"
        }
      },
      {
        "body": "@vok1980 I'm seeing the issue too and haven't tried /nodeReuse:false yet.  But how confident are you that this setting fixes it?  I only ask if it was intermittent and hard to reproduce if you've just gotten lucky so far.",
        "createdAt": "2019-02-02T00:22:16Z",
        "author": {
          "login": "williambrode"
        }
      },
      {
        "body": "@williambrode It was 100% reproducing in my case. Now its 0% reproducing for a long time in the same case. ",
        "createdAt": "2019-02-03T05:39:05Z",
        "author": {
          "login": "vok1980"
        }
      },
      {
        "body": "If your build time is that long, `/nodeReuse:false` would not affect perf measurably. It's an optimization for very quick, probably up to date builds of one or two projects.\r\n\r\nIf it's in VS, I am not sure whether VS now has a setting to disable node reuse, it used to be accomplished by setting an env var MSBUILDDISABLENODEREUSE=1.",
        "createdAt": "2019-02-04T21:22:22Z",
        "author": {
          "login": "danmoseley"
        }
      },
      {
        "body": "Hi everyone, \r\nI got a consistent repro when enabling /graph on our root node project (with or without /nr:false)\r\n\r\n```\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n   at Microsoft.Build.BackEnd.NodeManager.SendData(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.PerformSchedulingActions(IEnumerable`1 responses)\r\n   at Microsoft.Build.Execution.BuildManager.ProcessPacket(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.ProcessWorkQueue(Action action)\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.Execution.BuildManager.EndBuild()\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, Boolean graphBuild, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, Boolean graphBuild, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n\r\nUnhandled Exception: Microsoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, Boolean graphBuild, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n\r\n------\r\n\r\n0:000> k\r\n # Child-SP          RetAddr               Call Site\r\n00 00000040`4ddfb940 00007ff8`3c5b0105     KERNELBASE!RaiseException+0x69 [minkernel\\kernelbase\\xcpt.c @ 937] \r\n01 00000040`4ddfba20 00007ff8`3c5b8847     clr!RaiseTheExceptionInternalOnly+0x31f [f:\\dd\\ndp\\clr\\src\\vm\\excep.cpp @ 3065] \r\n02 00000040`4ddfbb40 00007fff`fce51aa9     clr!IL_Rethrow+0xb7 [f:\\dd\\ndp\\clr\\src\\vm\\jithelpers.cpp @ 5179] \r\n03 00000040`4ddfbc90 00007ff8`3c5aee12     MSBuild_ni!Microsoft.Build.CommandLine.MSBuildApp.Execute+0xd99 [/_/src/MSBuild/XMake.cs @ 808] \r\n04 00000040`4ddfbdd0 00007ff8`3c5aece8     clr!ExceptionTracker::CallHandler+0xee [f:\\dd\\ndp\\clr\\src\\vm\\exceptionhandling.cpp @ 3323] \r\n05 00000040`4ddfbe80 00007ff8`3c5aebee     clr!ExceptionTracker::CallCatchHandler+0x9c [f:\\dd\\ndp\\clr\\src\\vm\\exceptionhandling.cpp @ 547] \r\n06 00000040`4ddfbf20 00007ff8`4907138f     clr!ProcessCLRException+0x31c [f:\\dd\\ndp\\clr\\src\\vm\\exceptionhandling.cpp @ 1062] \r\n07 00000040`4ddfc000 00007ff8`48ff1d19     ntdll!RtlpExecuteHandlerForUnwind+0xf [minkernel\\ntos\\rtl\\amd64\\xcptmisc.asm @ 254] \r\n08 00000040`4ddfc030 00007ff8`3c5afac0     ntdll!RtlUnwindEx+0x339 [minkernel\\ntos\\rtl\\amd64\\exdsptch.c @ 1425] \r\n09 00000040`4ddfc750 00007ff8`3c5afa7e     clr!ClrUnwindEx+0x40 [f:\\dd\\ndp\\clr\\src\\vm\\exceptionhandling.cpp @ 4298] \r\n0a 00000040`4ddfcc70 00007ff8`4907130f     clr!ProcessCLRException+0x2e9 [f:\\dd\\ndp\\clr\\src\\vm\\exceptionhandling.cpp @ 1025] \r\n0b 00000040`4ddfcd50 00007ff8`4901b5e4     ntdll!RtlpExecuteHandlerForException+0xf [minkernel\\ntos\\rtl\\amd64\\xcptmisc.asm @ 132] \r\n0c 00000040`4ddfcd80 00007ff8`4901b335     ntdll!RtlDispatchException+0x244 [minkernel\\ntos\\rtl\\amd64\\exdsptch.c @ 595] \r\n0d 00000040`4ddfd490 00007ff8`46a6d759     ntdll!RtlRaiseException+0x185 [minkernel\\ntos\\rtl\\amd64\\raise.c @ 194] \r\n0e 00000040`4ddfe340 00007ff8`3c5b0105     KERNELBASE!RaiseException+0x69 [minkernel\\kernelbase\\xcpt.c @ 937] \r\n0f 00000040`4ddfe420 00007ff8`3c5b0c14     clr!RaiseTheExceptionInternalOnly+0x31f [f:\\dd\\ndp\\clr\\src\\vm\\excep.cpp @ 3065] \r\n10 00000040`4ddfe540 00007fff`fce52a60     clr!IL_Throw+0x114 [f:\\dd\\ndp\\clr\\src\\vm\\jithelpers.cpp @ 5148] \r\n11 00000040`4ddfe6f0 00007fff`fce513c1     MSBuild_ni!Microsoft.Build.CommandLine.MSBuildApp.BuildProject+0xd40 [/_/src/MSBuild/XMake.cs @ 1280] \r\n12 00000040`4ddfe8a0 00007fff`fce50256     MSBuild_ni!Microsoft.Build.CommandLine.MSBuildApp.Execute+0x6b1 [/_/src/MSBuild/XMake.cs @ 651] \r\n13 00000040`4ddfeb00 00007ff8`3c3f6913     MSBuild_ni!Microsoft.Build.CommandLine.MSBuildApp.Main+0x66 [/_/src/MSBuild/XMake.cs @ 221] \r\n14 00000040`4ddfeb40 00007ff8`3c3f6824     clr!CallDescrWorkerInternal+0x83 [f:\\dd\\ndp\\clr\\src\\vm\\amd64\\CallDescrWorkerAMD64.asm @ 97] \r\n15 00000040`4ddfeb80 00007ff8`3c3f70d8     clr!CallDescrWorkerWithHandler+0x4e [f:\\dd\\ndp\\clr\\src\\vm\\callhelpers.cpp @ 89] \r\n16 00000040`4ddfebc0 00007ff8`3c50b557     clr!MethodDescCallSite::CallTargetWorker+0x102 [f:\\dd\\ndp\\clr\\src\\vm\\callhelpers.cpp @ 655] \r\n17 (Inline Function) --------`--------     clr!MethodDescCallSite::Call_RetArgSlot+0x5 [f:\\dd\\ndp\\clr\\src\\vm\\callhelpers.h @ 423] \r\n18 00000040`4ddfecc0 00007ff8`3c50bdf7     clr!RunMain+0x266 [f:\\dd\\ndp\\clr\\src\\vm\\assembly.cpp @ 2674] \r\n19 00000040`4ddfeea0 00007ff8`3c50bcab     clr!Assembly::ExecuteMainMethod+0xb7 [f:\\dd\\ndp\\clr\\src\\vm\\assembly.cpp @ 2795] \r\n1a 00000040`4ddff190 00007ff8`3c50b5f4     clr!SystemDomain::ExecuteMainMethod+0x643 [f:\\dd\\ndp\\clr\\src\\vm\\appdomain.cpp @ 3755] \r\n1b 00000040`4ddff790 00007ff8`3c50b34d     clr!ExecuteEXE+0x3f [f:\\dd\\ndp\\clr\\src\\vm\\ceemain.cpp @ 3053] \r\n1c 00000040`4ddff800 00007ff8`3c50c534     clr!_CorExeMainInternal+0xb2 [f:\\dd\\ndp\\clr\\src\\vm\\ceemain.cpp @ 2887] \r\n1d 00000040`4ddff890 00007ff8`3cec8c01     clr!_CorExeMain+0x14 [f:\\dd\\ndp\\clr\\src\\vm\\ceemain.cpp @ 2814] \r\n1e 00000040`4ddff8d0 00007ff8`3d14ac42     mscoreei!_CorExeMain+0x112 [f:\\dd\\ndp\\clr\\src\\dlls\\shim\\shim.cpp @ 6425] \r\n1f 00000040`4ddff930 00007ff8`487f7034     MSCOREE!_CorExeMain_Exported+0x72 [onecore\\com\\netfx\\windowsbuilt\\shell_shim\\v2api.cpp @ 1223] \r\n20 00000040`4ddff960 00007ff8`4901d0d1     KERNEL32!BaseThreadInitThunk+0x14 [clientcore\\base\\win32\\client\\thread.c @ 64] \r\n21 00000040`4ddff990 00000000`00000000     ntdll!RtlUserThreadStart+0x21 [minkernel\\ntdll\\rtlstrt.c @ 1153] \r\n```",
        "createdAt": "2020-12-22T20:19:50Z",
        "author": {
          "login": "vaboca"
        }
      },
      {
        "body": "Still having this issue in 2022. In our case it's when using the command `dotnet restore src\\Solution.sln` (`dotnet restore -p:UseSharedCompilation=false src\\Solution.sln` didn't help)",
        "createdAt": "2022-08-11T21:16:27Z",
        "author": {
          "login": "felixpelletier"
        }
      },
      {
        "body": "\u6211\u4e5f\u9047\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898 sad\u3002\u3002\r\nUNHANDLED EXCEPTIONS FROM PROCESS 32204:\r\n=====================\r\n2022/9/22 20:42:46\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 5 does not have a provider.\r\n   \u5728 Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n   \u5728 Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n   \u5728 Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n===================\r\n\r\n\u6211\u6267\u884c\u7684\u547d\u4ee4\uff1a\r\nmsbuild.exe -m -t:Rebuild -restore -clp:PerformanceSummary;ErrorsOnly;Summary -flp:LogFile=msbuild.log;Verbosity=normal;PerformanceSummary;ShowTimestamp -p:Configuration=Release;RestorePackagesConfig=true;WarningLevel=1;BuildProjectReferences=true;SolutionDir=n:\\jenkins\\workspace\\Multi-Build-jobv2 n:\\jenkins\\workspace\\Multi-Build-jobv2\\S3.IOP.ClientSvr\\S3.IOP.ClientSvr.csproj\r\n\r\n\u6211\u7684\u5de5\u5177\u7248\u672c\uff1a\r\n\u7528\u4e8e .NET Framework \u7684 Microsoft (R) \u751f\u6210\u5f15\u64ce\u7248\u672c 16.11.2+f32259642\r\n\r\n\u8fd8\u6ca1\u6709\u627e\u5230\u5b83\u51fa\u73b0\u7684\u89c4\u5f8b\r\n",
        "createdAt": "2022-09-22T12:58:47Z",
        "author": {
          "login": "neighbour-oldhuang"
        }
      },
      {
        "body": "Getting this intermittently. Jenkins, linux builder.\r\n```\r\n[Pipeline] sh (Restoring nuget packages)\r\n+ dotnet restore solution.sln -s http://sourcea/ -s http://sourceb -s http://sourcec\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n   at Microsoft.Build.BackEnd.NodeManager.SendData(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.PerformSchedulingActions(IEnumerable`1 responses)\r\n   at Microsoft.Build.Execution.BuildManager.PerformSchedulingActions(IEnumerable`1 responses)\r\n   at Microsoft.Build.Execution.BuildManager.HandleNewRequest(Int32 node, BuildRequestBlocker blocker)\r\n   at Microsoft.Build.Execution.BuildManager.ProcessPacket(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.<>c__DisplayClass76_0.<Microsoft.Build.BackEnd.INodePacketHandler.PacketReceived>b__0()\r\n   at Microsoft.Build.Execution.BuildManager.ProcessWorkQueue(Action action)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.Build.Execution.BuildManager.EndBuild()\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String[] commandLine)\r\nUnhandled exception: Microsoft.Build.Shared.InternalErrorException: MSB0001: Internal MSBuild Error: Node 2 does not have a provider.\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String[] commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main(String[] args)\r\n   at Microsoft.DotNet.Cli.Utils.MSBuildForwardingAppWithoutLogging.ExecuteInProc(String[] arguments)\r\n[Pipeline] }\r\n```",
        "createdAt": "2023-04-04T09:02:32Z",
        "author": {
          "login": "pasisavolainen"
        }
      },
      {
        "body": "We are also running into this error on CI, not sure yet how often, its on a OSX Arm64 matchine;\r\n```\r\nMSB0001: Internal MSBuild Error: Node 1 does not have a provider.\r\nStackTrace:\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n   at Microsoft.Build.BackEnd.NodeManager.SendData(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.PerformSchedulingActions(IEnumerable`1 responses)\r\n   at Microsoft.Build.Execution.BuildManager.HandleResult(Int32 node, BuildResult result)\r\n   at Microsoft.Build.Execution.BuildManager.ProcessPacket(Int32 node, INodePacket packet)\r\n   at Microsoft.Build.Execution.BuildManager.ProcessWorkQueue(Action action)\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.Build.Execution.BuildManager.EndBuild()\r\n...\r\n```",
        "createdAt": "2024-07-02T08:37:53Z",
        "author": {
          "login": "hknielsen"
        }
      },
      {
        "body": "Ok a coworker got a bit more information of what went wrong with the Node for us:\r\n```\r\nUNHANDLED EXCEPTIONS FROM PROCESS 7140:\r\n=====================\r\n7/2/2024 1:15:27 PM\r\nMicrosoft.Build.Exceptions.InternalLoggerException: The build stopped unexpectedly because of an unexpected logger failure.\r\n ---> Microsoft.Build.Exceptions.InternalLoggerException: The build stopped unexpectedly because of an unexpected logger failure.\r\n ---> Microsoft.Build.Exceptions.InvalidProjectFileException: The imported project file \"xxx.props\" could not be loaded. The process cannot access the file 'xxx.props\" ' because it is being used by another process.  xxx\\Sdk.props\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args)\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject[T1,T2](IElementLocation elementLocation, String resourceName, T1 arg0, T2 arg1)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpression(String directoryOfImportingFile, ProjectImportElement importElement, String unescapedExpression, Boolean throwOnFileNotExistsError, List`1& imports)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate()\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, \r\n```",
        "createdAt": "2024-07-02T12:18:19Z",
        "author": {
          "login": "hknielsen"
        }
      },
      {
        "body": "@hknielsen I think that's unrelated (unless you're getting the other error as well). I suggest opening another issue. That should not happen.",
        "createdAt": "2024-07-25T23:01:37Z",
        "author": {
          "login": "danmoseley"
        }
      },
      {
        "body": "I am wondering if this is related to the reported bug too:\nhttps://github.com/dotnet/arcade/pull/15514#issuecomment-2738398862\n",
        "createdAt": "2025-03-20T09:59:27Z",
        "author": {
          "login": "YuliiaKovalova"
        }
      }
    ]
  }
}