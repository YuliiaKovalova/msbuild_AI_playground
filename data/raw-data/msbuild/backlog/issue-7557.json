{
  "number": 7557,
  "title": "No Nuget package creation in Release mode for a .Net Framework project (Visual studio 2022)",
  "body": "### Discussed in https://github.com/dotnet/msbuild/discussions/7555\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **lgsndbox** April 21, 2022</sup>\r\nHello,\r\n\r\nWith Visual Studio 2022, I'm trying to automate the building of a Nuget package for a .Net Framework library using MSBuild.\r\nI've followed instructions at https://docs.microsoft.com/en-us/nuget/create-packages/creating-a-package-msbuild\r\nI understand that a .Net Framework project is a non-SDK-Style project, and I added the necessary `PackageOutputPath` and the `<PackageReference Include=\"NuGet.Build.Tasks.Pack\" Version=\"x.x.x\"/>`.\r\n\r\nI'm also using `<GeneratePackageOnBuild>true</GeneratePackageOnBuild>`.\r\n\r\nMy problem is the following:\r\nThe Nuget Package is created when I'm on Debug, but not when I'm on Release.\r\n\r\nMy question is:\r\nHow to have it built on Release?\r\n\r\nFor reference here is an expurged version of my .csproj file\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<Project ToolsVersion=\"15.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">\r\n  <Import Project=\"$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props\" Condition=\"Exists('$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props')\" />\r\n  <PropertyGroup>\r\n    <Configuration Condition=\" '$(Configuration)' == '' \">Debug</Configuration>\r\n    <Platform Condition=\" '$(Platform)' == '' \">AnyCPU</Platform>\r\n    <ProjectGuid>{[...]]}</ProjectGuid>\r\n    <OutputType>Library</OutputType>\r\n    <AppDesignerFolder>Properties</AppDesignerFolder>\r\n    <RootNamespace>[...]</RootNamespace>\r\n    <AssemblyName>[...]</AssemblyName>\r\n    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>\r\n    <FileAlignment>512</FileAlignment>\r\n    <Deterministic>true</Deterministic>\r\n    <PackageId>$(AssemblyName)</PackageId>\r\n    <Version>[...]</Version>\r\n    <Authors>[...]</Authors>\r\n    <Company>[...]</Company>\r\n\t  <Title>[...]</Title>\r\n    <Description>[...]</Description>\r\n    <PackageOutputPath>bin\\Package\\</PackageOutputPath>\r\n\t  <PackageTags>[...]</PackageTags>\r\n    <GeneratePackageOnBuild>true</GeneratePackageOnBuild>\r\n    <NuGetPackageImportStamp>\r\n    </NuGetPackageImportStamp>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' \">\r\n    <DebugSymbols>true</DebugSymbols>\r\n    <DebugType>full</DebugType>\r\n    <Optimize>false</Optimize>\r\n    <OutputPath>bin\\Debug\\</OutputPath>\r\n    <DefineConstants>DEBUG;TRACE</DefineConstants>\r\n    <ErrorReport>prompt</ErrorReport>\r\n    <WarningLevel>4</WarningLevel>\r\n    <CodeAnalysisRuleSet>[...]</CodeAnalysisRuleSet>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' \">\r\n    <DebugType>pdbonly</DebugType>\r\n    <Optimize>true</Optimize>\r\n    <OutputPath>bin\\Release\\</OutputPath>\r\n    <DefineConstants>TRACE</DefineConstants>\r\n    <ErrorReport>prompt</ErrorReport>\r\n    <WarningLevel>4</WarningLevel>\r\n\t<CodeAnalysisRuleSet>[...]</CodeAnalysisRuleSet>\r\n  </PropertyGroup>\r\n  <ItemGroup>\r\n    <Reference [...]/>\r\n    [...]\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n    <Compile [...]/>\r\n    [...]\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n    <None [...]>\r\n      [...]\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n    <Analyzer Include=\"..\\packages\\StyleCop.Analyzers.1.1.118\\analyzers\\dotnet\\cs\\StyleCop.Analyzers.CodeFixes.dll\" />\r\n    <Analyzer Include=\"..\\packages\\StyleCop.Analyzers.1.1.118\\analyzers\\dotnet\\cs\\StyleCop.Analyzers.dll\" />\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n    <!-- ... -->\r\n    <PackageReference Include=\"NuGet.Build.Tasks.Pack\" Version=\"6.1.0\" />\r\n    <!-- ... -->\r\n  </ItemGroup>\r\n  <Import Project=\"$(MSBuildToolsPath)\\Microsoft.CSharp.targets\" />\r\n  <Import Project=\"..\\packages\\NuGet.Build.Tasks.Pack.6.1.0\\build\\NuGet.Build.Tasks.Pack.targets\" Condition=\"Exists('..\\packages\\NuGet.Build.Tasks.Pack.6.1.0\\build\\NuGet.Build.Tasks.Pack.targets')\" />\r\n  <Target Name=\"EnsureNuGetPackageBuildImports\" BeforeTargets=\"PrepareForBuild\">\r\n    <PropertyGroup>\r\n      <ErrorText>This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is {0}.</ErrorText>\r\n    </PropertyGroup>\r\n    <Error Condition=\"!Exists('..\\packages\\NuGet.Build.Tasks.Pack.6.1.0\\build\\NuGet.Build.Tasks.Pack.targets')\" Text=\"$([System.String]::Format('$(ErrorText)', '..\\packages\\NuGet.Build.Tasks.Pack.6.1.0\\build\\NuGet.Build.Tasks.Pack.targets'))\" />\r\n  </Target>\r\n  <Target Name=\"PublishNugetPackage\" AfterTargets=\"PostBuildEvent\" Condition=\"'$(Configuration)'=='Release'\">\r\n    <Message Importance=\"High\" Text=\"Publishing Nuget Package [...]...\" />\r\n    <Exec Command=\"PowerShell -ExecutionPolicy Bypass -File publish-nuget-[...].ps1\" />\r\n  </Target>\r\n</Project>\r\n```\r\n\r\nI've tried to change the line\r\n`<Configuration Condition=\" '$(Configuration)' == '' \">Debug</Configuration>`\r\nto\r\n`<Configuration Condition=\" '$(Configuration)' == '' \">Release</Configuration>`\r\n\r\nBut to no avail. I must say that I don't understand the purpose of this line anyway.\r\nIt says that if the property `Configuration ` is not defined, define it to `Debug`, but I fail to understand why this has to be done.\r\n[EDIT] I have found the answer to that part here: https://stackoverflow.com/questions/33744624/set-a-default-build-configuration-for-project\r\n\r\nThanks for any input.\r\n</div>",
  "state": "CLOSED",
  "createdAt": "2022-04-21T14:17:48Z",
  "updatedAt": "2024-02-21T17:00:31Z",
  "closedAt": "2022-04-21T14:18:30Z",
  "author": {
    "login": "rainersigwald"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This issue was moved to NuGet/Home#11763",
        "createdAt": "2022-04-21T14:18:28Z",
        "updatedAt": "2022-04-21T14:18:28Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}