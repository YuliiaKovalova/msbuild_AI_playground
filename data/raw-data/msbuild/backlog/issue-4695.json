{
  "number": 4695,
  "title": "resx files in subfolders relative to project root fail to build when EmbeddedResourceUseDependentUponConvention is true (.NET Core 3.0 preview 9)",
  "body": "When you move/create form files in subfolders (relative to project root) convetion based system fails to find associated resx file, because it clearly mangled the filename (see build error)\r\nif you disable EmbeddedResourceUseDependentUponConvention in csproj this error goes away.\r\n\r\nthis is likely related to https://github.com/microsoft/msbuild/pull/4597\r\n\r\n### Steps to reproduce\r\nsample project\r\n[WindowsFormsDependentUponConventionTest.zip](https://github.com/microsoft/msbuild/files/3579031/WindowsFormsDependentUponConventionTest.zip)\r\n\r\n\r\n### Expected  behavior\r\nassembly builds\r\n\r\n### Actual behavior\r\nbuild error:\r\n\r\nError MSB3041: Unable to create a manifest resource name for \"Forms\\Form1.resx\". Could not find a part of the path 'C:\\Users\\Vladislav Richter\\source\\repos\\WindowsFormsDependentUponConventionTest\\WindowsFormsDependentUponConventionTest\\Forms\\Forms\\Form1.cs'.\t\r\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Preview\\MSBuild\\Current\\Bin\\Microsoft.CSharp.CurrentVersion.targets\t100\t\r\n\r\n\r\n### Environment data\r\nVS 16.3.0 Preview 3.0\r\n.NET Core 3.0 Preview 9\r\nWinForms project\r\n",
  "state": "CLOSED",
  "createdAt": "2019-09-05T11:27:54Z",
  "updatedAt": "2024-02-21T17:07:15Z",
  "closedAt": "2019-09-10T06:04:58Z",
  "author": {
    "login": "shutdown256"
  },
  "labels": [
    "bug",
    "triaged"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "benvillalobos"
      }
    ]
  },
  "milestone": {
    "title": "MSBuild 16.3"
  },
  "comments": {
    "nodes": [
      {
        "body": "PS as this is likely related:\r\nwith EmbeddedResourceUseDependentUponConvention = false\r\nwhen I have embedded resource file in subfolder with the same name as .cs file but with a different extension eg. .js it's name in the manifest is without this extension\r\n\r\nexample:\r\n```\r\n\\subfolder\r\n   control.cs\r\n   control.js\r\n```\r\nin manifest:\r\n`subfolder.control`",
        "createdAt": "2019-09-05T11:35:02Z",
        "updatedAt": "2019-09-05T11:35:02Z",
        "author": {
          "login": "shutdown256"
        }
      },
      {
        "body": "/cc @BenVillalobos, it was introduced in #4597 as far as I can see.",
        "createdAt": "2019-09-05T11:54:49Z",
        "updatedAt": "2019-09-05T12:00:44Z",
        "author": {
          "login": "filipnavara"
        }
      },
      {
        "body": "To help prioritization: this has a direct impact on projects that use Entity Framework 6.3 with migrations. Migration files (including resource files) are generated by default under a folder, as per https://github.com/aspnet/EntityFramework6/issues/1225. ",
        "createdAt": "2019-09-05T22:17:00Z",
        "updatedAt": "2019-09-05T22:17:00Z",
        "author": {
          "login": "divega"
        }
      },
      {
        "body": "@livarcocc @rainersigwald I went ahead and marked this for 16.3. Seems like this is must fix to me. Do you agree?",
        "createdAt": "2019-09-05T23:02:51Z",
        "updatedAt": "2019-09-05T23:02:51Z",
        "author": {
          "login": "nguerrera"
        }
      },
      {
        "body": "Is this supposed to work in RC1? Because we are still hitting this issue. The repro project I've provided still won't build under:\r\nSDK 3.0.100-rc1-014190 x86\r\nBuild Engine version 16.3.0-preview-19455-02+4a2d77107 for .NET Core",
        "createdAt": "2019-09-17T10:20:36Z",
        "updatedAt": "2019-09-17T10:20:36Z",
        "author": {
          "login": "shutdown256"
        }
      },
      {
        "body": "@shutdown256 the fix unfortunately missed rc1 but is in the very latest daily builds. I just confirmed that the repro project works with `3.0.100-rc2-014265`.",
        "createdAt": "2019-09-17T14:59:23Z",
        "updatedAt": "2019-09-17T14:59:23Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Looks like this issue is back with .NET 5.0 preview2...",
        "createdAt": "2020-04-06T13:53:07Z",
        "updatedAt": "2020-04-06T13:53:07Z",
        "author": {
          "login": "schuettecarsten"
        }
      },
      {
        "body": "@schuettecarsten could you explain in a bit more detail how you got this error again? I can't seem to repro it.\r\n\r\nSteps I took: \r\n1. downloaded [WindowsFormsDependentUponConventionTest.zip](https://github.com/microsoft/msbuild/files/3579031/WindowsFormsDependentUponConventionTest.zip) (linked in original post)\r\n1. `git checkout ded7c259dc` (commit where this issue started)\r\n1. built the msbuild repo using `msbuild /p:createbootstrap=true` \r\n1. built the tes tproject using the generated msbuild binary\r\n1. confirmed the error occurs.\r\n1. downloaded .NET 5.0 p2\r\n1. built using `dotnet build`.\r\n1. No error, even after cleaning.",
        "createdAt": "2020-04-23T17:15:48Z",
        "updatedAt": "2020-04-23T17:15:48Z",
        "author": {
          "login": "benvillalobos"
        }
      }
    ]
  }
}