{
  "number": 3133,
  "title": "The \"PropertyGroup\" property is reserved",
  "body": "### Steps to reproduce\r\n\r\nWhen I try to restore a project with a custom SDK I see the following error:\r\n\r\n> Microsoft.Build.Exceptions.InvalidProjectFileException : The \"PropertyGroup\" property is reserved, and cannot be modified.  C:\\Users\\Administrator\\.nuget\\packages\\dnnvs.sdk\\0.0.1-alpha0001\\Sdk\\Sdk.props\r\n\r\nThe `sdk.props` file looks like this:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<Project ToolsVersion=\"4.0\" DefaultTargets=\"Build\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">\r\n  <PropertyGroup>\r\n    <ProjectSystemBase>$(MSBuildThisFileDirectory)..\\</ProjectSystemBase>\r\n\r\n    <PropertyGroup>\r\n      <RulesFolderPath>$(ProjectSystemBase)Rules</RulesFolderPath>\r\n    </PropertyGroup>\r\n    \r\n    <Configuration Condition=\" '$(Configuration)' == '' \">Debug</Configuration>\r\n    <Platform Condition=\" '$(Platform)' == '' \">AnyCPU</Platform>\r\n    <DebuggerFlavor>DnnWebsiteDebugger</DebuggerFlavor>      \r\n\r\n    <LanguageTargets>$(MSBuildToolsPath)\\Microsoft.CSharp.targets</LanguageTargets>\r\n    <ResolveNuGetPackages>true</ResolveNuGetPackages>\r\n    <DnnToolsPackageVersion Condition=\"'$(DnnToolsPackageVersion)'==''\">0.0.2-alpha0010</DnnToolsPackageVersion> \r\n  \r\n  </PropertyGroup>\r\n\r\n  <PropertyGroup Condition=\"'$(Configuration)'=='Debug'\" Label=\"Configuration\">\r\n    <Optimize>false</Optimize>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\"'$(Configuration)'=='Release'\" Label=\"Configuration\">\r\n    <Optimize>true</Optimize>\r\n  </PropertyGroup>\r\n  \r\n</Project>\r\n\r\n```\r\n\r\nI can't see any of those properties listed as reserved properties here: https://msdn.microsoft.com/en-us/library/ms164309.aspx\r\n\r\nWhat am I doing wrong?\r\n\r\n\r\n### Expected  behavior\r\n\r\nExpecting my project to restore.\r\n\r\n### Actual behavior\r\n\r\n> Microsoft.Build.Exceptions.InvalidProjectFileException : The \"PropertyGroup\" property is reserved, and cannot be modified.  C:\\Users\\Administrator\\.nuget\\packages\\dnnvs.sdk\\0.0.1-alpha0001\\Sdk\\Sdk.props\r\n\r\nStack:\r\n\r\n> Result StackTrace:\t\r\nat Microsoft.Build.Shared.ProjectErrorUtilities.ThrowInvalidProject(String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, Object[] args)\r\n   at Microsoft.Build.Shared.ProjectErrorUtilities.VerifyThrowInvalidProject[T1](Boolean condition, String errorSubCategoryResourceName, IElementLocation elementLocation, String resourceName, T1 arg0)\r\n   at Microsoft.Build.Construction.ProjectParser.ParseProjectPropertyElement(XmlElementWithLocation element, ProjectPropertyGroupElement parent)\r\n   at Microsoft.Build.Construction.ProjectParser.ParseProjectPropertyGroupElement(XmlElementWithLocation element, ProjectElementContainer parent)\r\n   at Microsoft.Build.Construction.ProjectParser.ParseProjectRootElementChildren(XmlElementWithLocation element)\r\n   at Microsoft.Build.Construction.ProjectParser.Parse()\r\n   at Microsoft.Build.Construction.ProjectRootElement..ctor(String path, ProjectRootElementCache projectRootElementCache, Boolean preserveFormatting)\r\n   at Microsoft.Build.Construction.ProjectRootElement.CreateProjectFromPath(String projectFile, IDictionary`2 globalProperties, String toolsVersion, ProjectRootElementCache projectRootElementCache, Boolean preserveFormatting)\r\n   at Microsoft.Build.Construction.ProjectRootElement.<>c__DisplayClass200_0.<OpenProjectOrSolution>b__0(String path, ProjectRootElementCache cache)\r\n   at Microsoft.Build.Evaluation.ProjectRootElementCache.Get(String projectFile, OpenProjectRootElement openProjectRootElement, Boolean isExplicitlyLoaded, Nullable`1 preserveFormatting)\r\n   at Microsoft.Build.Construction.ProjectRootElement.OpenProjectOrSolution(String fullPath, IDictionary`2 globalProperties, String toolsVersion, ProjectRootElementCache projectRootElementCache, Boolean isExplicitlyLoaded)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.<>c__DisplayClass73_1.<ExpandAndLoadImportsFromUnescapedImportExpression>b__0(String p, ProjectRootElementCache c)\r\n   at Microsoft.Build.Evaluation.ProjectRootElementCache.Get(String projectFile, OpenProjectRootElement openProjectRootElement, Boolean isExplicitlyLoaded, Nullable`1 preserveFormatting)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpression(String directoryOfImportingFile, ProjectImportElement importElement, String unescapedExpression, Boolean throwOnFileNotExistsError, List`1& imports)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, Boolean throwOnFileNotExistsError)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(ILoggingService loggingService, BuildEventContext buildEventContext)\r\n   at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, ProjectRootElementCache projectRootElementCache, BuildEventContext buildEventContext, ProjectInstance projectInstanceIfAnyForDebuggerOnly, ISdkResolverService sdkResolverService, Int32 submissionId)\r\n   at Microsoft.Build.Evaluation.Project.Reevaluate(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project.ReevaluateIfNecessary(ILoggingService loggingServiceForEvaluation, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project.Initialize(IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.Project..ctor(String projectFile, IDictionary`2 globalProperties, String toolsVersion, String subToolsetVersion, ProjectCollection projectCollection, ProjectLoadSettings loadSettings)\r\n   at Microsoft.Build.Evaluation.ProjectCollection.LoadProject(String fileName, IDictionary`2 globalProperties, String toolsVersion)\r\n   at Microsoft.Build.Evaluation.ProjectCollection.LoadProject(String fileName)\r\n   at DnnVsProjectSystem.BuildTools.Tests.MsBuildHelper.Restore(String fileName, Boolean noCache, Boolean ignorefailedsources, String packageSource, String nugetConfig) in E:\\Repos\\DnnVsProjectSystem\\src\\DnnVsProjectSystem.BuildTools.Tests\\Util\\MsBuildHelper.cs:line 64\r\n   at DnnVsProjectSystem.BuildTools.Tests.ManifestBuildTests.BuildTestProject(String projectFileName, Boolean assertIsSuccess, Action`1 onBeforeBuild, String& consoleOutput) in E:\\Repos\\DnnVsProjectSystem\\src\\DnnVsProjectSystem.BuildTools.Tests\\ManifestBuildTests.cs:line 244\r\n   at DnnVsProjectSystem.BuildTools.Tests.ManifestBuildTests.WhenProjectIsBuilt(String projectName, Boolean assertSuccess, Action`1 assert) in E:\\Repos\\DnnVsProjectSystem\\src\\DnnVsProjectSystem.BuildTools.Tests\\ManifestBuildTests.cs:line 163\r\n   at DnnVsProjectSystem.BuildTools.Tests.ManifestBuildTests.Adds_Target_Assembly_To_Manifest() in E:\\Repos\\DnnVsProjectSystem\\src\\DnnVsProjectSystem.BuildTools.Tests\\ManifestBuildTests.cs:line 105\r\nResult Message:\tMicrosoft.Build.Exceptions.InvalidProjectFileException : The \"PropertyGroup\" property is reserved, and cannot be modified.  C:\\Users\\Administrator\\.nuget\\packages\\dnnvs.sdk\\0.0.1-alpha0001\\Sdk\\Sdk.props\r\n\r\n\r\n\r\n### Environment data\r\n`msbuild /version` output:\r\n\r\nI am using the following msbuild nuget packages in order to restore a proj file at test time.\r\n\r\n```\r\n   <PackageReference Include=\"Microsoft.Build.Utilities.Core\" Version=\"15.6.82\" />\r\n    <PackageReference Include=\"Microsoft.Build.Framework\" Version=\"15.6.82\" />\r\n    <PackageReference Include=\"Microsoft.Build\" Version=\"15.6.82\" />\r\n    <PackageReference Include=\"Microsoft.Build.Tasks.Core\" Version=\"15.6.82\" />  \r\n\r\n```\r\n\r\nAnd setting the following environment variables before calling msbuild libraries at test time:\r\n\r\n```\r\n        private static string VSINSTALLDIR = \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Community\";\r\n        private static string VisualStudioVersion = \"15.0\";\r\n        private static string MSBuildSDKsPath = @\"C:\\Program Files\\dotnet\\sdk\\2.1.103\\Sdks\\\";\r\n\r\n```\r\n\r\nOS info:\r\n\r\nWindows 10, dotnet --version 2.1.103\r\n",
  "state": "CLOSED",
  "createdAt": "2018-03-25T14:26:53Z",
  "updatedAt": "2024-02-21T17:13:57Z",
  "closedAt": "2018-03-28T19:11:13Z",
  "author": {
    "login": "dazinator"
  },
  "labels": [
    "Area: Documentation",
    "triaged"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "rainersigwald"
      }
    ]
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Ah think I have just seen the error of my ways.. doh!",
        "createdAt": "2018-03-25T14:28:56Z",
        "updatedAt": "2018-03-25T14:28:56Z",
        "author": {
          "login": "dazinator"
        }
      },
      {
        "body": "That should definitely be documented!\r\n\r\n(I'm assuming the problem was the nested `<PropertyGroup>`, right?)",
        "createdAt": "2018-03-25T15:49:37Z",
        "updatedAt": "2018-03-25T15:49:37Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@rainersigwald yes it was the (accidental) nested property group :-)",
        "createdAt": "2018-03-28T19:29:52Z",
        "updatedAt": "2018-03-28T19:29:52Z",
        "author": {
          "login": "dazinator"
        }
      }
    ]
  }
}