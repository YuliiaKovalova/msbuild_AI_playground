{
  "number": 10262,
  "title": "[Bug]: Parsing `-property:Configuration` with Command-line comments",
  "body": "### Issue Description\r\n\r\nHaving comments in a multi-line command on the command-line in bash shell on linux, will throw the following error output; which is invalid for what is going on.\r\n\r\n#### Example Command\r\n\r\n```\r\ndotnet publish ./src/Neo.CLI \\\r\n  --version-suffix win-x64 \\ # Append runtime identifier to version\r\n  --framework net8.0 \\ # Target .NET 8.0 framework\r\n  --configuration Release \\ # Use Release configuration\r\n  --runtime win-x64 \\ # Specify runtime identifier (e.g., win-x64, linux-arm64)\r\n  --self-contained true \\ # Include the .NET runtime with the application\r\n  --output /tmp/out/win-x64 \\ # Output path for the published application\r\n  --verbosity normal \\ # Normal verbosity level\r\n  -p:VersionPrefix=3.7.7 \\ # Set the version prefix to the application version\r\n  -p:RuntimeIdentifier=win-x64 \\ # Set the runtime identifier property\r\n  -p:SelfContained=true \\ # Ensure the application is self-contained\r\n  -p:IncludeNativeLibrariesForSelfExtract=false \\ # Do not include native libraries for self-extraction\r\n  -p:PublishTrimmed=false \\ # Do not trim unused code\r\n  -p:PublishSingleFile=true \\ # Publish as a single file\r\n  -p:PublishReadyToRun=true \\ # Enable ReadyToRun compilation\r\n  -p:EnableCompressionInSingleFile=true \\ # Enable compression in the single file\r\n  -p:DebugType=embedded \\ # Embed debug information\r\n  -p:ServerGarbageCollection=true # Enable server garbage collection\r\n```\r\n\r\n### Steps to Reproduce\r\n\r\nUse similar command like above in _description_.\r\n\r\n### Github Workflow Action Output\r\n```\r\n2024-06-19T05:49:21.7737065Z ##[group]Run actions/setup-dotnet@v4\r\n2024-06-19T05:49:21.7737517Z with:\r\n2024-06-19T05:49:21.7737865Z   dotnet-version: 8.0.x\r\n2024-06-19T05:49:21.7738348Z   cache: false\r\n2024-06-19T05:49:21.7738656Z env:\r\n2024-06-19T05:49:21.7738988Z   DOTNET_VERSION: 8.0.x\r\n2024-06-19T05:49:21.7739456Z   CONFIGURATION: Release\r\n2024-06-19T05:49:21.7739869Z   DIST_PATH: /tmp/dist\r\n2024-06-19T05:49:21.7740276Z   OUTPUT_PATH: /tmp/out\r\n2024-06-19T05:49:21.7740715Z   APP_VERSION: 3.7.7\r\n2024-06-19T05:49:21.7741050Z ##[endgroup]\r\n2024-06-19T05:49:21.9348946Z [command]/home/runner/work/_actions/actions/setup-dotnet/v4/externals/install-dotnet.sh --skip-non-versioned-files --runtime dotnet --channel LTS\r\n2024-06-19T05:49:22.6864301Z dotnet-install: .NET Core Runtime with version '8.0.6' is already installed.\r\n2024-06-19T05:49:22.6893805Z [command]/home/runner/work/_actions/actions/setup-dotnet/v4/externals/install-dotnet.sh --skip-non-versioned-files --channel 8.0\r\n2024-06-19T05:49:23.2108483Z dotnet-install: Attempting to download using aka.ms link https://dotnetcli.azureedge.net/dotnet/Sdk/8.0.302/dotnet-sdk-8.0.302-linux-x64.tar.gz\r\n2024-06-19T05:49:24.2767863Z dotnet-install: Remote file https://dotnetcli.azureedge.net/dotnet/Sdk/8.0.302/dotnet-sdk-8.0.302-linux-x64.tar.gz size is 222084318 bytes.\r\n2024-06-19T05:49:24.2770385Z dotnet-install: Extracting zip from https://dotnetcli.azureedge.net/dotnet/Sdk/8.0.302/dotnet-sdk-8.0.302-linux-x64.tar.gz\r\n2024-06-19T05:49:28.8357852Z dotnet-install: Downloaded file size is 222084318 bytes.\r\n2024-06-19T05:49:28.8359005Z dotnet-install: The remote and local file sizes are equal.\r\n2024-06-19T05:49:29.1119251Z dotnet-install: Installed version is 8.0.302\r\n2024-06-19T05:49:29.1171044Z dotnet-install: Adding to current process PATH: `/usr/share/dotnet`. Note: This change will be visible only when sourcing script.\r\n2024-06-19T05:49:29.1172932Z dotnet-install: Note that the script does not resolve dependencies during installation.\r\n2024-06-19T05:49:29.1175234Z dotnet-install: To check the list of dependencies, go to https://learn.microsoft.com/dotnet/core/install, select your operating system and check the \"Dependencies\" section.\r\n2024-06-19T05:49:29.1177297Z dotnet-install: Installation finished successfully.\r\n2024-06-19T05:49:29.1293340Z ##[group]Run dotnet publish ./src/Neo.CLI \\\r\n2024-06-19T05:49:29.1293908Z \u001b[36;1mdotnet publish ./src/Neo.CLI \\\u001b[0m\r\n2024-06-19T05:49:29.1294509Z \u001b[36;1m--version-suffix win-x64 \\ # Append runtime identifier to version\u001b[0m\r\n2024-06-19T05:49:29.1295378Z \u001b[36;1m--framework net8.0 \\ # Target .NET 8.0 framework\u001b[0m\r\n2024-06-19T05:49:29.1295945Z \u001b[36;1m--configuration Release \\ # Use Release configuration\u001b[0m\r\n2024-06-19T05:49:29.1296658Z \u001b[36;1m--runtime win-x64 \\ # Specify runtime identifier (e.g., win-x64, linux-arm64)\u001b[0m\r\n2024-06-19T05:49:29.1297560Z \u001b[36;1m--self-contained true \\ # Include the .NET runtime with the application\u001b[0m\r\n2024-06-19T05:49:29.1298346Z \u001b[36;1m--output /tmp/out/win-x64 \\ # Output path for the published application\u001b[0m\r\n2024-06-19T05:49:29.1298978Z \u001b[36;1m--verbosity normal \\ # Normal verbosity level\u001b[0m\r\n2024-06-19T05:49:29.1299735Z \u001b[36;1m-p:VersionPrefix=3.7.7 \\ # Set the version prefix to the application version\u001b[0m\r\n2024-06-19T05:49:29.1300564Z \u001b[36;1m-p:RuntimeIdentifier=win-x64 \\ # Set the runtime identifier property\u001b[0m\r\n2024-06-19T05:49:29.1301386Z \u001b[36;1m-p:SelfContained=true \\ # Ensure the application is self-contained\u001b[0m\r\n2024-06-19T05:49:29.1302275Z \u001b[36;1m-p:IncludeNativeLibrariesForSelfExtract=false \\ # Do not include native libraries for self-extraction\u001b[0m\r\n2024-06-19T05:49:29.1303100Z \u001b[36;1m-p:PublishTrimmed=false \\ # Do not trim unused code\u001b[0m\r\n2024-06-19T05:49:29.1303764Z \u001b[36;1m-p:PublishSingleFile=true \\ # Publish as a single file\u001b[0m\r\n2024-06-19T05:49:29.1304417Z \u001b[36;1m-p:PublishReadyToRun=true \\ # Enable ReadyToRun compilation\u001b[0m\r\n2024-06-19T05:49:29.1305182Z \u001b[36;1m-p:EnableCompressionInSingleFile=true \\ # Enable compression in the single file\u001b[0m\r\n2024-06-19T05:49:29.1305966Z \u001b[36;1m-p:DebugType=embedded \\ # Embed debug information\u001b[0m\r\n2024-06-19T05:49:29.1306602Z \u001b[36;1m-p:ServerGarbageCollection=true # Enable server garbage collection\u001b[0m\r\n2024-06-19T05:49:29.1367764Z shell: /usr/bin/bash -e {0}\r\n2024-06-19T05:49:29.1368192Z env:\r\n2024-06-19T05:49:29.1368604Z   DOTNET_VERSION: 8.0.x\r\n2024-06-19T05:49:29.1368965Z   CONFIGURATION: Release\r\n2024-06-19T05:49:29.1369338Z   DIST_PATH: /tmp/dist\r\n2024-06-19T05:49:29.1369777Z   OUTPUT_PATH: /tmp/out\r\n2024-06-19T05:49:29.1370115Z   APP_VERSION: 3.7.7\r\n2024-06-19T05:49:29.1370488Z   DOTNET_ROOT: /usr/share/dotnet\r\n2024-06-19T05:49:29.1370983Z ##[endgroup]\r\n2024-06-19T05:49:29.9752393Z MSBUILD : error MSB1008: Only one project can be specified.\r\n2024-06-19T05:49:29.9757462Z     Full command line: '/usr/share/dotnet/sdk/8.0.302/MSBuild.dll -maxcpucount -verbosity:m -nologo -restore -target:Publish --property:_IsPublishing=true -property:VersionSuffix=win-x64 -property:Configuration=Release ./src/Neo.CLI  # Append runtime identifier to version -distributedlogger:Microsoft.DotNet.Tools.MSBuild.MSBuildLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll*Microsoft.DotNet.Tools.MSBuild.MSBuildForwardingLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll'\r\n2024-06-19T05:49:29.9762041Z   Switches appended by response files:\r\n2024-06-19T05:49:29.9762843Z Switch:  #\r\n2024-06-19T05:49:29.9763037Z \r\n2024-06-19T05:49:29.9763376Z For switch syntax, type \"MSBuild -help\"\r\n2024-06-19T05:49:29.9933559Z ##[error]Process completed with exit code 1.\r\n2024-06-19T05:49:30.0127995Z Post job cleanup.\r\n2024-06-19T05:49:30.1047640Z [command]/usr/bin/git version\r\n2024-06-19T05:49:30.1091518Z git version 2.45.2\r\n2024-06-19T05:49:30.1132915Z Temporarily overriding HOME='/home/runner/work/_temp/9bc6bfd2-e50d-4d5b-a33f-9a7ea9650664' before making global git config changes\r\n2024-06-19T05:49:30.1134178Z Adding repository directory to the temporary git global config as a safe directory\r\n2024-06-19T05:49:30.1139612Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/neo/neo\r\n2024-06-19T05:49:30.1177577Z [command]/usr/bin/git config --local --name-only --get-regexp core\\.sshCommand\r\n2024-06-19T05:49:30.1210550Z [command]/usr/bin/git submodule foreach --recursive sh -c \"git config --local --name-only --get-regexp 'core\\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :\"\r\n2024-06-19T05:49:30.1460448Z [command]/usr/bin/git config --local --name-only --get-regexp http\\.https\\:\\/\\/github\\.com\\/\\.extraheader\r\n2024-06-19T05:49:30.1481512Z http.https://github.com/.extraheader\r\n2024-06-19T05:49:30.1493761Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader\r\n2024-06-19T05:49:30.1527828Z [command]/usr/bin/git submodule foreach --recursive sh -c \"git config --local --name-only --get-regexp 'http\\.https\\:\\/\\/github\\.com\\/\\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :\"\r\n2024-06-19T05:49:30.1981682Z Cleaning up orphan processes\r\n```\r\n\r\n### Expected Behavior\r\n\r\nTo ignore the comments or fix the way you pass the property configuration to `msbuild` from `dotnet`\r\n\r\n### Actual Behavior\r\n\r\n`-property:Configuration=Release ./src/Neo.CLI  # Append runtime identifier to version -distributedlogger:Microsoft.DotNet.Tools.MSBuild.MSBuildLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll*Microsoft.DotNet.Tools.MSBuild.MSBuildForwardingLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll'`\r\n\r\n```\r\nMSBUILD : error MSB1008: Only one project can be specified.\r\n    Full command line: '/usr/share/dotnet/sdk/8.0.302/MSBuild.dll -maxcpucount -verbosity:m -nologo -restore -target:Publish --property:_IsPublishing=true -property:VersionSuffix=win-x64 -property:Configuration=Release ./src/Neo.CLI  # Append runtime identifier to version -distributedlogger:Microsoft.DotNet.Tools.MSBuild.MSBuildLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll*Microsoft.DotNet.Tools.MSBuild.MSBuildForwardingLogger,/usr/share/dotnet/sdk/8.0.302/dotnet.dll'\r\n  Switches appended by response files:\r\nSwitch:  #\r\n\r\nFor switch syntax, type \"MSBuild -help\"\r\nError: Process completed with exit code 1.\r\n```\r\n\r\n### Analysis\r\n\r\nAs you can see from the command in the `description`, the `bash` comments are getting passed to `msbuild`. You can see this behavior in the _Actual Behavior_ description output.\r\n\r\nYou need to fix your command-line parser/builder.\r\n\r\n### Versions & Configurations\r\n\r\n**DOTNET**: `8.0.302`\r\n**MSBUILD**: `MSBuild version 17.10.4+10fbfbf2e for .NET, 17.10.4.21802`",
  "state": "CLOSED",
  "createdAt": "2024-06-19T06:10:18Z",
  "updatedAt": "2024-06-25T13:51:37Z",
  "closedAt": "2024-06-25T13:51:37Z",
  "author": {
    "login": "cschuchardt88"
  },
  "labels": [
    "bug"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This is not a dotnet or MSBuild bug.  Bash just does not support comments within a command.  Moreover, when the backslash is followed by a space rather than a newline, it does not indicate line continuation.",
        "createdAt": "2024-06-19T08:28:45Z",
        "updatedAt": "2024-06-19T08:28:45Z",
        "author": {
          "login": "KalleOlaviNiemitalo"
        }
      },
      {
        "body": "> Github Workflow Action Output\r\n\r\nIf the command is part of a YAML file for a GitHub workflow, then perhaps there is some way to replace the Bash comments with YAML comments or some GitHub-specific syntax, in order to intersperse them within the multiline command.  However, it seems YAML doesn't support comments within a string value either, and although GitHub workflows can use [expressions](https://docs.github.com/en/actions/learn-github-actions/expressions) within a command, I don't see any comment syntax for use within such an expression.\r\n",
        "createdAt": "2024-06-19T11:44:23Z",
        "updatedAt": "2024-06-19T11:44:23Z",
        "author": {
          "login": "KalleOlaviNiemitalo"
        }
      },
      {
        "body": "Perhaps you could use command expansion instead of comments:\r\n\r\n```\r\ndotnet publish ./src/Neo.CLI \\\r\n  --version-suffix win-x64 $(: \"Append runtime identifier to version\") \\\r\n  --framework net8.0 $(: \"Target .NET 8.0 framework\") \\\r\n  --configuration Release $(: \"Use Release configuration\")\r\n```\r\n\r\nThis would run the `:` command, which does nothing, and expand the `$( ... )` expression to the output of the command, i.e. nothing.  This kind of hack would look pretty strange, though.",
        "createdAt": "2024-06-19T11:48:42Z",
        "updatedAt": "2024-06-19T11:48:42Z",
        "author": {
          "login": "KalleOlaviNiemitalo"
        }
      },
      {
        "body": "Thanks your time and information. \r\n\r\n### Unrelated question\r\n\r\nShould I recreate the _below_ issue. Because they are saying this could be `msbuild` bug.\r\n\r\nMaybe have a look, before I recreate issue here.\r\nhttps://github.com/dotnet/msbuild/issues/10273",
        "createdAt": "2024-06-19T20:41:43Z",
        "updatedAt": "2024-06-19T20:41:43Z",
        "author": {
          "login": "cschuchardt88"
        }
      },
      {
        "body": "@cschuchardt88 I moved that here.",
        "createdAt": "2024-06-19T21:13:28Z",
        "updatedAt": "2024-06-19T21:13:28Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}