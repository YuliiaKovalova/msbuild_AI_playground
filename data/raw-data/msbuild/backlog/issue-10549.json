{
  "number": 10549,
  "title": "BuildRequestEngine unhandled exception",
  "body": "Reported by @CyrusNajmabadi \r\n\r\nGot this error in latst main:\r\n \r\n```\r\nBuild started at 3:15 PM...\r\n1>------ Build started: Project: Microsoft.CodeAnalysis.Workspaces.MSBuild.BuildHost, Configuration: Debug Any CPU ------\r\n2>------ Build started: Project: InteractiveHost64, Configuration: Debug Any CPU ------\r\n3>------ Build started: Project: Roslyn.VisualStudio.Setup, Configuration: Debug Any CPU ------\r\n3>MSBUILD : error MSB4166: Child node \"4\" exited prematurely. Shutting down. Diagnostic information may be found in files in \"C:\\Temp\\msbuild\" and will be named MSBuild_*.failure.txt. This location can be changed by setting the MSBUILDDEBUGPATH environment variable to a different directory.\r\n3>MSBUILD : error MSB4166: C:\\Temp\\msbuild\\MSBuild_pid-19808_1cd305da86ad4e10867611eb73032c12.failure.txt:\r\n3>MSBUILD : error MSB4166: UNHANDLED EXCEPTIONS FROM PROCESS 19808:\r\n3>MSBUILD : error MSB4166: =====================\r\n3>MSBUILD : error MSB4166: 8/21/2024 3:15:26 PM\r\n3>MSBUILD : error MSB4166: System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166: =============\r\n3>MSBUILD : error MSB4166: Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n```\r\n\r\nLink to diagnostics: [internal link](https://microsoft.sharepoint.com/:u:/t/ManagedLanguagesIDE/Ee9h9yFy275NmH89_GCVFW0Bn4XQhkA8tp4wTXBJeEOvhA?e=SQ6fAm)",
  "state": "OPEN",
  "createdAt": "2024-08-22T10:36:56Z",
  "updatedAt": "2025-06-02T08:28:04Z",
  "closedAt": null,
  "author": {
    "login": "JanKrivanek"
  },
  "milestone": null,
  "assignees": {
    "nodes": [
      {
        "login": "MichalPavlik"
      }
    ]
  },
  "labels": [
    "Area: Engine",
    "triaged"
  ],
  "comments": {
    "nodes": [
      {
        "body": "```\r\nBuild started at 3:15 PM...\r\n1>------ Build started: Project: Microsoft.CodeAnalysis.Workspaces.MSBuild.BuildHost, Configuration: Debug Any CPU ------\r\n2>------ Build started: Project: InteractiveHost64, Configuration: Debug Any CPU ------\r\n3>------ Build started: Project: Roslyn.VisualStudio.Setup, Configuration: Debug Any CPU ------\r\n3>MSBUILD : error MSB4166: Child node \"4\" exited prematurely. Shutting down. Diagnostic information may be found in files in \"C:\\Temp\\msbuild\" and will be named MSBuild_*.failure.txt. This location can be changed by setting the MSBUILDDEBUGPATH environment variable to a different directory.\r\n3>MSBUILD : error MSB4166: C:\\Temp\\msbuild\\MSBuild_pid-19808_1cd305da86ad4e10867611eb73032c12.failure.txt:\r\n3>MSBUILD : error MSB4166: UNHANDLED EXCEPTIONS FROM PROCESS 19808:\r\n3>MSBUILD : error MSB4166: =====================\r\n3>MSBUILD : error MSB4166: 8/21/2024 3:15:26 PM\r\n3>MSBUILD : error MSB4166: System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166: =============\r\n3>MSBUILD : error MSB4166: Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0, Object arg1)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass42_0.<SubmitBuildRequest>b__0()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166:  ---> Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0, Object arg1)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass42_0.<SubmitBuildRequest>b__0()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166:    --- End of inner exception stack trace ---\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Exception innerException, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.ActionBlock`1.ProcessMessage(Action`1 action, KeyValuePair`2 messageWithId)\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.ActionBlock`1.<>c__DisplayClass6_0.<.ctor>b__0(KeyValuePair`2 messageWithId)\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.Internal.TargetCore`1.ProcessMessagesLoopCore()\r\n3>MSBUILD : error MSB4166:    --- End of inner exception stack trace ---\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Task.ThrowIfExceptional(Boolean includeTaskCanceledExceptions)\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Task.Wait(Int32 millisecondsTimeout, CancellationToken cancellationToken)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.CleanupForBuild()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Execution.OutOfProcNode.HandleShutdown(Exception& exception)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Execution.OutOfProcNode.Run(Boolean enableReuse, Boolean lowPriority, Exception& shutdownException)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.CommandLine.MSBuildApp.StartLocalNode(CommandLineSwitches commandLineSwitches, Boolean lowpriority)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.CommandLine.MSBuildApp.ProcessCommandLineSwitches(CommandLineSwitches switchesFromAutoResponseFile, CommandLineSwitches switchesNotFromAutoResponseFile, String& projectFile, String[]& targets, String& toolsVersion, Dictionary`2& globalProperties, ILogger[]& loggers, LoggerVerbosity& verbosity, LoggerVerbosity& originalVerbosity, List`1& distributedLoggerRecords, Boolean& needToValidateProject, String& schemaFile, Int32& cpuCount, Boolean& enableNodeReuse, TextWriter& preprocessWriter, TextWriter& targetsWriter, Boolean& detailedSummary, ISet`1& warningsAsErrors, ISet`1& warningsNotAsErrors, ISet`1& warningsAsMessages, Boolean& enableRestore, Boolean& interactive, ProfilerLogger& profilerLogger, Boolean& enableProfiler, Dictionary`2& restoreProperties, ProjectIsolationMode& isolateProjects, GraphBuildOptions& graphBuild, String[]& inputResultsCaches, String& outputResultsCache, Boolean& reportFileAccesses, Boolean& lowPriority, Boolean& question, Boolean& isBuildCheckEnabled, String[]& getProperty, String[]& getItem, String[]& getTargetResult, String& getResultOutputFile, Boolean recursing, String commandLine)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n3>MSBUILD : error MSB4166: ---> (Inner Exception #0) Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166: =============\r\n3>MSBUILD : error MSB4166: Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0, Object arg1)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass42_0.<SubmitBuildRequest>b__0()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166:  ---> Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0, Object arg1)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass42_0.<SubmitBuildRequest>b__0()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166:    --- End of inner exception stack trace ---\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Exception innerException, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.ActionBlock`1.ProcessMessage(Action`1 action, KeyValuePair`2 messageWithId)\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.ActionBlock`1.<>c__DisplayClass6_0.<.ctor>b__0(KeyValuePair`2 messageWithId)\r\n3>MSBUILD : error MSB4166:    at System.Threading.Tasks.Dataflow.Internal.TargetCore`1.ProcessMessagesLoopCore()<---\r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166: ===================\r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166: C:\\Temp\\msbuild\\MSBuild_pid-19808_9ce1fbe1b7404f3199519cd09f026a6d.failure.txt:\r\n3>MSBUILD : error MSB4166: UNHANDLED EXCEPTIONS FROM PROCESS 19808:\r\n3>MSBUILD : error MSB4166: =====================\r\n3>MSBUILD : error MSB4166: 8/21/2024 3:15:26 PM\r\n3>MSBUILD : error MSB4166: Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Request 16 refers to configuration 205 which is not known to the engine.\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Object[] args)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.Shared.ErrorUtilities.VerifyThrow(Boolean condition, String unformattedMessage, Object arg0, Object arg1)\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass42_0.<SubmitBuildRequest>b__0()\r\n3>MSBUILD : error MSB4166:    at Microsoft.Build.BackEnd.BuildRequestEngine.<>c__DisplayClass72_0.<QueueAction>b__0()\r\n3>MSBUILD : error MSB4166: ===================\r\n3>MSBUILD : error MSB4166: \r\n3>MSBUILD : error MSB4166:\r\n4>------ Build started: Project: ExpressionEvaluatorPackage, Configuration: Debug Any CPU ------\r\n5>------ Build started: Project: RoslynDeployment, Configuration: Debug Any CPU ------\r\n6>------ Build started: Project: Microsoft.VisualStudio.IntegrationTest.Setup, Configuration: Debug Any CPU ------\r\n7>------ Build started: Project: Microsoft.VisualStudio.LanguageServices.New.IntegrationTests, Configuration: Debug Any CPU ------\r\n8>------ Build started: Project: IntegrationTestBuildProject, Configuration: Debug Any CPU ------\r\n========== Build: 1 succeeded, 7 failed, 199 up-to-date, 0 skipped ==========\r\n========== Build completed at 3:15 PM and took 23.109 seconds ==========\r\n```",
        "createdAt": "2024-08-22T10:37:11Z",
        "author": {
          "login": "JanKrivanek"
        }
      },
      {
        "body": "https://github.com/dotnet/msbuild/pull/10172 was operating in that area.\r\nOn the other hand `SubmitBuildRequest` (which got the exception) was untouched by the refactoring\r\n\r\n**Edit:** running through the `SubmitBuildRequest` and all the code populating `_configCache` - all that seems to be untouched (neiter indirectly) by recent changes. So it might not be a regression. Still should be understood though.",
        "createdAt": "2024-08-22T10:39:58Z",
        "author": {
          "login": "JanKrivanek"
        }
      }
    ]
  }
}