{
  "number": 2872,
  "title": "Csc compilation error output is not written to MSBuild output",
  "body": "### Steps to reproduce\r\n\r\n1. Install the dotnet sdk and runtime on Linux.\r\n\r\n2. Create a dotnet core application.\r\n\r\n    I used the Kestrel.Transport.Libuv.Tests project from the [KestrelHttpServer repo](https://github.com/aspnet/KestrelHttpServer).\r\n\r\n3. Introduce a compilation error in the application.\r\n\r\n### Expected  behavior\r\n\r\nThe reason for the compilation failure should be written to stdout or stderr. Instead, this is only available through binary logs which I had to copy to a Windows machine to look at using the structured log viewer http://msbuildlog.com/.\r\n\r\nEven then, the actual compilation errors weren't in an \"Errors\" section of the binary logs like I would expect, but it's under a section labled \"Microsoft (R) Visual C# Compiler version 2.7.0.62419 (34563958)\" which is just the first line of csc output.\r\n\r\n![image](https://user-images.githubusercontent.com/54385/35073049-11cc4bf0-fb9c-11e7-9a4f-1795cead4285.png)\r\n\r\n### Actual behavior\r\n\r\nMSBuild simply shows that csc exited with a non-zero status code.\r\n\r\n```\r\nshalter@f4-linux-server:~/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests$ dotnet msbuild\r\nMicrosoft (R) Build Engine version 15.6.22.57775 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Protocols.Abstractions -> /home/shalter/aspnet/KestrelHttpServer/src/Protocols.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Protocols.Abstractions.dll\r\n  Kestrel.Transport.Abstractions -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Transport.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.dll\r\n  Kestrel.Core -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Core -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netcoreapp2.1/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Transport.Libuv -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Transport.Libuv/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Libuv.dll\r\n/home/shalter/.dotnet/sdk/2.2.0-preview1-007866/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\n/home/shalter/.dotnet/sdk/2.2.0-preview1-007866/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nshalter@f4-linux-server:~/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests$ \r\n```\r\n\r\n### Environment data\r\n\r\n`msbuild /version` output:\r\n\r\n```\r\nshalter@f4-linux-server:~/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests$ dotnet msbuild /version\r\nMicrosoft (R) Build Engine version 15.6.22.57775 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n15.6.22.57775\r\n```\r\n\r\nOS info:\r\n\r\nI repro'd on Ubuntu 16.04.3 LTS and installed dotnet into my home directory using the `build.sh` script from one of the ASP.NET Core repos.\r\n\r\nIf applicable, version of the tool that invokes MSBuild (Visual Studio, dotnet CLI, etc):\r\n\r\n```\r\nshalter@f4-linux-server:~/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests$ dotnet --version\r\n2.2.0-preview1-007866\r\n```\r\n",
  "state": "CLOSED",
  "createdAt": "2018-01-17T23:38:10Z",
  "updatedAt": "2024-02-21T17:14:59Z",
  "closedAt": "2018-02-16T19:54:52Z",
  "author": {
    "login": "halter73"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": {
    "title": "MSBuild 15.7"
  },
  "comments": {
    "nodes": [
      {
        "body": "So not every compilation error seems to reproduce this behavior, so here are some more details on the type of compilation error that does.\r\n\r\n1. Take [commit f4d27e67bb](https://github.com/aspnet/KestrelHttpServer/commits/f4d27e67bbe770b0290f1a08c2e3401bae8686f0) from the Kestrel repo and build it once on linux using `build.sh /t:Compile`. This should complete successfully.\r\n2. Navigate to the KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests directory and verify that `~/.dotnet/dotnet msbuild` also completes successfully.\r\n3. Take the following diff and and apply it. E.g. `git apply mypatchfile.patch`\r\n```diff\r\ndiff --git a/test/Kestrel.Transport.Libuv.Tests/LibuvOutputConsumerTests.cs b/test/Kestrel.Transport.Libuv.Tests/LibuvOutputConsumerTests.cs\r\nindex 06576890..81213042 100644\r\n--- a/test/Kestrel.Transport.Libuv.Tests/LibuvOutputConsumerTests.cs\r\n+++ b/test/Kestrel.Transport.Libuv.Tests/LibuvOutputConsumerTests.cs\r\n@@ -412,8 +412,8 @@ public void Dispose()\r\n             });\r\n         }\r\n \r\n-        [Theory]\r\n-        [MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n+        //[Theory]\r\n+        //[MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n         public async Task CancelsBeforeWriteRequestCompletes(int maxResponseBufferSize)\r\n         {\r\n             await Task.Run(async () =>\r\n@@ -496,8 +496,8 @@ public void Dispose()\r\n             });\r\n         }\r\n \r\n-        [Theory]\r\n-        [MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n+        //[Theory]\r\n+        //[MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n         public async Task WriteAsyncWithTokenAfterCallWithoutIsCancelled(int maxResponseBufferSize)\r\n         {\r\n             await Task.Run(async () =>\r\n@@ -582,8 +582,8 @@ public void Dispose()\r\n             });\r\n         }\r\n \r\n-        [Theory]\r\n-        [MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n+        //[Theory]\r\n+        //[MemberData(nameof(PositiveMaxResponseBufferSizeData))]\r\n         public async Task WritesDontGetCompletedTooQuickly(int maxResponseBufferSize)\r\n         {\r\n             var completeQueue = new ConcurrentQueue<Action<int>>();\r\n@@ -639,8 +639,8 @@ public void Dispose()\r\n             }\r\n         }\r\n \r\n-        [Theory]\r\n-        [MemberData(nameof(MaxResponseBufferSizeData))]\r\n+        //[Theory]\r\n+        //[MemberData(nameof(MaxResponseBufferSizeData))]\r\n         public async Task WritesAreAggregated(long? maxResponseBufferSize)\r\n         {\r\n             var writeCalled = false;\r\n\r\n```\r\n4. Ensure you're still in the KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests directory and verify that `~/.dotnet/dotnet msbuild` now completes with the following nondescript error.\r\n\r\n```\r\nshalter@f4-linux-server:~/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests$ ~/.dotnet/dotnet msbuild\r\nMicrosoft (R) Build Engine version 15.6.22.57775 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Protocols.Abstractions -> /home/shalter/aspnet/KestrelHttpServer/src/Protocols.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Protocols.Abstractions.dll\r\n  Kestrel.Transport.Abstractions -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Transport.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.dll\r\n  Kestrel.Core -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Core -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netcoreapp2.1/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Transport.Libuv -> /home/shalter/aspnet/KestrelHttpServer/src/Kestrel.Transport.Libuv/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Libuv.dll\r\n/home/shalter/.dotnet/sdk/2.2.0-preview1-007866/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\n/home/shalter/.dotnet/sdk/2.2.0-preview1-007866/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\n``` \r\n\r\nThe output should actually look more like this (taken from macOS):\r\n```\r\nshalter@halter73-mbp Kestrel.Transport.Libuv.Tests (dev*$% u=)$ ~/.dotnet/dotnet msbuild\r\nMicrosoft (R) Build Engine version 15.6.22.57775 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Protocols.Abstractions -> /Users/shalter/source/aspnet/KestrelHttpServer/src/Protocols.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Protocols.Abstractions.dll\r\n  Kestrel.Transport.Abstractions -> /Users/shalter/source/aspnet/KestrelHttpServer/src/Kestrel.Transport.Abstractions/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Abstractions.dll\r\n  Kestrel.Core -> /Users/shalter/source/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Core -> /Users/shalter/source/aspnet/KestrelHttpServer/src/Kestrel.Core/bin/Debug/netcoreapp2.1/Microsoft.AspNetCore.Server.Kestrel.Core.dll\r\n  Kestrel.Transport.Libuv -> /Users/shalter/source/aspnet/KestrelHttpServer/src/Kestrel.Transport.Libuv/bin/Debug/netstandard2.0/Microsoft.AspNetCore.Server.Kestrel.Transport.Libuv.dll\r\nLibuvOutputConsumerTests.cs(417,27): error xUnit1013: Public method 'CancelsBeforeWriteRequestCompletes' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(501,27): error xUnit1013: Public method 'WriteAsyncWithTokenAfterCallWithoutIsCancelled' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(587,27): error xUnit1013: Public method 'WritesDontGetCompletedTooQuickly' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(644,27): error xUnit1013: Public method 'WritesAreAggregated' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(417,27): error xUnit1013: Public method 'CancelsBeforeWriteRequestCompletes' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(501,27): error xUnit1013: Public method 'WriteAsyncWithTokenAfterCallWithoutIsCancelled' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(587,27): error xUnit1013: Public method 'WritesDontGetCompletedTooQuickly' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\nLibuvOutputConsumerTests.cs(644,27): error xUnit1013: Public method 'WritesAreAggregated' on test class 'LibuvOutputConsumerTests' should be marked as a Theory. [/Users/shalter/source/aspnet/KestrelHttpServer/test/Kestrel.Transport.Libuv.Tests/Kestrel.Transport.Libuv.Tests.csproj]\r\n```\r\n\r\n",
        "createdAt": "2018-01-18T00:47:49Z",
        "updatedAt": "2018-01-18T00:47:49Z",
        "author": {
          "login": "halter73"
        }
      },
      {
        "body": "Are there smaller steps to repro this? Like create a console app `donte new console -n test` and run `dotnet msbuild test/test.csproj` and find no error in output? ",
        "createdAt": "2018-01-18T21:33:43Z",
        "updatedAt": "2018-01-18T21:33:43Z",
        "author": {
          "login": "ghost"
        }
      },
      {
        "body": "I'm sure there are smaller steps to repro, but I haven't found them. If I do find a simpler repro, I'll post it here.",
        "createdAt": "2018-01-18T22:56:04Z",
        "updatedAt": "2018-01-18T22:56:04Z",
        "author": {
          "login": "halter73"
        }
      },
      {
        "body": "@kasper3 I now have a simpler repro. I found this bug occurs on macOS as well, but I haven't seen this issue yet on Windows.\r\n\r\nClone https://github.com/halter73/signalr-verification/tree/halter73/msbuild/2872 and checkout the halter73/msbuild/2872 branch. Then simply run \"dotnet build\".\r\n\r\nOn Linux and macOS, you'll see output like the following:\r\n\r\n```\r\nshalter@f4-linux-server:~/signalr-verification/signalr-verification$ dotnet build\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Restore completed in 35.09 ms for /home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj.\r\n  Restore completed in 96.72 ms for /home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj.\r\n/home/shalter/signalr-verification/dotnet/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\n/home/shalter/signalr-verification/dotnet/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj]\r\n    0 Warning(s)\r\n    1 Error(s)\r\n\r\nTime Elapsed 00:00:02.57\r\n```\r\n\r\nWindows exhibits the expected behavior and outputs the cause of the build error:\r\n\r\n```\r\nG:\\dev\\halter73\\signalr-verification [halter73/msbuild/2872 \u2261]> dotnet build\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Restoring packages for G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj...\r\n  Restoring packages for G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj...\r\n  Restore completed in 1.18 sec for G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj.\r\n  Generating MSBuild file G:\\dev\\halter73\\signalr-verification\\obj\\signalr-verification.csproj.nuget.g.props.\r\n  Generating MSBuild file G:\\dev\\halter73\\signalr-verification\\obj\\signalr-verification.csproj.nuget.g.targets.\r\n  Restore completed in 1.33 sec for G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj.\r\nProgram.cs(18,13): error CS0103: The name 'foo' does not exist in the current context [G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj]\r\nProgram.cs(18,13): error CS0201: Only assignment, call, increment, decrement, and new object expressions can be used as a statement [G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\nProgram.cs(18,13): error CS0103: The name 'foo' does not exist in the current context [G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj]\r\nProgram.cs(18,13): error CS0201: Only assignment, call, increment, decrement, and new object expressions can be used as a statement [G:\\dev\\halter73\\signalr-verification\\signalr-verification.csproj]\r\n    0 Warning(s)\r\n    2 Error(s)\r\n\r\nTime Elapsed 00:00:04.79\r\n```\r\n\r\nOn Linux and macOS, the error is only available through binary logs. Like before, the actual compilation errors weren't in an \"Errors\" section of the binary logs like I would expect, but it's under a section labled \"Microsoft (R) Visual C# Compiler version 2.8.0.62602 (66358873)...\" which is just the first line of csc output.\r\n\r\nClicking the \"Errors\" section just shows Microsoft.CSharp.Core.targets in the right panel.\r\n\r\n```\r\nshalter@halter73-mbp signalr-verification (halter73/msbuild/2872)$ dotnet build /bl\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n/Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/MSBuild.dll /bl /clp:Summary /distributedlogger:Microsoft.DotNet.Tools.MSBuild.MSBuildLogger,/Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/dotnet.dll*Microsoft.DotNet.Tools.MSBuild.MSBuildForwardingLogger,/Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/dotnet.dll /m /restore /t:Build /v:m ./signalr-verification.csproj\r\n  Restore completed in 111.25 ms for /Users/shalter/source/halter73/signalr-verification/signalr-verification.csproj.\r\n  Restore completed in 42.93 ms for /Users/shalter/source/halter73/signalr-verification/signalr-verification.csproj.\r\n/Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/Users/shalter/source/halter73/signalr-verification/signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\n/Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/Users/shalter/source/halter73/signalr-verification/signalr-verification.csproj]\r\n    0 Warning(s)\r\n    1 Error(s)\r\n```\r\n\r\n![screen shot 2018-02-09 at 5 05 45 pm](https://user-images.githubusercontent.com/54385/36056727-b0594a12-0dbb-11e8-9b4b-83cbcddc1e5f.png)\r\n\r\n![screen shot 2018-02-09 at 5 05 28 pm](https://user-images.githubusercontent.com/54385/36056714-98eaf27c-0dbb-11e8-9923-a5d271492bc5.png)\r\n\r\nNotably, if you take the previous commit (halter73/msbuild/2872~1) which also doesn't build due to a missing semicolon instead of a nonexistent name, the cause of the build error *is* output as expected on Linux and macOS.\r\n\r\n```\r\nshalter@f4-linux-server:~/signalr-verification/signalr-verification$ git reset --hard HEAD~\r\nHEAD is now at 7e6378a Introduce build error displayed by msbuild\r\nshalter@f4-linux-server:~/signalr-verification/signalr-verification$ dotnet build\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Restore completed in 35.58 ms for /home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj.\r\n  Restore completed in 83.96 ms for /home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj.\r\nMicrosoft (R) Visual C# Compiler version 2.8.0.62608 (b2a417c1)\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nProgram.cs(18,16) : error CS1002: ; expected [/home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\nMicrosoft (R) Visual C# Compiler version 2.8.0.62608 (b2a417c1)\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nProgram.cs(18,16) : error CS1002: ; expected [/home/shalter/signalr-verification/signalr-verification/signalr-verification.csproj]\r\n    0 Warning(s)\r\n    1 Error(s)\r\n\r\nTime Elapsed 00:00:02.40\r\n```\r\n",
        "createdAt": "2018-02-10T01:07:29Z",
        "updatedAt": "2018-02-10T01:25:54Z",
        "author": {
          "login": "halter73"
        }
      },
      {
        "body": "### Environment Data\r\n\r\nThe below info was taken from the Linux, macOS and Windows sdks used to produce the output in above comment. Version 2.2.0-preview1-008003 of the .NET SDK on my Mac does *not* exhibit this bug unlike version 2.1.300-preview1-008117 which does. Is it possible that the issue has already been fixed?\r\n\r\n```\r\n$ dotnet --info\r\n.NET Command Line Tools (2.1.300-preview1-008117)\r\n\r\nProduct Information:\r\n Version:            2.1.300-preview1-008117\r\n Commit SHA-1 hash:  60614db20c\r\n\r\nRuntime Environment:\r\n OS Name:     ubuntu\r\n OS Version:  16.04\r\n OS Platform: Linux\r\n RID:         ubuntu.16.04-x64\r\n Base Path:   /home/shalter/signalr-verification/dotnet/sdk/2.1.300-preview1-008117/\r\n\r\nMicrosoft .NET Core Shared Framework Host\r\n\r\n  Version  : 2.1.0-preview1-26208-06\r\n  Build    : f2c3216183d20416568a4bbf5bb7d153e826f153\r\n```\r\n\r\n```\r\n$ dotnet --info\r\n.NET Command Line Tools (2.1.300-preview1-008117)\r\n\r\nProduct Information:\r\n Version:            2.1.300-preview1-008117\r\n Commit SHA-1 hash:  60614db20c\r\n\r\nRuntime Environment:\r\n OS Name:     Mac OS X\r\n OS Version:  10.13\r\n OS Platform: Darwin\r\n RID:         osx.10.12-x64\r\n Base Path:   /Users/shalter/Downloads/dotnet-sdk-2.1.300-preview1-008117-osx-x64/sdk/2.1.300-preview1-008117/\r\n\r\nMicrosoft .NET Core Shared Framework Host\r\n\r\n  Version  : 2.1.0-preview1-26208-06\r\n  Build    : f2c3216183d20416568a4bbf5bb7d153e826f153\r\n```\r\n\r\n```\r\n> dotnet --info\r\n.NET Command Line Tools (2.1.300-preview1-008117)\r\n\r\nProduct Information:\r\n Version:            2.1.300-preview1-008117\r\n Commit SHA-1 hash:  60614db20c\r\n\r\nRuntime Environment:\r\n OS Name:     Windows\r\n OS Version:  10.0.16299\r\n OS Platform: Windows\r\n RID:         win10-x64\r\n Base Path:   C:\\Users\\shalter\\Downloads\\dotnet-sdk-2.1.300-preview1-008117-win-x64\\sdk\\2.1.300-preview1-008117\\\r\n\r\nMicrosoft .NET Core Shared Framework Host\r\n\r\n  Version  : 2.1.0-preview1-26208-06\r\n  Build    : f2c3216183d20416568a4bbf5bb7d153e826f153\r\n```",
        "createdAt": "2018-02-10T01:13:20Z",
        "updatedAt": "2018-02-10T01:18:27Z",
        "author": {
          "login": "halter73"
        }
      },
      {
        "body": "Disabling the compiler server causes it to behave correctly:\r\n\r\n```sh-session\r\nraines@raines-z220u:~/src/signalr-verification$ ~/Downloads/dotnet-sdk/dotnet --version\r\n2.1.300-preview1-008117\r\nraines@raines-z220u:~/src/signalr-verification$ ~/Downloads/dotnet-sdk/dotnet build\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Restore completed in 55.53 ms for /home/raines/src/signalr-verification/signalr-verification.csproj.\r\n  Restore completed in 15.17 ms for /home/raines/src/signalr-verification/signalr-verification.csproj.\r\n/home/raines/Downloads/dotnet-sdk/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\n/home/raines/Downloads/dotnet-sdk/sdk/2.1.300-preview1-008117/Roslyn/Microsoft.CSharp.Core.targets(84,5): error MSB6006: \"csc.dll\" exited with code 1. [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\n    0 Warning(s)\r\n    1 Error(s)\r\n\r\nTime Elapsed 00:00:02.12\r\nraines@raines-z220u:~/src/signalr-verification$ ~/Downloads/dotnet-sdk/dotnet build /p:UseSharedCompilation=false\r\nMicrosoft (R) Build Engine version 15.7.10.24921 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n  Restore completed in 56 ms for /home/raines/src/signalr-verification/signalr-verification.csproj.\r\n  Restore completed in 14.99 ms for /home/raines/src/signalr-verification/signalr-verification.csproj.\r\nProgram.cs(18,13): error CS0103: The name 'foo' does not exist in the current context [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\nProgram.cs(18,13): error CS0201: Only assignment, call, increment, decrement, and new object expressions can be used as a statement [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\n\r\nBuild FAILED.\r\n\r\nProgram.cs(18,13): error CS0103: The name 'foo' does not exist in the current context [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\nProgram.cs(18,13): error CS0201: Only assignment, call, increment, decrement, and new object expressions can be used as a statement [/home/raines/src/signalr-verification/signalr-verification.csproj]\r\n    0 Warning(s)\r\n    2 Error(s)\r\n\r\nTime Elapsed 00:00:02.57\r\n```\r\n\r\nThat makes me suspect that it's the Csc task that's doing something different in different circumstances here.",
        "createdAt": "2018-02-13T00:23:18Z",
        "updatedAt": "2018-02-13T00:23:18Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@halter73 Thanks for the reduced repro! That helped track it down. I think this is best tracked as https://github.com/dotnet/roslyn/issues/24736 but I don't have permissions to reactivate it over there so I'll leave it open here until someone does so, so it doesn't get lost.",
        "createdAt": "2018-02-13T19:22:52Z",
        "updatedAt": "2018-02-13T19:22:52Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Duplicate of https://github.com/dotnet/roslyn/issues/24736",
        "createdAt": "2018-02-16T19:54:52Z",
        "updatedAt": "2018-02-16T19:54:52Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}