{
  "number": 3028,
  "title": "KillToolProcessOnTimeout should catch InvalidOperationException and either error or (in cancelation) eat it",
  "body": "### Steps to reproduce\r\n\r\nHit Ctrl-C at a particular moment during a build and you will get an InvalidOperationException callstack. The bug is that `KillToolProcessOnTimeout(Process proc, Boolean isBeingCancelled)` should catch `InvalidOperationException` cleanly and show an error message, unless isBeingCancellled is true in which case it should just eat it and return because this is an expected result of processes being killed.\r\n```\r\n       (CoreGenerateSatelliteAssemblies target) -> \r\n         /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error MSB3883: Unexpected exception:  [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n         /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error : System.InvalidOperationException: Process has exited, so the requested information is not available. [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at System.Diagnostics.Process.EnsureState(State state) [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at System.Diagnostics.Process.get_ProcessName() [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at Microsoft.Build.Utilities.ToolTask.KillToolProcessOnTimeout(Process proc, Boolean isBeingCancelled) in E:\\A\\_work\\82\\s\\src\\Utilities\\ToolTask.cs:line 1080 [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at Microsoft.Build.Utilities.ToolTask.TerminateToolProcess(Process proc, Boolean isBeingCancelled) in E:\\A\\_work\\82\\s\\src\\Utilities\\ToolTask.cs:line 1136 [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at Microsoft.Build.Utilities.ToolTask.HandleToolNotifications(Process proc) in E:\\A\\_work\\82\\s\\src\\Utilities\\ToolTask.cs:line 1027 [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at Microsoft.Build.Utilities.ToolTask.ExecuteTool(String pathToTool, String responseFileCommands, String commandLineCommands) in E:\\A\\_work\\82\\s\\src\\Utilities\\ToolTask.cs:line 880 [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n       /home/dan/git/cli/.dotnet_stage0/x64/sdk/2.2.0-preview1-007799/Sdks/Microsoft.NET.Sdk/build/Microsoft.NET.Sdk.targets(432,5): error :    at Microsoft.CodeAnalysis.BuildTasks.ManagedCompiler.ExecuteTool(String pathToTool, String responseFileCommands, String commandLineCommands) [/home/dan/git/cli/src/Microsoft.DotNet.Cli.Utils/Microsoft.DotNet.Cli.Utils.csproj]\r\n```\r\nThis is in the CLI build, so it's probably not a released version, but I doubt it matters for this issue:\r\n```\r\nMicrosoft (R) Build Engine version 15.6.12.27473 for .NET Core\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n```",
  "state": "CLOSED",
  "createdAt": "2018-02-25T01:26:50Z",
  "updatedAt": "2024-02-21T17:14:18Z",
  "closedAt": "2018-02-27T06:32:34Z",
  "author": {
    "login": "danmoseley"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": []
  }
}