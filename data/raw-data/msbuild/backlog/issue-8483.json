{
  "number": 8483,
  "title": "Ungraceful failure when requesting taskhost that doesn't exist",
  "body": "> I've tried building the following on a regular Intel machine and while it fails spectacularly, this change doesn't seem to make a difference.\r\n> \r\n> ```xml\r\n> <Project>\r\n>   <UsingTask TaskName=\"Message\" AssemblyFile=\"$(MSBuildToolsPath)\\Microsoft.Build.Tasks.Core.dll\" Architecture=\"arm64\" />\r\n>   <Target Name=\"Build\">\r\n>     <Message />\r\n>   </Target>\r\n> </Project>\r\n> ```\r\n\r\n_Originally posted by @ladipro in https://github.com/dotnet/msbuild/issues/8473#issuecomment-1440054181_\r\n            \r\n            \r\n... and indeed it _is_ a spectacular failure:\r\n\r\n```\r\n\u276f msbuild .\\foo.proj -v:q\r\nMSBuild version 17.6.0-preview-23117-04+c5cceaabe for .NET Framework\r\nMSBUILD : error : This is an unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE AT https://aka.ms/msbuild/unhandled. [S:\\msbui\r\nld\\foo.proj]\r\nMSBUILD : error :     Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Cannot acquire required number of nodes. [S:\\msbuild\\f\r\noo.proj]\r\nMSBUILD : error : ============= [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.ex\r\ne could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm\r\n64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : ---> (Inner Exception #0) Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child\r\nnode as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, spec\r\nify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)<--- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  ---> System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBu\r\nild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\B\r\nin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.pr\r\noj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Exception innerException, Object[] args) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.GetNodes(String msbuildLocation, String commandLineArgs, Int32 nextNodeId, INodePacke\r\ntFactory factory, Handshake hostHandshake, NodeContextCreatedDelegate createNode, NodeContextTerminateDelegate terminateNode, Int32 numberOfNodesToCreate) [S:\\\r\nmsbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.CreateNode(HandshakeOptions hostContext, INodePacketFactory factory, INodePacketH\r\nandler handler, TaskHostConfiguration configuration) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.AcquireAndSetUpHost(HandshakeOptions hostContext, INodePacketFactory factory, INo\r\ndePacketHandler handler, TaskHostConfiguration configuration) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskHostTask.Execute() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteInstantiatedTask>d__26.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<InitializeAndExecuteTask>d__24.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteBucket>d__19.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__18.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__13.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ProcessBucket>d__51.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ExecuteTarget>d__44.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__23.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__10.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext() [S:\\msbuild\\foo.proj]\r\n\r\nBuild FAILED.\r\n\r\nMSBUILD : error : This is an unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE AT https://aka.ms/msbuild/unhandled. [S:\\msbui\r\nld\\foo.proj]\r\nMSBUILD : error :     Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Cannot acquire required number of nodes. [S:\\msbuild\\f\r\noo.proj]\r\nMSBUILD : error : ============= [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.ex\r\ne could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm\r\n64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : ---> (Inner Exception #0) Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child\r\nnode as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, spec\r\nify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)<--- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :  ---> System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBu\r\nild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\B\r\nin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable. [S:\\msbuild\\foo.pr\r\noj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    --- End of inner exception stack trace --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Exception innerException, Object[] args) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.GetNodes(String msbuildLocation, String commandLineArgs, Int32 nextNodeId, INodePacke\r\ntFactory factory, Handshake hostHandshake, NodeContextCreatedDelegate createNode, NodeContextTerminateDelegate terminateNode, Int32 numberOfNodesToCreate) [S:\\\r\nmsbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.CreateNode(HandshakeOptions hostContext, INodePacketFactory factory, INodePacketH\r\nandler handler, TaskHostConfiguration configuration) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.AcquireAndSetUpHost(HandshakeOptions hostContext, INodePacketFactory factory, INo\r\ndePacketHandler handler, TaskHostConfiguration configuration) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskHostTask.Execute() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteInstantiatedTask>d__26.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<InitializeAndExecuteTask>d__24.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteBucket>d__19.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__18.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__13.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ProcessBucket>d__51.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ExecuteTarget>d__44.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__23.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__10.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw() [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [S:\\msbuild\\foo.proj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext() [S:\\msbuild\\foo.proj]\r\n    0 Warning(s)\r\n    1 Error(s)\r\n\r\nTime Elapsed 00:00:00.12\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Cannot acquire required number of nodes.\r\n=============\r\nSystem.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n---> (Inner Exception #0) Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)<---\r\n\r\n\r\n ---> System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.Shared.ErrorUtilities.ThrowInternalError(String message, Exception innerException, Object[] args)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.GetNodes(String msbuildLocation, String commandLineArgs, Int32 nextNodeId, INodePacketFactory factory, Handshake hostHandshake, NodeContextCreatedDelegate createNode, NodeContextTerminateDelegate terminateNode, Int32 numberOfNodesToCreate)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.CreateNode(HandshakeOptions hostContext, INodePacketFactory factory, INodePacketHandler handler, TaskHostConfiguration configuration)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcTaskHost.AcquireAndSetUpHost(HandshakeOptions hostContext, INodePacketFactory factory, INodePacketHandler handler, TaskHostConfiguration configuration)\r\n   at Microsoft.Build.BackEnd.TaskHostTask.Execute()\r\n   at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute()\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteInstantiatedTask>d__26.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<InitializeAndExecuteTask>d__24.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteBucket>d__19.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__18.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteTask>d__13.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetEntry.<ProcessBucket>d__51.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetEntry.<ExecuteTarget>d__44.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__23.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__10.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at Microsoft.Build.BackEnd.RequestBuilder.<RequestThreadProc>d__58.MoveNext()\r\n\r\nMSBUILD : error MSB1025: An internal failure occurred while running MSBuild.\r\nMicrosoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Cannot acquire required number of nodes.\r\n=============\r\nSystem.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n---> (Inner Exception #0) Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)<---\r\n\r\n\r\n ---> System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsNotAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, ProjectIsolationMode isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache, String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n\r\nUnhandled Exception: Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Cannot acquire required number of nodes.\r\n=============\r\nSystem.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n---> (Inner Exception #0) Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)<---\r\n\r\n\r\n ---> System.AggregateException: One or more errors occurred. ---> Microsoft.Build.Exceptions.BuildAbortedException: Build was canceled. MSBuild.exe could not be launched as a child node as it could not be found at the location \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Preview\\MSBuild\\Current\\Bin\\arm64\\MSBuild.exe\". If necessary, specify the correct location in the BuildParameters, or with the MSBUILD_EXE_PATH environment variable.\r\n   at Microsoft.Build.BackEnd.NodeLauncher.StartInternal(String msbuildLocation, String commandLineArgs)\r\n   at Microsoft.Build.BackEnd.NodeLauncher.DisableMSBuildServer(Func`1 func)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>g__StartNewNode|2(Int32 nodeId)\r\n   at Microsoft.Build.BackEnd.NodeProviderOutOfProcBase.<>c__DisplayClass14_0.<GetNodes>b__0(Int32 nodeId)\r\n   --- End of inner exception stack trace ---\r\n   --- End of inner exception stack trace ---\r\n   at Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsNotAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, ProjectIsolationMode isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache, String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\n   at Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n   ```",
  "state": "OPEN",
  "createdAt": "2023-02-22T16:47:30Z",
  "updatedAt": "2024-01-31T08:14:59Z",
  "closedAt": null,
  "author": {
    "login": "rainersigwald"
  },
  "labels": [
    "backlog",
    "Area: Debuggability",
    "Architecture: ARM64",
    "Area: TaskHost",
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Related to the issue of asking for for an unsupported architecture, the text of `MSB4215` should also be updated. Currently it's missing arm64.\r\n\r\n```\r\nerror MSB4215: The \"Message\" task could not be loaded. \"s360\" is an invalid value for the task host parameter \"Architecture\". Valid values are:  \"x86\", \"x64\", \"CurrentArchitecture\", and \"*\"; not specifying a value is also valid.\r\n```",
        "createdAt": "2023-02-24T09:24:15Z",
        "updatedAt": "2023-02-24T09:24:15Z",
        "author": {
          "login": "ladipro"
        }
      }
    ]
  }
}