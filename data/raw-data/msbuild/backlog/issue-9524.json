{
  "number": 9524,
  "title": "[Bug]: TreatWarningsAsErrors reverse behaviour",
  "body": "### Issue Description\r\n\r\nIm hosting my code in Azure DevOps and Im using Yaml pipelines to build my app. I tried to run a pipeline today but I got an issue:\r\n![image](https://github.com/dotnet/msbuild/assets/18653765/11fe0f0c-0254-4e65-82ec-9d9db8d52d66)\r\n\r\nPrevious build was successful and I did not make any changes to the code:\r\n![image](https://github.com/dotnet/msbuild/assets/18653765/87c96d26-f7a0-45e5-bb0e-ad81b37b3a76)\r\n\r\nI noticed that MSBuild changed from version 17.7.3+8ec440e68 to version 17.8.3+195e7f5a3.\r\n\r\nMy next step was to reproduce the issue locally, because when I built the project locally everything went without issues. I noticed there is an update for my VS Studio Enterprise so I installed it and it changed the MSBuild version locally: \r\n![image](https://github.com/dotnet/msbuild/assets/18653765/8a14f78e-de58-4956-9697-223191b8ad0a)\r\n\r\nafter the update, build started to fail with the same issues as in the pipeline:\r\n![image](https://github.com/dotnet/msbuild/assets/18653765/b1418d10-2a17-46c9-bfdd-d0101beca800)\r\n\r\nThis the csproj file that I used previously without wny issues:\r\n```\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n  <PropertyGroup>\r\n\t\t<TargetFramework>net6.0</TargetFramework>\r\n\t\t<AzureFunctionsVersion>v4</AzureFunctionsVersion>\r\n\t\t<OutputType>Exe</OutputType>\r\n\t\t<ImplicitUsings>enable</ImplicitUsings>\r\n    <CodeAnalysisTreatWarningsAsErrors>False</CodeAnalysisTreatWarningsAsErrors>\r\n\t</PropertyGroup>\r\n  <ItemGroup>\r\n    <PackageReference Include=\"Microsoft.Azure.Cosmos\" Version=\"3.32.3\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Timer\" Version=\"4.1.0\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Http.Polly\" Version=\"6.0.5\" />\r\n    <PackageReference Include=\"Polly.Extensions.Http\" Version=\"3.0.0\" />\r\n    <PackageReference Include=\"Azure.Data.Tables\" Version=\"12.7.1\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Azure\" Version=\"1.6.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker\" Version=\"1.13.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Sdk\" Version=\"1.9.0\" />\r\n    <PackageReference Include=\"Microsoft.ApplicationInsights.DependencyCollector\" Version=\"2.21.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Http\" Version=\"3.0.13\" />\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n\t\t<None Update=\"host.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t</None>\r\n\t\t<None Update=\"local.settings.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t\t<CopyToPublishDirectory>Never</CopyToPublishDirectory>\r\n\t\t</None>\r\n\t</ItemGroup>\r\n\t<ItemGroup>\r\n\t\t<Using Include=\"System.Threading.ExecutionContext\" Alias=\"ExecutionContext\" />\r\n\t</ItemGroup>\r\n</Project>\r\n```\r\n\r\nwhat fixes the issue for me is to add the below lines to the csproj:\r\n```\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n```\r\n\r\nThis is the way I understand it should work:\r\n- For 'TreatWarningsAsErrors' set to true build should fail with issues like [CA1305](https://learn.microsoft.com/en-gb/dotnet/fundamentals/code-analysis/quality-rules/ca1305) or [CA1822](https://learn.microsoft.com/en-gb/dotnet/fundamentals/code-analysis/quality-rules/ca1822), just like it fails on the screenshots added above\r\n- For 'TreatWarningsAsErrors' set to false build should ignore this type of warning and build without issues\r\n\r\nRight now behavior is reversed, when I set TreatWarningsAsErrors to True build is successful.\r\n\r\n\r\n### Steps to Reproduce\r\n\r\nSteps in the description, below csproj working correctly:\r\n\r\n```\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n  <PropertyGroup>\r\n\t\t<TargetFramework>net6.0</TargetFramework>\r\n\t\t<AzureFunctionsVersion>v4</AzureFunctionsVersion>\r\n\t\t<OutputType>Exe</OutputType>\r\n\t\t<ImplicitUsings>enable</ImplicitUsings>\r\n    <CodeAnalysisTreatWarningsAsErrors>False</CodeAnalysisTreatWarningsAsErrors>\r\n\t</PropertyGroup>\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n  <ItemGroup>\r\n    <PackageReference Include=\"Microsoft.Azure.Cosmos\" Version=\"3.32.3\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Timer\" Version=\"4.1.0\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Http.Polly\" Version=\"6.0.5\" />\r\n    <PackageReference Include=\"Polly.Extensions.Http\" Version=\"3.0.0\" />\r\n    <PackageReference Include=\"Azure.Data.Tables\" Version=\"12.7.1\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Azure\" Version=\"1.6.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker\" Version=\"1.13.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Sdk\" Version=\"1.9.0\" />\r\n    <PackageReference Include=\"Microsoft.ApplicationInsights.DependencyCollector\" Version=\"2.21.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Http\" Version=\"3.0.13\" />\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n\t\t<None Update=\"host.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t</None>\r\n\t\t<None Update=\"local.settings.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t\t<CopyToPublishDirectory>Never</CopyToPublishDirectory>\r\n\t\t</None>\r\n\t</ItemGroup>\r\n\t<ItemGroup>\r\n\t\t<Using Include=\"System.Threading.ExecutionContext\" Alias=\"ExecutionContext\" />\r\n\t</ItemGroup>\r\n</Project>\r\n```\r\n\r\nbut this is is not:\r\n\r\n```\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n  <PropertyGroup>\r\n\t\t<TargetFramework>net6.0</TargetFramework>\r\n\t\t<AzureFunctionsVersion>v4</AzureFunctionsVersion>\r\n\t\t<OutputType>Exe</OutputType>\r\n\t\t<ImplicitUsings>enable</ImplicitUsings>\r\n    <CodeAnalysisTreatWarningsAsErrors>False</CodeAnalysisTreatWarningsAsErrors>\r\n\t</PropertyGroup>\r\n  <ItemGroup>\r\n    <PackageReference Include=\"Microsoft.Azure.Cosmos\" Version=\"3.32.3\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.ApplicationInsights\" Version=\"1.0.0-preview4\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Timer\" Version=\"4.1.0\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Http.Polly\" Version=\"6.0.5\" />\r\n    <PackageReference Include=\"Polly.Extensions.Http\" Version=\"3.0.0\" />\r\n    <PackageReference Include=\"Azure.Data.Tables\" Version=\"12.7.1\" />\r\n    <PackageReference Include=\"Microsoft.Extensions.Azure\" Version=\"1.6.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker\" Version=\"1.13.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Sdk\" Version=\"1.9.0\" />\r\n    <PackageReference Include=\"Microsoft.ApplicationInsights.DependencyCollector\" Version=\"2.21.0\" />\r\n    <PackageReference Include=\"Microsoft.Azure.Functions.Worker.Extensions.Http\" Version=\"3.0.13\" />\r\n  </ItemGroup>\r\n  <ItemGroup>\r\n\t\t<None Update=\"host.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t</None>\r\n\t\t<None Update=\"local.settings.json\">\r\n\t\t\t<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>\r\n\t\t\t<CopyToPublishDirectory>Never</CopyToPublishDirectory>\r\n\t\t</None>\r\n\t</ItemGroup>\r\n\t<ItemGroup>\r\n\t\t<Using Include=\"System.Threading.ExecutionContext\" Alias=\"ExecutionContext\" />\r\n\t</ItemGroup>\r\n</Project>\r\n```\r\n\r\nonly difference is:\r\n\r\n```\r\n<PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Debug|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n  <PropertyGroup Condition=\"'$(Configuration)|$(Platform)'=='Release|AnyCPU'\">\r\n    <TreatWarningsAsErrors>True</TreatWarningsAsErrors>\r\n  </PropertyGroup>\r\n```\r\n\r\n### Expected Behavior\r\n\r\nSuccessful build, ignoring warnings\r\n\r\n### Actual Behavior\r\n\r\nFailed build because of warnings\r\n\r\n### Analysis\r\n\r\n_No response_\r\n\r\n### Versions & Configurations\r\n\r\nMSBuild 17.8.3+195e7f5a3 dla .NET Framework\r\n17.8.3.51904\r\n",
  "state": "CLOSED",
  "createdAt": "2023-12-12T16:53:54Z",
  "updatedAt": "2024-06-07T12:01:36Z",
  "closedAt": "2024-06-07T12:01:34Z",
  "author": {
    "login": "Planche95"
  },
  "labels": [
    "bug",
    "needs-more-info",
    "stale",
    "closed-by-bot",
    "triaged"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "maridematte"
      }
    ]
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Another project. \r\n\r\n**Case 1**\r\n- CodeAnalysisTreatWarningsAsErrors set to False\r\n- TreatWarningsAsErrors set to False\r\n\r\nResult: 3 Warnings and 1 Error\r\n![image](https://github.com/dotnet/msbuild/assets/18653765/08274093-3243-4678-b817-4f5438ef6b0e)\r\n\r\n**Case 2**\r\n- CodeAnalysisTreatWarningsAsErrors set to False\r\n- TreatWarningsAsErrors set to True\r\n\r\nResult: 3 Warnings and 1 Error\r\n\r\nResult: Previous 3 Warnings are now errors but previous errors disappear\r\n![image](https://github.com/dotnet/msbuild/assets/18653765/dd23662b-1cdc-43af-836e-d3b9813a3ced)\r\n\r\nIt looks like CodeAnalysisTreatWarningsAsErrors doesn't work without TreatWarningsAsErrors set to True, but it gets rid of one type of error to get another.",
        "createdAt": "2023-12-13T09:36:26Z",
        "updatedAt": "2023-12-13T09:36:26Z",
        "author": {
          "login": "Planche95"
        }
      },
      {
        "body": "Hello, \r\nI was unable to repro this in version 17.8, even with the examples of the files that you have added to your post. Is it possible that another project is overriding the build settings?\r\n\r\nAnd, could you please try to run this file with a small sample project (just a `helloWorls.cs` file with some unused variable in it for a warning) on your machine to check for the same behaviour. If you still see this behaviour please send us a binlog through (more information on how to do that [is here](https://github.com/dotnet/msbuild/blob/main/documentation/wiki/Providing-Binary-Logs.md))",
        "createdAt": "2024-04-23T10:39:51Z",
        "updatedAt": "2024-04-23T10:39:51Z",
        "author": {
          "login": "maridematte"
        }
      },
      {
        "body": "This issue is marked as stale because feedback has been requested for 30 days with no response. Please respond within 14 days or this issue will be closed due to inactivity.\n<!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. -->",
        "createdAt": "2024-05-23T17:03:57Z",
        "updatedAt": "2024-05-23T17:03:57Z",
        "author": {
          "login": "dotnet-policy-service[bot]"
        }
      },
      {
        "body": "This issue was closed due to inactivity. If you can still reproduce this bug, please comment with the requested information, detailed steps to reproduce the problem, or any other notes that might help in the investigation.\n<!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. -->",
        "createdAt": "2024-06-07T12:01:35Z",
        "updatedAt": "2024-06-07T12:01:35Z",
        "author": {
          "login": "dotnet-policy-service[bot]"
        }
      }
    ]
  }
}