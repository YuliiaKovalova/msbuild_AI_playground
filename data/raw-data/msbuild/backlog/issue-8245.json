{
  "number": 8245,
  "title": "When using msbuild slnf files in a path with an '@' in it, an exception is thrown",
  "body": "### Issue Description\r\n\r\nmsbuild throws System.IO.DirectoryNotFoundException when used in path which contains an '@' and a slnf is used.\r\n\r\n### Steps to Reproduce\r\n1) Expand [proj@.zip](https://github.com/dotnet/msbuild/files/10235459/proj%40.zip)\r\n2) Start terminal in proj@ folder\r\n2) Run \"msbuild test.slnf\"\r\n\r\n### Expected Behavior\r\nmsbuild should behave the same way as in a folder without an '@' in it. In case of the example project it should complain about the sln file being invalid.\r\n\r\n### Actual Behavior\r\nOutput: \r\n\r\n```\r\nMSBuild version 17.3.1+2badb37d1 for .NET Framework\r\nDie Projekte in dieser Projektmappe werden nacheinander erstellt. Um eine parallele Erstellung zu erm\u00f6glichen, m\u00fcssen Sie den Schalter \"-m\" hinzuf\u00fcgen.\r\nDer Buildvorgang wurde am 15.12.2022 10:03:58 gestartet.\r\n...\\proj@\\test.slnf : error MSB4014: Der Buildvorgang wurde aufgrund eines internen Fehlers unerwartet beendet.\r\n...\\proj@\\test.slnf : error MSB4014: System.IO.DirectoryNotFoundException: Ein Teil des Pfades \"...\\proj%40\\test.sln\" konnte nicht gefunden werden.\r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)        \r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, I \r\nnt32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bF \r\nromProxy, Boolean useLongPath, Boolean checkHost)\r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access,  \r\nFileShare share)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Construction.SolutionFile.GetSolutionFileAndVisualStudioMa \r\njorVersions(String solutionFile, Int32& solutionVersion, Int32& visualStudioMajorVersion)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.ProjectInstance.LoadSolutionForBuild(String proj \r\nectFile, PropertyDictionary`1 globalPropertiesInstances, String toolsVersion, BuildParameters buildParameters, ILoggingService loggingService, B \r\nuildEventContext projectBuildEventContext, Boolean isExplicitlyLoaded, IReadOnlyCollection`1 targetNames, ISdkResolverService sdkResolverService \r\n, Int32 submissionId)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.LoadSolutionIntoConfiguration(Build \r\nRequestConfiguration config, BuildRequest request)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.HandleNewRequest(Int32 node, BuildR \r\nequestBlocker blocker)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.<>c__DisplayClass100_0.<IssueBuildR \r\nequestForBuildSubmission>g__IssueBuildSubmissionToSchedulerImpl|1(BuildSubmission submission, Boolean allowMainThreadBuild)\r\n\r\nFehler beim Buildvorgang.\r\n\r\n...\\proj@\\test.slnf : error MSB4014: Der Buildvorgang wurde aufgrund eines internen Fehlers unerwartet beendet.      \r\n...\\proj@\\test.slnf : error MSB4014: System.IO.DirectoryNotFoundException: Ein Teil des Pfades \"C:\\Users\\Michael\\Deskt \r\nop\\temp\\proj%40\\test.sln\" konnte nicht gefunden werden.\r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)        \r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, I \r\nnt32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bF \r\nromProxy, Boolean useLongPath, Boolean checkHost)\r\n...\\proj@\\test.slnf : error MSB4014:    bei System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access,  \r\nFileShare share)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Construction.SolutionFile.GetSolutionFileAndVisualStudioMa \r\njorVersions(String solutionFile, Int32& solutionVersion, Int32& visualStudioMajorVersion)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.ProjectInstance.LoadSolutionForBuild(String proj \r\nectFile, PropertyDictionary`1 globalPropertiesInstances, String toolsVersion, BuildParameters buildParameters, ILoggingService loggingService, B \r\nuildEventContext projectBuildEventContext, Boolean isExplicitlyLoaded, IReadOnlyCollection`1 targetNames, ISdkResolverService sdkResolverService \r\n, Int32 submissionId)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.LoadSolutionIntoConfiguration(Build \r\nRequestConfiguration config, BuildRequest request)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.HandleNewRequest(Int32 node, BuildR \r\nequestBlocker blocker)\r\n...\\proj@\\test.slnf : error MSB4014:    bei Microsoft.Build.Execution.BuildManager.<>c__DisplayClass100_0.<IssueBuildR \r\nequestForBuildSubmission>g__IssueBuildSubmissionToSchedulerImpl|1(BuildSubmission submission, Boolean allowMainThreadBuild)\r\n\r\n   bei Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsNotAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache, String commandLine)   bei Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)\r\nUnbehandelte Ausnahme: System.IO.DirectoryNotFoundException: Ein Teil des Pfades \"...\\proj%40\\test.sln\" konnte nicht gefunden werden.\r\n   bei Microsoft.Build.CommandLine.MSBuildApp.BuildProject(String projectFile, String[] targets, String toolsVersion, Dictionary`2 globalProperties, Dictionary`2 restoreProperties, ILogger[] loggers, LoggerVerbosity verbosity, DistributedLoggerRecord[] distributedLoggerRecords, Boolean needToValidateProject, String schemaFile, Int32 cpuCount, Boolean enableNodeReuse, TextWriter preprocessWriter, TextWriter targetsWriter, Boolean detailedSummary, ISet`1 warningsAsErrors, ISet`1 warningsNotAsErrors, ISet`1 warningsAsMessages, Boolean enableRestore, ProfilerLogger profilerLogger, Boolean enableProfiler, Boolean interactive, Boolean isolateProjects, GraphBuildOptions graphBuildOptions, Boolean lowPriority, String[] inputResultsCaches, String outputResultsCache, String commandLine)   bei Microsoft.Build.CommandLine.MSBuildApp.Execute(String commandLine)   bei Microsoft.Build.CommandLine.MSBuildApp.Main()\r\n```\r\n\r\n### Analysis\r\n\r\nThe path in the error message (\"proj%40\\test.sln\") is url encoded. Probably there's some encoding happening in when resolving the path in the slnf.\r\n\r\n\r\n### Versions & Configurations\r\n\r\nMSBuild version 17.3.1+2badb37d1 for .NET Framework\r\n17.3.1.41501\r\n",
  "state": "OPEN",
  "createdAt": "2022-12-15T09:16:47Z",
  "updatedAt": "2024-09-24T14:15:03Z",
  "closedAt": null,
  "author": {
    "login": "mistoll"
  },
  "labels": [
    "bug",
    "Area: Solution (.sln)",
    "triaged",
    "gathering-feedback"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": []
  }
}