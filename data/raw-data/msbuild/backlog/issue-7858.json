{
  "number": 7858,
  "title": "Unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE",
  "body": "Increasing number of builds failing on Azure DevOps agents with this message. Any help that can be provided would be great.\r\n\r\n```\r\n##[error]This is an unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE AT https://aka.ms/msbuild/unhandled.\r\n    System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.\r\n   at System.Reflection.AssemblyName.nGetFileInformation(String s)\r\n   at System.Reflection.AssemblyName.GetAssemblyName(String assemblyFile)\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ProcessBucket>d__51.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetEntry.<ExecuteTarget>d__44.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<ProcessTargetStack>d__23.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.TargetBuilder.<BuildTargets>d__10.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ValidateEnd(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\nMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext() [D:\\a\\1\\s\\Source\\AOS.ServiceImplementation.Payroll.FrontEnd\\AOS.ServiceImplementation.Payroll.FrontEnd.csproj]\r\n```",
  "state": "CLOSED",
  "createdAt": "2022-08-02T00:27:40Z",
  "updatedAt": "2022-08-04T16:09:13Z",
  "closedAt": "2022-08-04T16:09:13Z",
  "author": {
    "login": "ssa3512"
  },
  "labels": [
    "needs-more-info",
    "needs-triage",
    "author-responded",
    "needs-attention"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Unfortunately an `OutOfMemoryException` can be tricky to chase down, since the codepath where it is thrown is not necessarily where most of the memory is allocated.\r\n\r\nCan we start by describing your build more?\r\n\r\n* What is your codebase like?\r\n* What version of MSBuild/Visual Studio/dotnet are you using to build?\r\n* Can you observe passing builds? How much memory are they using?",
        "createdAt": "2022-08-02T14:27:10Z",
        "updatedAt": "2022-08-02T14:27:10Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "> Can we start by describing your build more?\r\n\r\nCodebase is a relatively large solution, 132 projects at the moment. The majority are new style (`<Project Sdk=\"Microsoft.NET.Sdk\">)` style targeting `netstandard2.0` or dual targeting `netstandard2.0` and `netstandard2.1`\r\n38 of the projects are MSTest unit tests targeting net472 and/or net6.0\r\n\r\nThere are seven old style projects targeting .NET Framework including the one referenced in the error message. These are the very top level application projects.\r\n\r\nThere are also four top level application projects for Azure Functions, targeting net6.0.\r\n\r\nWe are using the Azure DevOps `windows-latest` image, which is VS 2022. We are passing the following flags to the build task which is Azure DevOps task `VSBuild@1`:\r\n`/m /p:PackageLocation=$(build.binariesdirectory) /p:GeneratePackageOnBuild=true`\r\n\r\nI don't believe Azure DevOps has any way for us to observe the build memory usage.",
        "createdAt": "2022-08-02T14:46:23Z",
        "updatedAt": "2022-08-02T14:46:23Z",
        "author": {
          "login": "ssa3512"
        }
      },
      {
        "body": "@ssa3512 can you try switching to the 64-bit MSBuild via `VSBuild`'s `msbuildArchitecture: 'x64'` argument? That's usually the cheapest/easiest way out of OOM problems.\r\n\r\nThat solution size by itself shouldn't be a big problem; we regularly build repos with thousands of projects.",
        "createdAt": "2022-08-02T14:50:05Z",
        "updatedAt": "2022-08-02T14:50:05Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "@rainersigwald Thanks, I wasn't aware of that argument. I am updating our pipeline now and will report back if that helps out.",
        "createdAt": "2022-08-02T15:03:51Z",
        "updatedAt": "2022-08-02T15:03:51Z",
        "author": {
          "login": "ssa3512"
        }
      },
      {
        "body": "We haven't had any failures since I added the x64 parameter so I think that solved the issue. Thanks so much.",
        "createdAt": "2022-08-04T01:56:10Z",
        "updatedAt": "2022-08-04T01:56:10Z",
        "author": {
          "login": "ssa3512"
        }
      },
      {
        "body": "Awesome! Please let us know if it doesn't hold out.",
        "createdAt": "2022-08-04T16:09:12Z",
        "updatedAt": "2022-08-04T16:09:12Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}