{
  "number": 1029,
  "title": "Cannot step into async method in assembly built in Release mode",
  "body": "Apologies if this is the wrong place to file the issue.\n\n**Steps to reproduce:**\n\nCreate a solution with a class library and a console application.\n\nClass library:\n\n```\nusing System.Threading.Tasks;\n\npublic static class Foo\n{\n    public static async Task<int> GetAsync()\n    {\n        return await Task.FromResult(0);\n    }\n}\n```\n\nConsole application:\n\n```\nusing System.Threading.Tasks;\n\nclass Program\n{\n    static void Main()\n    {\n        RunAsync().GetAwaiter().GetResult();\n    }\n\n    static async Task RunAsync()\n    {\n        var x = await Foo.GetAsync();\n    }\n}\n```\n\nBuild the class library in Release mode, and the console application in Debug mode.\n\nSet a breakpoint on the line\n\n```\nvar x = await Foo.GetAsync();\n```\n\nand debug the console application. When the breakpoint is hit, press F11 to step into `GetAsync`.\n\n**Expected behaviour:**\n\nThe debugger steps into `GetAsync`.\n\n**Actual behaviour:**\n\nThe debugger steps over `GetAsync`.\n\n**System information**\n\nMicrosoft Visual Studio Enterprise 2015\nVersion 14.0.25431.01 Update 3\n\nMicrosoft .NET Framework\nVersion 4.6.01586\n\n**MSBuild 14 vs MSBuild 12**\n\nStepping into `GetAsync`works as expected when the solution is built using MSBuild 12.\n\n```\n\"C:\\Program Files (x86)\\MSBuild\\12.0\\bin\\MSBuild.exe\" /t:Clean;Build Repro.sln\n```\n\nHere is the output from [cvdump](https://github.com/Microsoft/microsoft-pdb/tree/master/cvdump) for the class library PDBs built with MSBuild 12 and MSBuild 14.\n\n**`cvdump.exe ClassLibrary.pdb` (MSBuild 12)**\n\n```\nMicrosoft (R) Debugging Information Dumper  Version 14.00.23611\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\n*** IDs\n\n\n*** MODULES\n\n0001 \"2467122D\" \"Foo.<GetAsync>d__0\"\n0002 \"5821794C\" \"Foo\"\n\n*** PUBLICS\n\n\n\n*** TYPES\n\n\n*** TYPES Mismatch Warnings\n\n\n*** SYMBOLS\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n(000004) S_GMANPROC: [0001:00000000], Cb: 000000A1, Token: 06000002, MoveNext\n         Parent: 00000000, End: 000001B8, Next: 00000000\n         Debug start: 00000000, Debug end: 00000000\n         Return Reg: ???(0x0000)\n\n(000038)  S_BLOCK32: [0001:00000000], Cb: 000000A1, \n          Parent: 00000004, End: 00000134\n\n(000050)   S_UNAMESPACE: USystem.Threading.Tasks\n(00006C)   S_MANSLOT: 3, Local: 11000001, Compiler Generated, CS$0$0000\n(00008C)   S_MANSLOT: 4, Local: 11000001, Compiler Generated, CS$0$0001\n(0000AC)   S_MANSLOT: 5, Local: 11000001, Compiler Generated, CS$0$0002\n(0000CC)   S_MANSLOT: 0, Local: 11000001, <>t__doFinallyBodies\n(0000F8)   S_MANSLOT: 1, Local: 11000001, <>t__result\n(000118)   S_MANSLOT: 2, Local: 11000001, <>t__ex\n\n(000134)  S_END\n\n(000138)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n(000168)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n\n(0001B8) S_END\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n(000004) S_GMANPROC: [0001:000000A1], Cb: 00000032, Token: 06000001, GetAsync\n         Parent: 00000000, End: 00000084, Next: 00000000\n         Debug start: 00000000, Debug end: 00000000\n         Return Reg: ???(0x0000)\n\n(000038)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n\n(000084) S_END\n\n\n*** GLOBALS\n\n\nS_TOKENREF: 0x00000000: (   1, 00000004) 06000002\nS_TOKENREF: 0x00000000: (   2, 00000004) 06000001\nS_PROCREF: 0x00000000: (   2, 00000004) GetAsync\nS_PROCREF: 0x00000000: (   1, 00000004) MoveNext\n\n\n*** COFF SYMBOL RVA\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** INLINEE LINES\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** LINES\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n  c:\\Repos\\Repro\\ClassLibrary\\Foo.cs (None), 0001:00000000-000000A1, line/addr pairs = 5\n\n  feefee:0                00000000      7:9    -    7:41    0000000D\n  feefee:0                00000073      8:5    -    8:6     0000008C\n  feefee:0                00000094\n\n** Module: \"Foo\" from \"5821794C\"\n\nMod::GetEnumLines failed\n\n\n*** IL LINES\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\nMod::GetEnumILLines failed\n\n\n*** SOURCE FILES\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n     0 c:\\Repos\\Repro\\ClassLibrary\\Foo.cs (None)\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** SECTION CONTRIBUTIONS\n\n  Imod  Address        Size      Characteristics\n  0001  0001:00000000  000000A1  00000000\n  0002  0001:000000A1  00000032  00000000\n\n*** SEGMENT MAP\n\nSec  flags  ovl   grp   frm sname cname    offset    cbSeg\n 01  010d  0000  0000  0001  ffff  ffff  00000000 000000d3\n 02  0208  0000  0000  0000  ffff  ffff  00000000 ffffffff\n\n*** FPO\n\nDBIOpenDbg(, dbgtypeFPO,) failed.\nDBIOpenDbg(, dbgtypeNewFPO,) failed.\n\n*** TokenMap\n\nDBIOpenDbg(, dbgtypeTokenRidMap,) failed.\n\n*** FIXUPS\n\nDBIOpenDbg(, dbgtypeFixup,) failed.\n\n*** OMAP FROM SRC\n\nDBIOpenDbg(, dbgtypeOmapFromSrc,) failed.\n\n*** OMAP TO SRC\n\nDBIOpenDbg(, dbgtypeOmapToSrc,) failed.\n\n*** PDATA/XDATA\n\nDBIOpenDbg(, dbgtypePdata,) failed.\n\n*** SECTION HEADERS\n\n\nSECTION HEADER #1\n         name\n      D3 virtual size\n       0 virtual address\n      D3 size of raw data\n       0 file pointer to raw data\n       0 file pointer to relocation table\n       0 file pointer to line numbers\n       0 number of relocations\n       0 number of line numbers\n       0 flags\n         (no align specified)\n\n*** ORIGINAL SECTION HEADERS\n\nDBIOpenDbg(, dbgtypeSectionHdrOrig,) failed.\n\n*** CROSS MODULE EXPORTS\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** CROSS MODULE IMPORTS\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** FUNCTION TOKEN MAP\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** TYPE TOKEN MAP\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** MERGED ASSEMBLY INPUT\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n*** STRINGTABLE\n\n00000001 c:\\Repos\\Repro\\ClassLibrary\\Foo.cs\n00000024 \n00000025 c:\\repos\\repro\\classlibrary\\foo.cs\n```\n\n**`cvdump.exe ClassLibrary.pdb` (MSBuild 14)**\n\n```\nMicrosoft (R) Debugging Information Dumper  Version 14.00.23611\nCopyright (C) Microsoft Corporation.  All rights reserved.\n\n\n*** IDs\n\n\n*** MODULES\n\n0001 \"5821794C\" \"Foo\"\n0002 \"2467122D\" \"Foo.<GetAsync>d__0\"\n\n*** PUBLICS\n\n\n\n*** TYPES\n\n\n*** TYPES Mismatch Warnings\n\n\n*** SYMBOLS\n\n** Module: \"Foo\" from \"5821794C\"\n\n\n(000004) S_GMANPROC: [0001:00000000], Cb: 00000031, Token: 06000001, GetAsync\n         Parent: 00000000, End: 00000084, Next: 00000000\n         Debug start: 00000000, Debug end: 00000000\n         Return Reg: ???(0x0000)\n\n(000038)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n\n(000084) S_END\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n(000004) S_GMANPROC: [0001:00000031], Cb: 00000099, Token: 06000002, MoveNext\n         Parent: 00000000, End: 000000F0, Next: 00000000\n         Debug start: 00000000, Debug end: 00000000\n         Return Reg: ???(0x0000)\n\n(000038)  S_BLOCK32: [0001:00000031], Cb: 00000099, \n          Parent: 00000004, End: 0000006C\n\n(000050)   S_UNAMESPACE: USystem.Threading.Tasks\n\n(00006C)  S_END\n\n(000070)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n(0000A0)  S_OEM: {C6EA3FC9-59B3-49D6-BC25-0902BBABB460}, Type:     T_NOTYPE(0000)\n\n(0000F0) S_END\n\n\n*** GLOBALS\n\n\nS_TOKENREF: 0x00000000: (   2, 00000004) 06000002\nS_TOKENREF: 0x00000000: (   1, 00000004) 06000001\nS_PROCREF: 0x00000000: (   1, 00000004) GetAsync\nS_PROCREF: 0x00000000: (   2, 00000004) MoveNext\n\n\n*** COFF SYMBOL RVA\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** INLINEE LINES\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** LINES\n\n** Module: \"Foo\" from \"5821794C\"\n\nMod::GetEnumLines failed\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n  C:\\Repos\\Repro\\ClassLibrary\\Foo.cs (None), 0001:00000031-000000CA, line/addr pairs = 7\n\n  feefee:0                00000031  feefee:0                00000038\n      7:9    -    7:41    0000003B  feefee:0                00000047\n  feefee:0                0000009E      8:5    -    8:6     000000B5\n  feefee:0                000000BD\n\n\n*** IL LINES\n\n** Module: \"Foo\" from \"5821794C\"\n\nMod::GetEnumILLines failed\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** SOURCE FILES\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n     0 C:\\Repos\\Repro\\ClassLibrary\\Foo.cs (None)\n\n\n*** SECTION CONTRIBUTIONS\n\n  Imod  Address        Size      Characteristics\n  0001  0001:00000000  00000031  00000000\n  0002  0001:00000031  00000099  00000000\n\n*** SEGMENT MAP\n\nSec  flags  ovl   grp   frm sname cname    offset    cbSeg\n 01  010d  0000  0000  0001  ffff  ffff  00000000 000000ca\n 02  0208  0000  0000  0000  ffff  ffff  00000000 ffffffff\n\n*** FPO\n\nDBIOpenDbg(, dbgtypeFPO,) failed.\nDBIOpenDbg(, dbgtypeNewFPO,) failed.\n\n*** TokenMap\n\nDBIOpenDbg(, dbgtypeTokenRidMap,) failed.\n\n*** FIXUPS\n\nDBIOpenDbg(, dbgtypeFixup,) failed.\n\n*** OMAP FROM SRC\n\nDBIOpenDbg(, dbgtypeOmapFromSrc,) failed.\n\n*** OMAP TO SRC\n\nDBIOpenDbg(, dbgtypeOmapToSrc,) failed.\n\n*** PDATA/XDATA\n\nDBIOpenDbg(, dbgtypePdata,) failed.\n\n*** SECTION HEADERS\n\n\nSECTION HEADER #1\n         name\n      CA virtual size\n       0 virtual address\n      CA size of raw data\n       0 file pointer to raw data\n       0 file pointer to relocation table\n       0 file pointer to line numbers\n       0 number of relocations\n       0 number of line numbers\n       0 flags\n         (no align specified)\n\n*** ORIGINAL SECTION HEADERS\n\nDBIOpenDbg(, dbgtypeSectionHdrOrig,) failed.\n\n*** CROSS MODULE EXPORTS\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** CROSS MODULE IMPORTS\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** FUNCTION TOKEN MAP\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** TYPE TOKEN MAP\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** MERGED ASSEMBLY INPUT\n\n** Module: \"Foo\" from \"5821794C\"\n\n** Module: \"Foo.<GetAsync>d__0\" from \"2467122D\"\n\n\n*** STRINGTABLE\n\n00000001 C:\\Repos\\Repro\\ClassLibrary\\Foo.cs\n00000024 \n00000025 c:\\repos\\repro\\classlibrary\\foo.cs\n```\n\nSource and cvdump output available at https://github.com/mjolka/Repro\n",
  "state": "CLOSED",
  "createdAt": "2016-09-15T00:58:08Z",
  "updatedAt": "2024-02-21T17:25:57Z",
  "closedAt": "2016-09-15T15:32:42Z",
  "author": {
    "login": "mjolka"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This is probably the wrong place to report this. Given that you're seeing a difference between MSBuild 12 and 14, I suspect the relevant change is actually to the C# compiler. Bugs can be filed on the new compiler at https://github.com/dotnet/roslyn/issues.\n\nThey would probably appreciate it if you extract the `csc.exe` command lines from the MSBuild log and remove MSBuild from the equation entirely. If the problem turns out to be in the construction of the call to the compiler done by the MSBuild project, the Roslyn folks are still the best place to start.\n",
        "createdAt": "2016-09-15T15:32:42Z",
        "updatedAt": "2016-09-15T15:32:42Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}