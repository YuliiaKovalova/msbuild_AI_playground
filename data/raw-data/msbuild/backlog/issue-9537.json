{
  "number": 9537,
  "title": "[Unhandled Exception]:  building wixproj 4.0.3 via Bamboo version 9.2.3 build 90202 - 22 Jun 23",
  "body": "### Issue Description\r\n\r\nattached the wix project being built\r\n[ServerSetupwixproj.txt](https://github.com/dotnet/msbuild/files/13666890/ServerSetupwixproj.txt)\r\n\r\n--BELOW is the error log---\r\n\r\n```\r\nbuild\t14-Dec-2023 10:57:13\t\"C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj\" (_IsProjectRestoreSupported target) (14) ->\r\nbuild\t14-Dec-2023 10:57:13\t  MSBUILD : error : This is an unhandled exception in MSBuild -- PLEASE UPVOTE AN EXISTING ISSUE OR FILE A NEW ONE AT https://aka.ms/msbuild/unhandled [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :     Microsoft.Build.Framework.InternalErrorException: MSB0001: Internal MSBuild Error: Need warning message. [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.Logging.LoggingService.LogWarningFromText(BuildEventContext buildEventContext, String subcategoryResourceName, String warningCode, String helpKeyword, BuildEventFileInfo file, String message) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.LogWarnings(LoggingContext loggingContext, ElementLocation location, IEnumerable`1 warnings) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.TryResolveSdkUsingSpecifiedResolvers(IList`1 resolvers, Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, SdkResult& sdkResult, IEnumerable`1& errors, IEnumerable`1& warnings) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdkUsingResolversWithPatternsFirst(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.SdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.<>c__DisplayClass3_0.<ResolveSdk>b__2() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at System.Lazy`1.CreateValue() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at System.Lazy`1.LazyInitValue() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at System.Lazy`1.get_Value() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.CachingSdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.SdkResolution.MainNodeSdkResolverService.ResolveSdk(Int32 submissionId, SdkReference sdk, LoggingContext loggingContext, ElementLocation sdkReferenceLocation, String solutionPath, String projectPath, Boolean interactive, Boolean isRunningInVisualStudio, Boolean failOnUnresolvedSdk) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImportsFromUnescapedImportExpressionConditioned(String directoryOfImportingFile, ProjectImportElement importElement, List`1& projects, SdkResult& sdkResult) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.ExpandAndLoadImports(String directoryOfImportingFile, ProjectImportElement importElement, SdkResult& sdkResult) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.EvaluateImportElement(String directoryOfImportingFile, ProjectImportElement importElement) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.PerformDepthFirstPass(ProjectRootElement currentProjectOrImport) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.Evaluate() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Evaluation.Evaluator`4.Evaluate(IEvaluatorData`4 data, Project project, ProjectRootElement root, ProjectLoadSettings loadSettings, Int32 maxNodeCount, PropertyDictionary`1 environmentProperties, ILoggingService loggingService, IItemFactory`2 itemFactory, IToolsetProvider toolsetProvider, IDirectoryCacheFactory directoryCacheFactory, ProjectRootElementCacheBase projectRootElementCache, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, EvaluationContext evaluationContext, Boolean interactive) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.Execution.ProjectInstance.Initialize(ProjectRootElement xml, IDictionary`2 globalProperties, String explicitToolsVersion, String explicitSubToolsetVersion, Int32 visualStudioVersionFromSolution, BuildParameters buildParameters, ILoggingService loggingService, BuildEventContext buildEventContext, ISdkResolverService sdkResolverService, Int32 submissionId, Nullable`1 projectLoadSettings, EvaluationContext evaluationContext, IDirectoryCacheFactory directoryCacheFactory) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.BuildRequestConfiguration.<>c__DisplayClass61_0.<LoadProjectIntoConfiguration>b__0() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.BuildRequestConfiguration.InitializeProject(BuildParameters buildParameters, Func`1 loadProjectFromFile) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.BuildRequestConfiguration.LoadProjectIntoConfiguration(IBuildComponentHost componentHost, BuildRequestDataFlags buildRequestDataFlags, Int32 submissionId, Int32 nodeId) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildProject>d__68.MoveNext() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error : --- End of stack trace from previous location where exception was thrown --- [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task) [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\nbuild\t14-Dec-2023 10:57:13\tMSBUILD : error :    at Microsoft.Build.BackEnd.RequestBuilder.<BuildAndReport>d__59.MoveNext() [C:\\BAMBOO_HOME23\\xml-data\\build-dir\\EX-EXIGO0-JOB1\\EXIGO\\Server\\Install\\ServerSetup.wixproj]\r\n```\r\n\r\n### Steps to Reproduce\r\n\r\nrunning  `msbuild /t:Restore,Clean,Version,Build,Pack /p:Configuration=\"Release\"`\r\n\r\nvia bamboo\r\n\r\n### Actual Behavior\r\n\r\nBamboo build fails and spits out this error to be logged \r\n\r\n### Analysis\r\n\r\n_No response_\r\n\r\n### Versions & Configurations\r\n\r\n_No response_",
  "state": "CLOSED",
  "createdAt": "2023-12-14T00:14:35Z",
  "updatedAt": "2024-06-19T12:22:13Z",
  "closedAt": "2024-06-19T12:22:11Z",
  "author": {
    "login": "austraclear"
  },
  "labels": [
    "bug",
    "needs-more-info",
    "stale",
    "closed-by-bot",
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "> running msbuild /t:Restore,Clean,Version,Build,Pack /p:Configuration=\"Release\"\n\nI don't know whether this is related to the error, but you should not use the Restore target together with other targets.  Instead use the /restore option or a wholly separate MSBuild invocation.\n\nmsbuild /restore:true /t:Clean,Version,Build,Pack /p:Configuration=\"Release\"\n",
        "createdAt": "2023-12-14T14:23:38Z",
        "updatedAt": "2023-12-14T14:23:38Z",
        "author": {
          "login": "KalleOlaviNiemitalo"
        }
      },
      {
        "body": "The stack trace looks like an SDK resolver returned an SdkResult that contains an empty string as a warning.  However, I don't see which SDK resolver did that.\r\n\r\nBecause your command runs `msbuild` rather than `dotnet msbuild`, I presume it is part of a Visual Studio installation and the SDK resolvers were installed with Visual Studio.  Which version of Visual Studio are you using with Bamboo?",
        "createdAt": "2023-12-14T18:35:27Z",
        "updatedAt": "2023-12-14T18:35:27Z",
        "author": {
          "login": "KalleOlaviNiemitalo"
        }
      },
      {
        "body": "The information in this email is confidential, it may also be privileged and is intended for the exclusive use of the addressee(s). If you have received this email in error, please do not distribute it, notify me and destroy the original message and all copies.  The unauthorised use of this email may result in liability for breach of confidentiality, privilege or copyright.  E-mail transmissions cannot be guaranteed to be secure or error-free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete or contain viruses. The sender does not accept liability for errors or omissions in the contents of this message which arise as a result of e-mail transmission.\r\n",
        "createdAt": "2023-12-15T06:03:43Z",
        "updatedAt": "2024-05-02T07:18:01Z",
        "author": {
          "login": "austraclear"
        }
      },
      {
        "body": "We have investigated the issue, and it appears that it is not a bug on our end. Most likely, Bamboo has a custom SDK resolver that incorrectly returns a null message. Unfortunately, we are unable to reproduce the issue locally. If you require further assistance with this matter, please provide the binlog. You can find more information about binlogs at [aka.ms/binlog](aka.ms/binlog).",
        "createdAt": "2024-05-02T07:17:21Z",
        "updatedAt": "2024-05-02T07:17:21Z",
        "author": {
          "login": "rokonec"
        }
      },
      {
        "body": "This issue is marked as stale because feedback has been requested for 30 days with no response. Please respond within 14 days or this issue will be closed due to inactivity.\n<!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. -->",
        "createdAt": "2024-06-02T17:42:59Z",
        "updatedAt": "2024-06-02T17:42:59Z",
        "author": {
          "login": "dotnet-policy-service[bot]"
        }
      },
      {
        "body": "This issue was closed due to inactivity. If you can still reproduce this bug, please comment with the requested information, detailed steps to reproduce the problem, or any other notes that might help in the investigation.\n<!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. -->",
        "createdAt": "2024-06-19T12:22:12Z",
        "updatedAt": "2024-06-19T12:22:12Z",
        "author": {
          "login": "dotnet-policy-service[bot]"
        }
      }
    ]
  }
}