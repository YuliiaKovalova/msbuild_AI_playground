{
  "number": 8628,
  "title": "[Bug]: NuGet.targets(1 32,5): error : Ambiguous project name",
  "body": "### Issue Description\n\nHi.\r\n\r\nWhen trying to run the \"Restore\" target on my Visual Studio solution, the following error occurs:\r\n\r\n```\r\nC:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\Common7\\IDE\\CommonExtensions\\Microsoft\\NuGet\\NuGet.targets(1\r\n32,5): error : Ambiguous project name ...\r\n```\r\n\r\nIt happens in Visual Studio 2022 and also when using `msbuild` on the command line.\n\n### Steps to Reproduce\n\n1. Download and unzip \r\n[AmbiguousProjectName.zip](https://github.com/dotnet/msbuild/files/11144097/AmbiguousProjectName.zip)\r\n2. Open a Visual Studio 2022 developer command prompt\r\n3. 'CD' into the folder where the folder was created from the zip\r\n4. Run `msbuild /t:Restore`\r\n\r\nAlternatively, open the sln in Visual Studio 2022 17.5.3, right click on the root `Solution` node in `Solution Explorer` and select `Restore NuGet Packages`.\n\n### Expected Behavior\n\nI expected the command to succeed.\n\n### Actual Behavior\n\nWhen using the msbuild command line:\r\n```\r\nMSBuild version 17.5.1+f6fdcf537 for .NET Framework\r\nBuilding the projects in this solution one at a time. To enable parallel build, please add the \"-m\" switch.\r\nBuild started 4/3/2023 7:36:00 PM.\r\nIncluded response file: C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\MSBuild\\Current\\Bin\\amd64\\MSBuild.rsp\r\n\r\nProject \"C:\\github\\icnocop\\AmbiguousProjectName\\AmbiguousProjectName.sln\" on node 1 (Restore target(s)).\r\nValidateSolutionConfiguration:\r\n  Building solution configuration \"Debug|Any CPU\".\r\n_GetAllRestoreProjectPathItems:\r\n  Determining projects to restore...\r\nRestore:\r\n  X.509 certificate chain validation will use the default trust store selected by .NET.\r\n  X.509 certificate chain validation will use the default trust store selected by .NET.\r\n  Restoring packages for C:\\github\\icnocop\\AmbiguousProjectName\\src\\Common.NuGet\\Common.NuGet.csproj...\r\nC:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\Common7\\IDE\\CommonExtensions\\Microsoft\\NuGet\\NuGet.targets(132\r\n,5): error : Ambiguous project name 'Common'. [C:\\github\\icnocop\\AmbiguousProjectName\\AmbiguousProjectName.sln]\r\nDone Building Project \"C:\\github\\icnocop\\AmbiguousProjectName\\AmbiguousProjectName.sln\" (Restore target(s)) -- FAILED.\r\n\r\n\r\nBuild FAILED.\r\n\r\n\"C:\\github\\icnocop\\AmbiguousProjectName\\AmbiguousProjectName.sln\" (Restore target) (1) ->\r\n(Restore target) ->\r\n  C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\Common7\\IDE\\CommonExtensions\\Microsoft\\NuGet\\NuGet.targets(1\r\n32,5): error : Ambiguous project name 'Common'. [C:\\github\\icnocop\\AmbiguousProjectName\\AmbiguousProjectName.sln]\r\n\r\n    0 Warning(s)\r\n    1 Error(s)\r\n\r\nTime Elapsed 00:00:01.03\r\n```\r\n\r\nWhen using Visual Studio 2022 IDE:\r\n```\r\nRestoring NuGet packages...\r\nRunning restore with 12 concurrent jobs.\r\nReading project file C:\\github\\icnocop\\AmbiguousProjectName\\src\\Common.NuGet\\Common.NuGet.csproj.\r\nThe restore inputs for 'Common' have changed. Continuing restore.\r\nRestoring packages for C:\\github\\icnocop\\AmbiguousProjectName\\src\\Common.NuGet\\Common.NuGet.csproj...\r\nNuGet package restore failed. Please see Error List window for detailed warnings and errors.\r\nTime Elapsed: 00:00:00.1047742\r\n========== Finished ==========\r\n\r\n\r\nError occurred while restoring NuGet packages: System.InvalidOperationException: Ambiguous project name 'Common'.\r\n   at NuGet.Commands.RestoreCommand.GetProjectReferences()\r\n   at NuGet.Commands.RestoreCommand.<ExecuteRestoreAsync>d__62.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.Commands.RestoreCommand.<ExecuteAsync>d__45.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.Commands.RestoreRunner.<ExecuteAsync>d__7.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.Commands.RestoreRunner.<ExecuteAndCommitAsync>d__6.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.Commands.RestoreRunner.<CompleteTaskAsync>d__9.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at NuGet.Commands.RestoreRunner.<RunAsync>d__2.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.Commands.RestoreRunner.<RunAsync>d__0.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.PackageManagement.DependencyGraphRestoreUtility.<RestoreAsync>d__2.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.SolutionRestoreManager.SolutionRestoreJob.<>c__DisplayClass25_0.<<RestorePackageSpecProjectsAsync>b__2>d.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.SolutionRestoreManager.RestoreOperationLogger.<RunWithProgressAsync>d__34.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at NuGet.SolutionRestoreManager.RestoreOperationLogger.<RunWithProgressAsync>d__34.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.SolutionRestoreManager.SolutionRestoreJob.<RestorePackageSpecProjectsAsync>d__25.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.SolutionRestoreManager.SolutionRestoreJob.<RestoreAsync>d__23.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at NuGet.SolutionRestoreManager.SolutionRestoreJob.<RestoreAsync>d__23.MoveNext()\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()\r\n   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)\r\n   at NuGet.SolutionRestoreManager.SolutionRestoreJob.<ExecuteAsync>d__22.MoveNext()\r\n```\n\n### Analysis\n\n_No response_\n\n### Versions & Configurations\n\nMSBuild version 17.5.1+f6fdcf537 for .NET Framework\r\n17.5.1.16304\r\n\r\nWindows 10 Enterprise x64\r\nVersion 22H2 (OS Build 19045.2728)\r\n\r\nVisual Studio 2022 Enterprise\r\nVersion 17.5.3",
  "state": "CLOSED",
  "createdAt": "2023-04-04T02:49:52Z",
  "updatedAt": "2023-04-04T13:51:38Z",
  "closedAt": "2023-04-04T13:51:38Z",
  "author": {
    "login": "icnocop"
  },
  "labels": [
    "bug",
    "needs-triage"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This issue was moved to NuGet/Home#12525",
        "createdAt": "2023-04-04T13:51:37Z",
        "updatedAt": "2023-04-04T13:51:37Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  }
}