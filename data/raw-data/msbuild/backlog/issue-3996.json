{
  "number": 3996,
  "title": "PrivateAssets = All does not prevent the dependency from flowing to another project",
  "body": "### Steps to reproduce\r\n\r\nI have two projects:\r\n\r\nProject UITests:\r\n```xml\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n  <PropertyGroup>\r\n    <TargetFramework>net472</TargetFramework>\r\n  </PropertyGroup>\r\n  <ItemGroup>\r\n    <PackageReference Include=\"NUnit3TestAdapter\" Version=\"3.11.2\">\r\n      <PrivateAssets>All</PrivateAssets>\r\n    </PackageReference>\r\n  </ItemGroup>\r\n</Project>\r\n ```\r\n\r\nProject Rollup:\r\n```xml\r\n<Project Sdk=\"Microsoft.NET.Sdk\">\r\n  <PropertyGroup>\r\n    <TargetFramework>net472</TargetFramework>\r\n  </PropertyGroup>\r\n  <ItemGroup>\r\n    <ProjectReference Include=\"..\\UITests\\UITests.csproj\"/>\r\n  </ItemGroup>\r\n</Project>\r\n```\r\n\r\nThe only code file is Class1.cs in UITests:\r\n```csharp\r\nnamespace UITests\r\n{\r\n    class Class1\r\n    {\r\n    }\r\n}\r\n```\r\n\r\nThe solution file is:\r\n```\r\nMicrosoft Visual Studio Solution File, Format Version 12.00\r\n# Visual Studio 15\r\nVisualStudioVersion = 15.0.28307.136\r\nMinimumVisualStudioVersion = 10.0.40219.1\r\nProject(\"{9A19103F-16F7-4668-BE54-9A1E7A4F7556}\") = \"UITests\", \"UITests\\UITests.csproj\", \"{47EF8446-D7D9-4B15-A170-BABBB5E5A30F}\"\r\nEndProject\r\nProject(\"{9A19103F-16F7-4668-BE54-9A1E7A4F7556}\") = \"Rollup\", \"Rollup\\Rollup.csproj\", \"{9758E8DF-CB3E-46CE-B4E2-98B1D51651D6}\"\r\nEndProject\r\nGlobal\r\n\tGlobalSection(SolutionConfigurationPlatforms) = preSolution\r\n\t\tDebug|Any CPU = Debug|Any CPU\r\n\t\tRelease|Any CPU = Release|Any CPU\r\n\tEndGlobalSection\r\n\tGlobalSection(ProjectConfigurationPlatforms) = postSolution\r\n\t\t{47EF8446-D7D9-4B15-A170-BABBB5E5A30F}.Debug|Any CPU.ActiveCfg = Debug|Any CPU\r\n\t\t{47EF8446-D7D9-4B15-A170-BABBB5E5A30F}.Debug|Any CPU.Build.0 = Debug|Any CPU\r\n\t\t{47EF8446-D7D9-4B15-A170-BABBB5E5A30F}.Release|Any CPU.ActiveCfg = Release|Any CPU\r\n\t\t{47EF8446-D7D9-4B15-A170-BABBB5E5A30F}.Release|Any CPU.Build.0 = Release|Any CPU\r\n\t\t{9758E8DF-CB3E-46CE-B4E2-98B1D51651D6}.Debug|Any CPU.ActiveCfg = Debug|Any CPU\r\n\t\t{9758E8DF-CB3E-46CE-B4E2-98B1D51651D6}.Debug|Any CPU.Build.0 = Debug|Any CPU\r\n\t\t{9758E8DF-CB3E-46CE-B4E2-98B1D51651D6}.Release|Any CPU.ActiveCfg = Release|Any CPU\r\n\t\t{9758E8DF-CB3E-46CE-B4E2-98B1D51651D6}.Release|Any CPU.Build.0 = Release|Any CPU\r\n\tEndGlobalSection\r\n\tGlobalSection(SolutionProperties) = preSolution\r\n\t\tHideSolutionNode = FALSE\r\n\tEndGlobalSection\r\n\tGlobalSection(ExtensibilityGlobals) = postSolution\r\n\t\tSolutionGuid = {D10BCC6A-C354-4291-9DBF-C9863F7C62C0}\r\n\tEndGlobalSection\r\nEndGlobal\r\n```\r\n\r\nCommand line\r\n```\r\nC:\\work\\test [master \u21911 +3 ~1 -16 ~]> git clean -qdfx\r\nC:\\work\\test [master \u21911 +3 ~1 -16 ~]> Test-Path .\\Rollup\\bin\r\nFalse\r\nC:\\work\\test [master \u21911 +3 ~1 -16 ~]> msbuild /t:Restore\r\nMicrosoft (R) Build Engine version 15.9.20+g88f5fadfbe for .NET Framework\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nBuilding the projects in this solution one at a time. To enable parallel build, please add the \"/m\" switch.\r\nBuild started 12/7/2018 9:38:21 PM.\r\nProject \"C:\\work\\test\\Rollup.sln\" on node 1 (Restore target(s)).\r\nValidateSolutionConfiguration:\r\n  Building solution configuration \"Debug|Any CPU\".\r\nRestore:\r\n  Restoring packages for C:\\work\\test\\Rollup\\Rollup.csproj...\r\n  Restoring packages for C:\\work\\test\\UITests\\UITests.csproj...\r\n  Committing restore...\r\n  Committing restore...\r\n  Generating MSBuild file C:\\work\\test\\Rollup\\obj\\Rollup.csproj.nuget.g.props.\r\n  Generating MSBuild file C:\\work\\test\\UITests\\obj\\UITests.csproj.nuget.g.props.\r\n  Generating MSBuild file C:\\work\\test\\UITests\\obj\\UITests.csproj.nuget.g.targets.\r\n  Generating MSBuild file C:\\work\\test\\Rollup\\obj\\Rollup.csproj.nuget.g.targets.\r\n  Writing lock file to disk. Path: C:\\work\\test\\UITests\\obj\\project.assets.json\r\n  Writing lock file to disk. Path: C:\\work\\test\\Rollup\\obj\\project.assets.json\r\n  Restore completed in 214.98 ms for C:\\work\\test\\UITests\\UITests.csproj.\r\n  Restore completed in 212.7 ms for C:\\work\\test\\Rollup\\Rollup.csproj.\r\n\r\n  NuGet Config files used:\r\n      C:\\Users\\mkharitonov\\AppData\\Roaming\\NuGet\\NuGet.Config\r\n      C:\\Program Files (x86)\\NuGet\\Config\\Microsoft.VisualStudio.Offline.config\r\n\r\n  Feeds used:\r\n      https://api.nuget.org/v3/index.json\r\n      C:\\Program Files (x86)\\Microsoft SDKs\\NuGetPackages\\\r\nDone Building Project \"C:\\work\\test\\Rollup.sln\" (Restore target(s)).\r\n\r\n\r\nBuild succeeded.\r\n    0 Warning(s)\r\n    0 Error(s)\r\n\r\nTime Elapsed 00:00:00.79\r\nC:\\work\\test [master \u21911 +3 ~1 -16 ~]> msbuild /bl\r\nMicrosoft (R) Build Engine version 15.9.20+g88f5fadfbe for .NET Framework\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\nC:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\\\MSBuild\\15.0\\bin\\MSBuild.exe /bl .\\Rollup.sln\r\nBuilding the projects in this solution one at a time. To enable parallel build, please add the \"/m\" switch.\r\nBuild started 12/7/2018 9:38:29 PM.\r\nProject \"C:\\work\\test\\Rollup.sln\" on node 1 (default targets).\r\nValidateSolutionConfiguration:\r\n  Building solution configuration \"Debug|Any CPU\".\r\nProject \"C:\\work\\test\\Rollup.sln\" (1) is building \"C:\\work\\test\\UITests\\UITests.csproj\" (2) on node 1 (default targets).\r\nPrepareForBuild:\r\n  Creating directory \"bin\\Debug\\net472\\\".\r\n  Creating directory \"obj\\Debug\\net472\\\".\r\nGenerateTargetFrameworkMonikerAttribute:\r\nSkipping target \"GenerateTargetFrameworkMonikerAttribute\" because all output files are up-to-date with respect to the input files.\r\nCoreCompile:\r\n  C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\MSBuild\\15.0\\bin\\Roslyn\\csc.exe /noconfig /unsafe- /checked- /nowarn:1701,1702,1701,1702 /nostdl\r\n  ib+ /errorreport:prompt /warn:4 /define:TRACE;DEBUG;NETFRAMEWORK;NET472 /highentropyva+ /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Frame\r\n  work\\.NETFramework\\v4.7.2\\mscorlib.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Core.dll\" /refe\r\n  rence:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Data.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assem\r\n  blies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\Sys\r\n  tem.Drawing.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.IO.Compression.FileSystem.dll\" /refere\r\n  nce:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Numerics.dll\" /reference:\"C:\\Program Files (x86)\\Reference Ass\r\n  emblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Runtime.Serialization.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\\r\n  .NETFramework\\v4.7.2\\System.Xml.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Xml.Linq.dll\" /deb\r\n  ug+ /debug:portable /filealign:512 /optimize- /out:obj\\Debug\\net472\\UITests.dll /ruleset:\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Team T\r\n  ools\\Static Analysis Tools\\\\Rule Sets\\MinimumRecommendedRules.ruleset\" /subsystemversion:6.00 /target:library /warnaserror+ /utf8output /deterministic+ Class1.\r\n  cs \"C:\\Users\\mkharitonov\\AppData\\Local\\Temp\\.NETFramework,Version=v4.7.2.AssemblyAttributes.cs\" obj\\Debug\\net472\\UITests.AssemblyInfo.cs /warnaserror+:NU1605\r\n  Using shared compilation with compiler from directory: C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\MSBuild\\15.0\\bin\\Roslyn\r\n_CopyOutOfDateSourceItemsToOutputDirectory:\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\nunit.engine.dll\" to \"bin\\Debug\\net472\\nunit.engine.dll\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\nunit.engine.api.dll\" to \"bin\\Debug\\net472\\nunit.engine.api.dll\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\NUnit3.TestAdapter.dll\" to \"bin\\Debug\\net472\\NUnit3.TestAdapter.dl\r\n  l\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\NUnit3.TestAdapter.pdb\" to \"bin\\Debug\\net472\\NUnit3.TestAdapter.pd\r\n  b\".\r\nCopyFilesToOutputDirectory:\r\n  Copying file from \"obj\\Debug\\net472\\UITests.dll\" to \"bin\\Debug\\net472\\UITests.dll\".\r\n  UITests -> C:\\work\\test\\UITests\\bin\\Debug\\net472\\UITests.dll\r\n  Copying file from \"obj\\Debug\\net472\\UITests.pdb\" to \"bin\\Debug\\net472\\UITests.pdb\".\r\nDone Building Project \"C:\\work\\test\\UITests\\UITests.csproj\" (default targets).\r\n\r\nProject \"C:\\work\\test\\Rollup.sln\" (1) is building \"C:\\work\\test\\Rollup\\Rollup.csproj\" (3) on node 1 (default targets).\r\nPrepareForBuild:\r\n  Creating directory \"bin\\Debug\\net472\\\".\r\n  Creating directory \"obj\\Debug\\net472\\\".\r\nGenerateTargetFrameworkMonikerAttribute:\r\nSkipping target \"GenerateTargetFrameworkMonikerAttribute\" because all output files are up-to-date with respect to the input files.\r\nCoreCompile:\r\n  C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\MSBuild\\15.0\\bin\\Roslyn\\csc.exe /noconfig /unsafe- /checked- /nowarn:1701,1702,1701,1702 /nostdl\r\n  ib+ /errorreport:prompt /warn:4 /define:TRACE;DEBUG;NETFRAMEWORK;NET472 /highentropyva+ /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Frame\r\n  work\\.NETFramework\\v4.7.2\\mscorlib.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Core.dll\" /refe\r\n  rence:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Data.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assem\r\n  blies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\Sys\r\n  tem.Drawing.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.IO.Compression.FileSystem.dll\" /refere\r\n  nce:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Numerics.dll\" /reference:\"C:\\Program Files (x86)\\Reference Ass\r\n  emblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Runtime.Serialization.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\\r\n  .NETFramework\\v4.7.2\\System.Xml.dll\" /reference:\"C:\\Program Files (x86)\\Reference Assemblies\\Microsoft\\Framework\\.NETFramework\\v4.7.2\\System.Xml.Linq.dll\" /ref\r\n  erence:C:\\work\\test\\UITests\\bin\\Debug\\net472\\UITests.dll /debug+ /debug:portable /filealign:512 /optimize- /out:obj\\Debug\\net472\\Rollup.dll /ruleset:\"C:\\Progra\r\n  m Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Team Tools\\Static Analysis Tools\\\\Rule Sets\\MinimumRecommendedRules.ruleset\" /subsystemversion:6.00 /targ\r\n  et:library /warnaserror+ /utf8output /deterministic+ obj\\Debug\\net472\\Rollup.AssemblyInfo.cs /warnaserror+:NU1605\r\n  Using shared compilation with compiler from directory: C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\MSBuild\\15.0\\bin\\Roslyn\r\n_CopyFilesMarkedCopyLocal:\r\n  Copying file from \"C:\\work\\test\\UITests\\bin\\Debug\\net472\\UITests.dll\" to \"bin\\Debug\\net472\\UITests.dll\".\r\n  Copying file from \"C:\\work\\test\\UITests\\bin\\Debug\\net472\\UITests.pdb\" to \"bin\\Debug\\net472\\UITests.pdb\".\r\n  Creating \"C:\\work\\test\\Rollup\\obj\\Debug\\net472\\Rollup.csproj.CopyComplete\" because \"AlwaysCreate\" was specified.\r\n_CopyOutOfDateSourceItemsToOutputDirectory:\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\nunit.engine.dll\" to \"bin\\Debug\\net472\\nunit.engine.dll\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\NUnit3.TestAdapter.pdb\" to \"bin\\Debug\\net472\\NUnit3.TestAdapter.pd\r\n  b\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\nunit.engine.api.dll\" to \"bin\\Debug\\net472\\nunit.engine.api.dll\".\r\n  Copying file from \"C:\\Users\\mkharitonov\\.nuget\\packages\\nunit3testadapter\\3.11.2\\build\\net35\\NUnit3.TestAdapter.dll\" to \"bin\\Debug\\net472\\NUnit3.TestAdapter.dl\r\n  l\".\r\nCopyFilesToOutputDirectory:\r\n  Copying file from \"obj\\Debug\\net472\\Rollup.dll\" to \"bin\\Debug\\net472\\Rollup.dll\".\r\n  Rollup -> C:\\work\\test\\Rollup\\bin\\Debug\\net472\\Rollup.dll\r\n  Copying file from \"obj\\Debug\\net472\\Rollup.pdb\" to \"bin\\Debug\\net472\\Rollup.pdb\".\r\nDone Building Project \"C:\\work\\test\\Rollup\\Rollup.csproj\" (default targets).\r\n\r\nDone Building Project \"C:\\work\\test\\Rollup.sln\" (default targets).\r\n\r\nDeferred Messages\r\n\r\n  Detailed Build Summary\r\n  ======================\r\n\r\n\r\n  ============================== Build Hierarchy (IDs represent configurations) =====================================================\r\n  Id                  : Exclusive Time   Total Time   Path (Targets)\r\n  -----------------------------------------------------------------------------------------------------------------------------------\r\n  0                   : 0.046s           0.851s       C:\\work\\test\\Rollup.sln ()\r\n  | 1                 : 0.580s           0.580s       C:\\work\\test\\UITests\\UITests.csproj ()\r\n  . 2                 : 0.209s           0.226s       C:\\work\\test\\Rollup\\Rollup.csproj ()\r\n  | | 3               : 0.009s           0.009s       C:\\work\\test\\UITests\\UITests.csproj (GetTargetFrameworks)\r\n  | . 4               : 0.008s           0.008s       C:\\work\\test\\UITests\\UITests.csproj (GetNativeManifest)\r\n\r\n  ============================== Node Utilization (IDs represent configurations) ====================================================\r\n  Timestamp:            1        Duration   Cumulative\r\n  -----------------------------------------------------------------------------------------------------------------------------------\r\n  636798335100192873:   0        0.034s     0.034s\r\n  636798335100533786:   1        0.580s     0.614s ###########\r\n  636798335106329212:   2        0.063s     0.677s #\r\n  636798335106961300:   3        0.008s     0.685s\r\n  636798335107041507:   2        0.040s     0.725s\r\n  636798335107442188:   4        0.008s     0.733s\r\n  636798335107522409:   2        0.106s     0.839s ##\r\n  636798335108585229:   0        0.012s     0.851s\r\n  -----------------------------------------------------------------------------------------------------------------------------------\r\n  Utilization:          100.0    Average Utilization: 100.0\r\n\r\nBuild succeeded.\r\n    0 Warning(s)\r\n    0 Error(s)\r\n\r\nTime Elapsed 00:00:00.94\r\nC:\\work\\test [master \u21911 +3 ~1 -16 | +1 ~0 -0 !]> dir .\\Rollup\\bin\\Debug\\net472\\NUnit3.TestAdapter.dll\r\n\r\n\r\n    Directory: C:\\work\\test\\Rollup\\bin\\Debug\\net472\r\n\r\n\r\nMode                LastWriteTime         Length Name\r\n----                -------------         ------ ----\r\n-a----       11/22/2018   7:56 AM         352768 NUnit3.TestAdapter.dll\r\n\r\n\r\nC:\\work\\test [master \u21911 +3 ~1 -16 | +1 ~0 -0 !]>\r\n```\r\n\r\n### Expected  behavior\r\nThe dependency `NUnit3TestAdapter` of UITests does not end up in the bin folder of Rollup, because it has PrivateAssets = All\r\n\r\n### Actual behavior\r\nIt ends up there as if PrivateAssets does not matter.\r\n\r\n### Environment data\r\n```\r\nC:\\work\\test [master \u21911 +3 ~1 -16 | +1 ~0 -0 !]> msbuild /version\r\nMicrosoft (R) Build Engine version 15.9.20+g88f5fadfbe for .NET Framework\r\nCopyright (C) Microsoft Corporation. All rights reserved.\r\n\r\n15.9.20.62856\r\n```\r\nI can attach the binlog, if needed.\r\n",
  "state": "OPEN",
  "createdAt": "2018-12-08T02:41:42Z",
  "updatedAt": "2024-02-21T16:32:19Z",
  "closedAt": null,
  "author": {
    "login": "MarkKharitonov"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "This [Stack Overflow](https://stackoverflow.com/a/53691734/15393) answer appears to be related. It describes how NUnit3TestAdapter has a .props file which causes dlls to be added as Content files of the original project.",
        "createdAt": "2019-05-31T12:36:11Z",
        "updatedAt": "2019-05-31T12:36:11Z",
        "author": {
          "login": "rowland-banks-abide"
        }
      },
      {
        "body": "Yes it does. (That is my SO question, btw)",
        "createdAt": "2019-05-31T13:22:52Z",
        "updatedAt": "2019-05-31T13:22:52Z",
        "author": {
          "login": "MarkKharitonov"
        }
      }
    ]
  }
}