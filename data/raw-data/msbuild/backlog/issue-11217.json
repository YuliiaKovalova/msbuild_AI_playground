{
  "number": 11217,
  "title": "dotnet build ignores casing of project file when setting up namespace",
  "body": "---\r\n**Issue moved from dotnet/sdk#45701**\r\n- Please respond to @NeilMacMullen.\r\n\r\n---\r\n\r\n_From @NeilMacMullen on Friday, January 3, 2025 3:39:17 PM_\r\n\r\n\n### Describe the bug\nI'm not sure if this is a bug but it's certainly unexpected behaviour and caused me to waste a few hours yesterday....\n\n`dotnet build` appears to use the casing of the csproj file specified in the command  rather than the actual casing in the file-system.  The practical impact of this is that the _default-namespace_ for embedded resources is then incorrect and since GetManifestResourceStream is _case-sensitive_, applications can fail depending upon what casing was used when specifying `dotnet build` or `dotnet publish`\n\n### To Reproduce\n\nThe attached zip file contains a minimal example but the repro case is trivial...\n\n- create a simple console application whose name is a mixture of upper and lower case (e.g. MyApp)\n- Add an embedded resource (e.g. \"testData.txt\")\n- Use the following code for Program.cs\n```CSharp\nusing System.Reflection;\nvar embedded = Assembly.GetExecutingAssembly().GetManifestResourceNames();\nforeach(var m in embedded)\n    Console.WriteLine($\"embedded resource '{m}'\");\n```\n\nBuild the application with expected casing of the project file then all lower-case...\n\n\n```\n\u279c rm -r -force bin ;rm -r -force obj; dotnet build .\\MyApp.csproj;.\\bin\\Debug\\net9.0\\myapp.exe\nRestore complete (0.2s)\nYou are using a preview version of .NET. See: https://aka.ms/dotnet-support-policy\n  MyApp succeeded (0.2s) \u2192 bin\\Debug\\net9.0\\MyApp.dll\n\nBuild succeeded in 0.7s\nembedded resource 'MyApp.testData.txt'\n\n\u279c rm -r -force bin ;rm -r -force obj; dotnet build .\\myapp.csproj;.\\bin\\Debug\\net9.0\\myapp.exe\nRestore complete (0.2s)\nYou are using a preview version of .NET. See: https://aka.ms/dotnet-support-policy\n  myapp succeeded (0.2s) \u2192 bin\\Debug\\net9.0\\myapp.dll\n\nBuild succeeded in 0.7s\nembedded resource 'myapp.testData.txt'\n```\n\n*Note the difference in output - the resource path uses the casing specified in the build line.*\n\nSomewhat unexpectedly, `dotnet run` manages to use the correct casing...\n\n```\n\u279c rm -r -force bin ;rm -r -force obj; dotnet run .\\myapp.csproj\nembedded resource 'MyApp.testData.txt'\n```\n\n\n\n[MyApp.zip](https://github.com/user-attachments/files/18301143/MyApp.zip)\n\n\n### Further technical details\n\n```\n.NET SDK:\n Version:           9.0.200-preview.0.24575.35\n Commit:            81b5f040be\n Workload version:  9.0.200-manifests.1e472b70\n MSBuild version:   17.13.0-preview-24569-04+8f6b8ad0a\n\nRuntime Environment:\n OS Name:     Windows\n OS Version:  10.0.26100\n OS Platform: Windows\n RID:         win-x64\n Base Path:   C:\\Program Files\\dotnet\\sdk\\9.0.200-preview.0.24575.35\\\n\n.NET workloads installed:\n [android]\n   Installation Source: SDK 9.0.200-preview.0, VS 17.13.35617.110, VS 17.12.35527.113\n   Manifest Version:    35.0.24/9.0.100\n   Manifest Path:       C:\\Program Files\\dotnet\\sdk-manifests\\9.0.100\\microsoft.net.sdk.android\\35.0.24\\WorkloadManifest.json\n   Install Type:              Msi\n\n [aspire]\n   Installation Source: SDK 9.0.200-preview.0, VS 17.12.35527.113\n   Manifest Version:    8.2.2/8.0.100\n   Manifest Path:       C:\\Program Files\\dotnet\\sdk-manifests\\8.0.100\\microsoft.net.sdk.aspire\\8.2.2\\WorkloadManifest.json\n   Install Type:              Msi\n\n [ios]\n   Installation Source: SDK 9.0.200-preview.0, VS 17.13.35617.110, VS 17.12.35527.113\n   Manifest Version:    18.2.9170/9.0.100\n   Manifest Path:       C:\\Program Files\\dotnet\\sdk-manifests\\9.0.100\\microsoft.net.sdk.ios\\18.2.9170\\WorkloadManifest.json\n   Install Type:              Msi\n\n [maccatalyst]\n   Installation Source: SDK 9.0.200-preview.0, VS 17.13.35617.110, VS 17.12.35527.113\n   Manifest Version:    18.2.9170/9.0.100\n   Manifest Path:       C:\\Program Files\\dotnet\\sdk-manifests\\9.0.100\\microsoft.net.sdk.maccatalyst\\18.2.9170\\WorkloadManifest.json\n   Install Type:              Msi\n\n [maui-windows]\n   Installation Source: SDK 9.0.200-preview.0, VS 17.13.35617.110, VS 17.12.35527.113\n   Manifest Version:    9.0.0/9.0.100\n   Manifest Path:       C:\\Program Files\\dotnet\\sdk-manifests\\9.0.100\\microsoft.net.sdk.maui\\9.0.0\\WorkloadManifest.json\n   Install Type:              Msi\n\nConfigured to use loose manifests when installing new manifests.\n\nHost:\n  Version:      9.0.0\n  Architecture: x64\n  Commit:       9d5a6a9aa4\n\n.NET SDKs installed:\n  8.0.111 [C:\\Program Files\\dotnet\\sdk]\n  8.0.206 [C:\\Program Files\\dotnet\\sdk]\n  8.0.307 [C:\\Program Files\\dotnet\\sdk]\n  8.0.404 [C:\\Program Files\\dotnet\\sdk]\n  9.0.101 [C:\\Program Files\\dotnet\\sdk]\n  9.0.200-preview.0.24575.35 [C:\\Program Files\\dotnet\\sdk]\n\n.NET runtimes installed:\n  Microsoft.AspNetCore.App 6.0.36 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\n  Microsoft.AspNetCore.App 7.0.20 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\n  Microsoft.AspNetCore.App 8.0.6 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\n  Microsoft.AspNetCore.App 8.0.11 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\n  Microsoft.AspNetCore.App 9.0.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\n  Microsoft.NETCore.App 6.0.36 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\n  Microsoft.NETCore.App 7.0.20 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\n  Microsoft.NETCore.App 8.0.6 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\n  Microsoft.NETCore.App 8.0.11 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\n  Microsoft.NETCore.App 9.0.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\n  Microsoft.WindowsDesktop.App 6.0.36 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\n  Microsoft.WindowsDesktop.App 7.0.20 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\n  Microsoft.WindowsDesktop.App 8.0.6 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\n  Microsoft.WindowsDesktop.App 8.0.11 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\n  Microsoft.WindowsDesktop.App 9.0.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.WindowsDesktop.App]\n\nOther architectures found:\n  x86   [C:\\Program Files (x86)\\dotnet]\n    registered at [HKLM\\SOFTWARE\\dotnet\\Setup\\InstalledVersions\\x86\\InstallLocation]\n\nEnvironment variables:\n  Not set\n\nglobal.json file:\n  Not found\n\nLearn more:\n  https://aka.ms/dotnet/info\n\nDownload .NET:\n  https://aka.ms/dotnet/download\n\n```",
  "state": "CLOSED",
  "createdAt": "2025-01-03T17:03:04Z",
  "updatedAt": "2025-01-14T14:57:47Z",
  "closedAt": "2025-01-14T14:57:47Z",
  "author": {
    "login": "JanKrivanek"
  },
  "milestone": null,
  "assignees": {
    "nodes": []
  },
  "labels": [
    "untriaged"
  ],
  "comments": {
    "nodes": [
      {
        "body": "---\r\n**Issue moved from dotnet/sdk#45701**\r\n- Please respond to @baronfel.\r\n\r\n---\r\n\r\n_From @baronfel on Friday, January 3, 2025 3:58:21 PM_\r\n\r\nThe default value for the RootNamespace is computed [here](https://github.com/dotnet/sdk/blob/5fc518d421255218cf575a517ee403eb5ed38398/src/Tasks/Microsoft.NET.Build.Tasks/targets/Microsoft.NET.Sdk.props#L42):\n\n```xml\n<RootNamespace Condition=\" '$(RootNamespace)' == '' \">$(MSBuildProjectName.Replace(\" \", \"_\"))</RootNamespace>\n```\n\nWe're using the MSBuild-engine-provided reserved property `MSBuildProjectName`, which is set\n\n* in the [Evaluator](https://github.com/dotnet/msbuild/blob/9b15d8bf992c29ea610d525435088c9127e623d6/src/Build/Evaluation/Evaluator.cs#L1184)\n* from the [FullPath of the project file XML](https://github.com/dotnet/msbuild/blob/9b15d8bf992c29ea610d525435088c9127e623d6/src/Build/Evaluation/Evaluator.cs#L1173)\n\nSo my suspicion is that there's some missing normalization in MSBuild itself that could/should be done here. I think it's reasonable to expect the name of the file to be its on-disk name. @JanKrivanek / @rainersigwald any objections to moving this to dotnet/msbuild?",
        "createdAt": "2025-01-03T17:03:05Z",
        "author": {
          "login": "JanKrivanek"
        }
      },
      {
        "body": "Might be related to #3665.",
        "createdAt": "2025-01-08T20:11:58Z",
        "author": {
          "login": "yuehuang010"
        }
      }
    ]
  }
}