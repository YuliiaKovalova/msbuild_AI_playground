{
  "number": 1409,
  "title": "GitVersioning fails in Full Framework CI builds",
  "body": "See for example: https://ci2.dot.net/job/Microsoft_msbuild/job/master/job/_Windows_NT_Desktop_prtest/79/\r\n\r\n```\r\n10:48:02.270     5>D:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018: The \"Nerdbank.GitVersioning.Tasks.GetBuildVersion\" task failed unexpectedly. [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018: System.ArgumentNullException: Value cannot be null. [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018: Parameter name: SafeHandle cannot be null. [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.StubHelpers.StubHelpers.SafeHandleAddRef(SafeHandle pHandle, Boolean& success) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at LibGit2Sharp.Core.NativeMethods.git_commit_tree_id(GitObjectSafeHandle commit) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at LibGit2Sharp.Commit.<.ctor>b__0(GitObjectSafeHandle obj) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at LibGit2Sharp.Core.GitObjectLazyGroup.<>c__DisplayClass1`1.<Singleton>b__0() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Lazy`1.CreateValue() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Lazy`1.LazyInitValue() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Lazy`1.get_Value() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at LibGit2Sharp.Core.LazyGroup`1.LazyWrapper`1.LibGit2Sharp.Core.ILazy<TType>.get_Value() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at LibGit2Sharp.Commit.get_Tree() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.VersionFile.GetVersionFileReader(Commit commit, String repoRelativeProjectDirectory, Boolean& isJsonFile) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.VersionFile.GetVersion(Commit commit, String repoRelativeProjectDirectory) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.CommitMatchesMajorMinorVersion(Commit commit, Version expectedVersion, String repoRelativeProjectDirectory) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.<>c__DisplayClass2_0.<GetVersionHeight>b__0(Commit c) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetCommitHeight(Commit commit, Dictionary`2 heights, Func`2 continueStepping) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.<>c__DisplayClass17_0.<GetCommitHeight>b__0(Commit p) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Linq.Enumerable.WhereSelectEnumerableIterator`2.MoveNext() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Linq.Enumerable.Max(IEnumerable`1 source) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetCommitHeight(Commit commit, Dictionary`2 heights, Func`2 continueStepping) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.<>c__DisplayClass17_0.<GetCommitHeight>b__0(Commit p) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Linq.Enumerable.WhereSelectEnumerableIterator`2.MoveNext() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at System.Linq.Enumerable.Max(IEnumerable`1 source) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetCommitHeight(Commit commit, Dictionary`2 heights, Func`2 continueStepping) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetHeight(Commit commit, Func`2 continueStepping) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetVersionHeight(Commit commit, String repoRelativeProjectDirectory) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetVersionHeight(Branch branch, String repoRelativeProjectDirectory) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.GitExtensions.GetVersionHeight(Repository repo, String repoRelativeProjectDirectory) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.VersionOracle..ctor(String projectDirectory, Repository repo, ICloudBuild cloudBuild) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.VersionOracle.Create(String projectDirectory, String gitRepoDirectory, ICloudBuild cloudBuild) [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Nerdbank.GitVersioning.Tasks.GetBuildVersion.Execute() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\nD:\\j\\workspace\\_Windows_NT_D---eb124103\\packages\\Nerdbank.GitVersioning\\1.5.46\\build\\Nerdbank.GitVersioning.targets(43,5): error MSB4018:    at Microsoft.Build.BackEnd.TaskBuilder.<ExecuteInstantiatedTask>d__26.MoveNext() [D:\\j\\workspace\\_Windows_NT_D---eb124103\\src\\Framework\\Microsoft.Build.Framework.csproj]\r\n10:48:02.270     5>Done executing task \"Nerdbank.GitVersioning.Tasks.GetBuildVersion\" -- FAILED. (TaskId:66)\r\n10:48:02.270     5>Done building target \"GetBuildVersion\" in project \"Microsoft.Build.Framework.csproj\" -- FAILED.: (TargetId:108)\r\n```",
  "state": "CLOSED",
  "createdAt": "2016-11-30T13:23:43Z",
  "updatedAt": "2024-02-21T17:23:53Z",
  "closedAt": "2016-11-30T19:19:20Z",
  "author": {
    "login": "rainersigwald"
  },
  "labels": [
    "triaged"
  ],
  "assignees": {
    "nodes": []
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "Jenkins build definition changed to do a shallow clone.  I changed it back to do a deep clone so that GitVersioning can calculate the commit height.",
        "createdAt": "2016-11-30T19:19:20Z",
        "updatedAt": "2016-11-30T19:19:20Z",
        "author": {
          "login": "jeffkl"
        }
      },
      {
        "body": "Was the change something we did or something that came from netci?",
        "createdAt": "2016-11-30T19:59:52Z",
        "updatedAt": "2016-11-30T19:59:52Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "We didn't change anything as far as I know and I don't see anything in our netci config.  They did upgrade Jenkins so I'm just assuming that it was a new default.",
        "createdAt": "2016-11-30T20:27:09Z",
        "updatedAt": "2016-11-30T20:27:09Z",
        "author": {
          "login": "jeffkl"
        }
      }
    ]
  }
}