{
  "number": 7210,
  "title": "MSB1008: Only one project can be specified when Directory.Build.rsp contains undefined environment variable",
  "body": "### Issue Description\r\n\r\nI ran into an issue where MSBuild generates a misleading error message. I was trying to run MSBuild in a repo with a custom build environment which requires environment variables to be set (CoreXT). Since CoreXT was not needed for this particular project, I was trying to run MSBuild without initializing CoreXT. I am wondering if the experience here can be improved.\r\n\r\n### Steps to Reproduce\r\n1. Commit a Directory.Build.rsp file with an environment variable (Example)\r\n\r\n# Add command-line for Microsoft.Build.Telemetry logger.\r\n%MSBUILDTELCMD%\r\n\r\n2. Run msbuild without that environment variable defined.\r\n\r\nExample command line generated by the MSBuild ADO task.\r\n\r\n\"c:\\.vs\\msbuild\\17.0\\MSBuild\\Current\\Bin\\amd64\\MSBuild.exe\" \"C:\\__w\\1\\s\\EngSys-Pipelines\\templates\\msbuild\\CodeSign\\CodeSignUntrustedFiles.proj\" /nologo /nr:false /t:\"Clean\" /dl:CentralLogger,\"C:\\__w\\_tasks\\MSBuild_c6c4c611-aa2e-4a33-b606-5eaba2196824\\1.192.2\\ps_modules\\MSBuildHelpers\\Microsoft.TeamFoundation.DistributedTask.MSBuild.Logger.dll\";\"RootDetailId=772cb217-9388-4362-a2c5-2822e9a3e0a2|SolutionDir=C:\\__w\\1\\s\\EngSys-Pipelines\\templates\\msbuild\\CodeSign\"*ForwardingLogger,\"C:\\__w\\_tasks\\MSBuild_c6c4c611-aa2e-4a33-b606-5eaba2196824\\1.192.2\\ps_modules\\MSBuildHelpers\\Microsoft.TeamFoundation.DistributedTask.MSBuild.Logger.dll\" /t:Restore /m /p:_MSDeployUserAgent=\"VSTS_41bf5486-7392-4b7a-a7e3-a735c767e3b3_build_251213_0\"\r\n\r\n### Expected Behavior\r\n\r\nMSBuild should run the project I specified on the \r\n\r\n### Actual Behavior\r\nMSBUILD : error MSB1008: Only one project can be specified.\r\nSwitch: <Some project path>\r\n\r\nExample:\r\n\r\nMSBUILD : error MSB1008: Only one project can be specified.\r\nSwitch: C:\\__w\\1\\s\\EngSys-Pipelines\\templates\\msbuild\\CodeSign\\CodeSignUntrustedFiles.proj\r\n\r\n### Analysis\r\nThis issue is confusing because the exact same command line will work in one repo but not another. \r\n\r\n### Versions & Configurations\r\n\r\nMSBuild 17 or older.\r\nWindows\r\n",
  "state": "CLOSED",
  "createdAt": "2022-01-03T22:50:45Z",
  "updatedAt": "2024-02-21T14:10:29Z",
  "closedAt": "2022-01-06T17:17:20Z",
  "author": {
    "login": "CarlHeinrichs"
  },
  "labels": [
    "bug",
    "triaged"
  ],
  "assignees": {
    "nodes": [
      {
        "login": "Forgind"
      }
    ]
  },
  "milestone": null,
  "comments": {
    "nodes": [
      {
        "body": "@CarlHeinrichs instead of just `%MSBUILDTELCMD%`, you can use the functionality from dotnet/msbuild#4612 for exactly this case.",
        "createdAt": "2022-01-04T15:09:20Z",
        "updatedAt": "2022-01-04T15:09:20Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "Closing from:\r\n\r\n> @CarlHeinrichs instead of just `%MSBUILDTELCMD%`, you can use the functionality from #4612 for exactly this case.\r\n\r\n",
        "createdAt": "2022-01-06T17:17:20Z",
        "updatedAt": "2022-01-06T17:17:20Z",
        "author": {
          "login": "Forgind"
        }
      }
    ]
  }
}