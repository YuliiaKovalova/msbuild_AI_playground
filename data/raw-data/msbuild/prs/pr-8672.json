{
  "number": 8672,
  "title": "Update to Arcade 8",
  "body": "Fixes #8969\r\n\r\n- Make IDE0251 a suggestion\r\n- Arcade 8\r\n- Put expected and actual in the right places for some tlbimp tests\r\n- Explicit System.IO.Compression reference\r\n",
  "state": "MERGED",
  "createdAt": "2023-04-17T19:05:15Z",
  "updatedAt": "2023-07-14T16:24:44Z",
  "closedAt": "2023-07-14T16:24:43Z",
  "mergedAt": "2023-07-14T16:24:43Z",
  "additions": 1662,
  "deletions": 1057,
  "changedFiles": 80,
  "headRefName": "arcade8",
  "isDraft": false,
  "author": {
    "login": "rainersigwald"
  },
  "milestone": null,
  "assignees": {
    "nodes": [
      {
        "login": "GangWang01"
      },
      {
        "login": "JaynieBai"
      }
    ]
  },
  "labels": [],
  "commits": {
    "nodes": [
      {
        "commit": {
          "oid": "77745c4a419ccfe091e4d4dee60dde54415bed8c",
          "message": "Make IDE0251 a suggestion\n\nIt fires in some very funky places like Dispose methods\nwhere it's not _wrong_ but it would be _weird_.",
          "committedDate": "2023-04-17T18:53:08Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "55a6832e98eea76dcd889f70efe1fd7316108e6e",
          "message": "Arcade 8",
          "committedDate": "2023-04-17T18:58:27Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "8ed1d4b2ee308ba5fa87daa2d74b48724b393fd0",
          "message": "Put expected and actual in the right places for some tlbimp tests",
          "committedDate": "2023-04-17T19:04:16Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "0983ad84f54eb59fd7ff84175a4067d934a8bc66",
          "message": "Explicit System.IO.Compression reference",
          "committedDate": "2023-04-17T19:04:42Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "a54e08e73e95186b4a3135286df37cd622d4ec1e",
          "message": "download 7 runtime",
          "committedDate": "2023-04-17T21:34:06Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "1a0249f42dbd0bb44a1ecf8837741410ffd6585c",
          "message": "Merge branch 'main' into arcade8",
          "committedDate": "2023-06-28T08:52:05Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "9e08bebab44c30df47fb0509642f99689afd79ab",
          "message": "Update the net7.0 path to net8.0",
          "committedDate": "2023-06-29T08:13:11Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "7c8e69f83efc5be895c1d12db91761fe48e059ab",
          "message": "Update source prebuild baseline",
          "committedDate": "2023-06-29T09:12:48Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "cace149cfaf4ff5a6ef943193b4befb6633225eb",
          "message": "Suppress the error PKV006 for Net 7.0 temporally",
          "committedDate": "2023-07-11T04:28:01Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "7a98402720784debe3202b82a6d1295e1ce66718",
          "message": "suppress PKV006 for Net7.0",
          "committedDate": "2023-07-11T04:40:11Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f94059fe8bc2bcd908ff51d8e180ca59a0eaf480",
          "message": "Update doc to net8.0",
          "committedDate": "2023-07-11T07:39:45Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "963331cc8f7d4c9220da2dac3e2b65b9dfb8d04e",
          "message": "Add doc header",
          "committedDate": "2023-07-12T03:43:26Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "1aa2d03281f776410f0be4a0acdfc124cece7153",
          "message": "Merge branch 'arcade8' of https://github.com/rainersigwald/msbuild into arcade8",
          "committedDate": "2023-07-12T03:44:07Z",
          "author": {
            "name": "Jenny Bai",
            "email": "v-jennybai@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "0941c564cad609e4e9638d1e497607b809fb2d6c",
          "message": "Update runtime to 8.0",
          "committedDate": "2023-07-14T09:35:19Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "d7215c6bec27f45d8d5bda0806b096429426e2d7",
          "message": "Add the comment for adding PKV006 suppression; update doc and remove useless property setting",
          "committedDate": "2023-07-14T10:09:40Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "5d691866698cfdee5086e24a47124f31f2b9a8cb",
          "message": "Remove specific runtime version",
          "committedDate": "2023-07-14T13:47:46Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      }
    ]
  },
  "comments": {
    "nodes": [
      {
        "body": "Naive question - can the eng\\common\\* changes associated with the arcade update be made as a maestro flow PR from arcade? (with all other fixes needed for it to go through to be added to that PR)\r\n\r\nAt least those changes comes from arcade (are not msbuild specific) and hence do not need to be reviewed in detail - is that correct?",
        "createdAt": "2023-04-19T07:19:19Z",
        "author": {
          "login": "JanKrivanek"
        }
      },
      {
        "body": "I generated the big change in this PR with a `darc update-dependencies` command that does locally what the darc subscriptions would create a PR for--I expected this change to break so I didn't want to change the subscription and break our 6.0 flow. You're right that `eng/common/*` belongs to Arcade and doesn't need much in the way of review.\r\n\r\nBut this is broken so don't review it at all yet :)",
        "createdAt": "2023-04-19T14:49:44Z",
        "author": {
          "login": "rainersigwald"
        }
      },
      {
        "body": "/azp run",
        "createdAt": "2023-06-28T08:25:34Z",
        "author": {
          "login": "JaynieBai"
        }
      },
      {
        "body": "<samp>\nPull request contains merge conflicts.<br>\r\n\n</samp>",
        "createdAt": "2023-06-28T08:25:39Z",
        "author": {
          "login": "azure-pipelines"
        }
      },
      {
        "body": "@ViktorHofer we are trying to update MSBuild TFM and Arcade version both to net8.0 and currently we are stuck at \r\n\r\n```\r\n##[error].dotnet\\sdk\\8.0.100-preview.3.23178.7\\Sdks\\Microsoft.NET.Sdk\\targets\\Microsoft.NET.ApiCompat.ValidatePackage.targets(39,5): error PKV006: (NETCORE_ENGINEERING_TELEMETRY=Build) Target framework net7.0 is no longer supported in the latest version..\r\n```\r\n\r\nShould we temporarily disable the package validation, produce a successfull build (targetting net8.0) and then point baseline to that successfull build? Or is there alternative suggestion how to satisfy baseline validation check with our current baseline (targetting net7.0)?\r\n\r\nFYI @JaynieBai, @GangWang01 ",
        "createdAt": "2023-07-07T11:43:46Z",
        "author": {
          "login": "JanKrivanek"
        }
      },
      {
        "body": "> Should we temporarily disable the package validation, produce a successfull build (targetting net8.0) and then point baseline to that successfull build? Or is there alternative suggestion how to satisfy baseline validation check with our current baseline (targetting net7.0)?\r\n\r\nThis is telling you that you are dropping a TFM in your packages which is considered a breaking change. If that's intentional, you can suppress these errors by updating the suppression file via the following flag: `dotnet build /p:GenerateCompatibilitySuppressionFile=true`. Note that with .NET 7, the flag got renamed to `dotnet build /p:ApiCompatGenerateSuppressionFile=true` but the old one still works.\r\n\r\nNote that you could also NoWarn the error but that would disable the validation entirely for all TFM changes.",
        "createdAt": "2023-07-10T13:42:29Z",
        "author": {
          "login": "ViktorHofer"
        }
      },
      {
        "body": "After I pushed the commit that resolved review comment, the new run failed. So I reverted the commit back. The run still failed with the error below. I'm looking into it.\r\n```\r\nstage1\\bin\\bootstrap\\net8.0\\MSBuild\\NuGet.RestoreEx.targets#L19\r\nstage1\\bin\\bootstrap\\net8.0\\MSBuild\\NuGet.RestoreEx.targets(19,5): error : (NETCORE_ENGINEERING_TELEMETRY=Restore) Static graph-based restore encountered an unhandled exception. Please file an issue at https://github.com/NuGet/Home.  The exception was:\r\nSystem.IO.FileNotFoundException: Could not load file or assembly 'System.Runtime, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'. The system cannot find the file specified.\r\nFile name: 'System.Runtime, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'\r\n   at NuGet.Build.Tasks.Console.MSBuildStaticGraphRestore..ctor(Boolean debug)\r\n   at NuGet.Build.Tasks.Console.Program.Main(String[] args)\r\n```",
        "createdAt": "2023-07-13T11:00:42Z",
        "author": {
          "login": "GangWang01"
        }
      },
      {
        "body": "> After I pushed the commit that resolved review comment, the new run failed. So I reverted the commit back. The run still failed with the error below. I'm looking into it.\r\n> \r\n> ```\r\n> stage1\\bin\\bootstrap\\net8.0\\MSBuild\\NuGet.RestoreEx.targets#L19\r\n> stage1\\bin\\bootstrap\\net8.0\\MSBuild\\NuGet.RestoreEx.targets(19,5): error : (NETCORE_ENGINEERING_TELEMETRY=Restore) Static graph-based restore encountered an unhandled exception. Please file an issue at https://github.com/NuGet/Home.  The exception was:\r\n> System.IO.FileNotFoundException: Could not load file or assembly 'System.Runtime, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'. The system cannot find the file specified.\r\n> File name: 'System.Runtime, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'\r\n>    at NuGet.Build.Tasks.Console.MSBuildStaticGraphRestore..ctor(Boolean debug)\r\n>    at NuGet.Build.Tasks.Console.Program.Main(String[] args)\r\n> ```\r\n\r\nLooks like clash with https://github.com/dotnet/msbuild/pull/8856",
        "createdAt": "2023-07-13T16:40:23Z",
        "author": {
          "login": "JanKrivanek"
        }
      }
    ]
  },
  "reviewThreads": {
    "nodes": [
      {
        "comments": {
          "nodes": [
            {
              "body": "please keep this comment. It is added by APICompat/PackageValidation v7 and upwards. Same for the other removals.",
              "createdAt": "2023-07-11T10:51:14Z",
              "path": "src/Build/CompatibilitySuppressions.xml",
              "diffHunk": "@@ -1,6 +1,7 @@\n \ufeff<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<!-- https://learn.microsoft.com/en-us/dotnet/fundamentals/package-validation/diagnostic-ids -->",
              "author": {
                "login": "ViktorHofer"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "```suggestion\r\nThe `netstandard2.0` target of this build is configured only to output reference assemblies; at runtime MSBuild will be `net8.0` or `net472`. Please use the `net8.0`-targeted assemblies for .NET 8+ scenarios.\r\n```",
              "createdAt": "2023-07-11T14:18:20Z",
              "path": "src/Utilities/README.md",
              "diffHunk": "@@ -7,6 +7,6 @@ This package contains `Microsoft.Build.Utilities.Core.dll`, which defines helper\n * [`Logger`](https://docs.microsoft.com/dotnet/api/microsoft.build.utilities.logger), a base class for custom logging functionality.\n \n ### netstandard2.0 target\n-The `netstandard2.0` target of this build is configured only to output reference assemblies; at runtime MSBuild will be `net7.0` or `net472`. Please use the `net7.0`-targeted assemblies for .NET Core 6+ scenarios.\n+The `netstandard2.0` target of this build is configured only to output reference assemblies; at runtime MSBuild will be `net8.0` or `net472`. Please use the `net8.0`-targeted assemblies for .NET Core 6+ scenarios.",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "done, as well as src/Framework/README.md.",
              "createdAt": "2023-07-14T11:32:06Z",
              "path": "src/Utilities/README.md",
              "diffHunk": "@@ -7,6 +7,6 @@ This package contains `Microsoft.Build.Utilities.Core.dll`, which defines helper\n * [`Logger`](https://docs.microsoft.com/dotnet/api/microsoft.build.utilities.logger), a base class for custom logging functionality.\n \n ### netstandard2.0 target\n-The `netstandard2.0` target of this build is configured only to output reference assemblies; at runtime MSBuild will be `net7.0` or `net472`. Please use the `net7.0`-targeted assemblies for .NET Core 6+ scenarios.\n+The `netstandard2.0` target of this build is configured only to output reference assemblies; at runtime MSBuild will be `net8.0` or `net472`. Please use the `net8.0`-targeted assemblies for .NET Core 6+ scenarios.",
              "author": {
                "login": "GangWang01"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Can you please add a comment for all of these files indicating that we're taking an intentional TF change from net7 to net8 in 17.8?",
              "createdAt": "2023-07-11T14:21:03Z",
              "path": "src/Build/CompatibilitySuppressions.xml",
              "diffHunk": "@@ -23,17 +24,21 @@\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n-    <Target>T:Microsoft.Build.Exceptions.InvalidToolsetDefinitionException</Target>\n+    <Target>T:Microsoft.Build.Exceptions.InvalidProjectFileException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n-    <Target>T:Microsoft.Build.Exceptions.InvalidProjectFileException</Target>\n+    <Target>T:Microsoft.Build.Exceptions.InvalidToolsetDefinitionException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n     <Target>T:Microsoft.Build.Experimental.ProjectCache.ProjectCacheException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n-</Suppressions>\n\\ No newline at end of file\n+  <Suppression>\n+    <DiagnosticId>PKV006</DiagnosticId>",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "done",
              "createdAt": "2023-07-14T11:30:09Z",
              "path": "src/Build/CompatibilitySuppressions.xml",
              "diffHunk": "@@ -23,17 +24,21 @@\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n-    <Target>T:Microsoft.Build.Exceptions.InvalidToolsetDefinitionException</Target>\n+    <Target>T:Microsoft.Build.Exceptions.InvalidProjectFileException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n-    <Target>T:Microsoft.Build.Exceptions.InvalidProjectFileException</Target>\n+    <Target>T:Microsoft.Build.Exceptions.InvalidToolsetDefinitionException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n   <Suppression>\n     <DiagnosticId>CP0007</DiagnosticId>\n     <Target>T:Microsoft.Build.Experimental.ProjectCache.ProjectCacheException</Target>\n     <IsBaselineSuppression>true</IsBaselineSuppression>\n   </Suppression>\n-</Suppressions>\n\\ No newline at end of file\n+  <Suppression>\n+    <DiagnosticId>PKV006</DiagnosticId>",
              "author": {
                "login": "GangWang01"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "This should be deleted. NetCurrent in Arcade v8 is net8.0 already.\r\n\r\n```suggestion\r\n```",
              "createdAt": "2023-07-12T07:49:05Z",
              "path": "Directory.Build.props",
              "diffHunk": "@@ -29,7 +29,7 @@\n         continue to target .NET 7, so bump a 6 here to 7.\n      -->\n     <LatestDotNetCoreForMSBuild>$(NetCurrent)</LatestDotNetCoreForMSBuild>\n-    <LatestDotNetCoreForMSBuild Condition=\" '$(NetCurrent)' == 'net6.0' \">net7.0</LatestDotNetCoreForMSBuild>\n+    <LatestDotNetCoreForMSBuild Condition=\" '$(NetCurrent)' == 'net6.0' \">net8.0</LatestDotNetCoreForMSBuild>",
              "author": {
                "login": "ViktorHofer"
              }
            },
            {
              "body": "+ the 2 comment lines above it should go with it",
              "createdAt": "2023-07-13T05:51:52Z",
              "path": "Directory.Build.props",
              "diffHunk": "@@ -29,7 +29,7 @@\n         continue to target .NET 7, so bump a 6 here to 7.\n      -->\n     <LatestDotNetCoreForMSBuild>$(NetCurrent)</LatestDotNetCoreForMSBuild>\n-    <LatestDotNetCoreForMSBuild Condition=\" '$(NetCurrent)' == 'net6.0' \">net7.0</LatestDotNetCoreForMSBuild>\n+    <LatestDotNetCoreForMSBuild Condition=\" '$(NetCurrent)' == 'net6.0' \">net8.0</LatestDotNetCoreForMSBuild>",
              "author": {
                "login": "JanKrivanek"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Is there a reason why you don't update to the latest officially released preview (P6)?",
              "createdAt": "2023-07-12T07:49:39Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",",
              "author": {
                "login": "ViktorHofer"
              }
            },
            {
              "body": "Doing this incrementally is fine as well, was just wondering.",
              "createdAt": "2023-07-12T07:49:51Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",",
              "author": {
                "login": "ViktorHofer"
              }
            },
            {
              "body": "Pretty sure it's \"Rainer started this a long time ago and we haven't updated\" but I also lean to doing it incrementally (given that it's almost working now).",
              "createdAt": "2023-07-12T14:35:07Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "This is an Arcade custom thing that I wouldn't use if not strictly necessary. Why do you want to bring in the runtime separately from the SDK?",
              "createdAt": "2023-07-14T10:48:18Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",\n+    \"runtimes\": {\n+        \"dotnet\": [\n+            \"8.0.0-preview.7.23363.2\"\n+        ]\n+    },",
              "author": {
                "login": "ViktorHofer"
              }
            },
            {
              "body": "It was introduced by https://github.com/dotnet/msbuild/pull/8672/commits/a54e08e73e95186b4a3135286df37cd622d4ec1e.\r\n@rainersigwald can you help to answer? \r\n",
              "createdAt": "2023-07-14T11:19:28Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",\n+    \"runtimes\": {\n+        \"dotnet\": [\n+            \"8.0.0-preview.7.23363.2\"\n+        ]\n+    },",
              "author": {
                "login": "GangWang01"
              }
            },
            {
              "body": "I think that at the time I was trying to use Arcade 8 but still target .NET 7. We shouldn't need this now--let me try removing it.",
              "createdAt": "2023-07-14T13:31:38Z",
              "path": "global.json",
              "diffHunk": "@@ -3,13 +3,18 @@\n     \"allowPrerelease\": true\n   },\n   \"tools\": {\n-    \"dotnet\": \"7.0.304\",\n+    \"dotnet\": \"8.0.100-preview.3.23178.7\",\n+    \"runtimes\": {\n+        \"dotnet\": [\n+            \"8.0.0-preview.7.23363.2\"\n+        ]\n+    },",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      }
    ]
  }
}