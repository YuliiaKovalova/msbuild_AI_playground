{
  "number": 6143,
  "title": "Update to arcade 6.0",
  "body": "Fixes #6119\r\n\r\n### Context\r\nThis is to get MSBuild on [arcade powered source-build](https://github.com/dotnet/source-build/tree/master/Documentation/planning/arcade-powered-source-build).\r\n\r\n### Changes Made\r\nRan `darc update-dependencies --source-repo arcade --channel \".NET 5 Eng - Latest\"`\r\n\r\n3/3: Ran `darc update-dependencies --source-repo arcade --channel \".NET Eng - Latest\"`\r\n\r\n### Testing\r\nCI is enough.\r\n\r\n### Notes\r\nI expect this PR to be in flight as I chip away at it over time. Or it will magically work first time through.\r\n\r\nFor reviewers: The first commit is the biggest diff and was entirely generated by running the darc command above, so you may want to start at commit 2 when it comes up.",
  "state": "MERGED",
  "createdAt": "2021-02-10T01:03:44Z",
  "updatedAt": "2021-05-24T15:11:24Z",
  "closedAt": "2021-05-24T15:11:24Z",
  "mergedAt": "2021-05-24T15:11:24Z",
  "additions": 792,
  "deletions": 499,
  "changedFiles": 62,
  "headRefName": "arcade-6.0-update",
  "isDraft": false,
  "author": {
    "login": "benvillalobos"
  },
  "milestone": null,
  "assignees": {
    "nodes": []
  },
  "labels": [
    "merge-when-branch-open"
  ],
  "commits": {
    "nodes": [
      {
        "commit": {
          "oid": "8e34de8143bf26ede6579224e774d9fa17b0ab5d",
          "message": "Update to arcade 6.0\n\n* darc update-dependencies --source-repo arcade --channel '.NET Eng - Latest'\n* update DotNetCliVersion to match global.json",
          "committedDate": "2021-05-04T22:06:30Z",
          "author": {
            "name": "Ben Villalobos",
            "email": "4691428+BenVillalobos@users.noreply.github.com"
          }
        }
      },
      {
        "commit": {
          "oid": "72be073566dd3cf8304da31ba3054793affea50c",
          "message": "Update build scripts to match Arcade netcoreapp3.1",
          "committedDate": "2021-05-04T22:06:30Z",
          "author": {
            "name": "Ben Villalobos",
            "email": "4691428+BenVillalobos@users.noreply.github.com"
          }
        }
      },
      {
        "commit": {
          "oid": "2a9f6200be34e6fc41242438828edb24980810c9",
          "message": "Update net5.0 target frameworks to net6.0\n\nBecause we use binaries from the initial .NET SDK to build up our\nbootstrap directory, we're tied to the runtime version of that SDK.\nSince we will target .NET 6 for 17.0, this is a reasonable move now.\n\n* Keep ref file for .NET 6 in netstandard\n  * This isn't strictly correct but is where we have been keeping \".NET\n    Core\" API surface.\n* Use NET6_0_OR_GREATER preprocessor symbol\n  * This API is no longer available in .NET 6.\n* Update bootstrap build scripts to look for net6.0 binaries\n* Update Microsoft.Extensions.DependencyModel\n  * This needs to roughly match the SDK that we're assembling in the\n    bootstrap folder.",
          "committedDate": "2021-05-04T22:06:30Z",
          "author": {
            "name": "Ben Villalobos",
            "email": "4691428+BenVillalobos@users.noreply.github.com"
          }
        }
      },
      {
        "commit": {
          "oid": "29e17e9a9cbc50e84b65e0a70edb992015330c72",
          "message": "Opt into prerel SDKs when in VS/MSBuild.exe-driven builds\n\nThis should fix CI builds running on older VS images.",
          "committedDate": "2021-05-04T22:06:30Z",
          "author": {
            "name": "Rainer Sigwald",
            "email": "raines@microsoft.com"
          }
        }
      }
    ]
  },
  "comments": {
    "nodes": [
      {
        "body": "PR looking good so far.\r\n\r\nShould look into this before merging. May just need to update a path to look for 3.1.\r\n![image](https://user-images.githubusercontent.com/4691428/107455441-b7f08800-6b03-11eb-8c58-def083a024e3.png)\r\n",
        "createdAt": "2021-02-10T02:22:40Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "I thought the whole reason we didn't go straight to 6.0 was that we didn't want preview bits in release MSBuild?",
        "createdAt": "2021-02-10T15:42:50Z",
        "author": {
          "login": "Forgind"
        }
      },
      {
        "body": "@Forgind that's at odds with what source-build needs, which is for us to be on arcade 6. @marcpopMSFT thoughts? arcade 6 is LTS FYI.",
        "createdAt": "2021-02-10T18:14:11Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "VS PR: https://dev.azure.com/devdiv/DevDiv/_git/VS/pullrequest/303587",
        "createdAt": "2021-02-10T18:53:31Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "The VS PR failed almost identically to https://dev.azure.com/devdiv/DevDiv/_git/VS/pullrequest/303587, which suggests that merging arcade 6 won't cause any issues (famous last words).\r\n\r\nWe should wait until master is unblocked before merging this.",
        "createdAt": "2021-02-10T22:58:23Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "@epinanth, is there a channel for \"I want to be on and stay on arcade 6\" yet?",
        "createdAt": "2021-03-04T02:22:54Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "@epananth friendly ping (mispelled your username in my previous post). Seeing a lot of strange errors running `darc update-dependencies --source-repo arcade --channel \".NET Eng - Latest\"`. Should we not be using this channel if we want to be on arcade 6?",
        "createdAt": "2021-03-04T20:05:54Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "Going to look at this next week, I'm on FR next week ",
        "createdAt": "2021-03-04T22:27:00Z",
        "author": {
          "login": "epananth"
        }
      },
      {
        "body": "@epananth friendly ping \ud83d\ude42",
        "createdAt": "2021-03-09T20:52:10Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "Looking into this one today, I will post an update soon. ",
        "createdAt": "2021-03-09T20:55:18Z",
        "author": {
          "login": "epananth"
        }
      },
      {
        "body": "Notes to self: I was wondering why this succeeded on my local machine but was seeing \"sdk not found\" issues for CI builds. Turns out I had the net5 sdk installed under the .dotnet folder in the repo. Time to start updating projects to net6.0",
        "createdAt": "2021-03-23T01:17:41Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "We're hitting this breaking change by updating to net6.0: https://github.com/dotnet/docs/issues/19625\r\n\r\nThread.ResetAbort() is obsolete: https://source.dot.net/#System.Private.CoreLib/Thread.cs,47d38cd18e02048c\r\n\r\nLooks like we can just ifdef around this.",
        "createdAt": "2021-03-23T18:09:43Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "I can't seem to repro the (no bootstrap) build. Even after running `git clean -xdf` and removing my 6.0.100 preview sdk.\r\n\r\nGot it to repro on linux and seeing the same \"could not find nuget.frameworks.dll\" error. Not sure what the root cause is.\r\n\r\nFound this when digging through the assembly\r\n```\r\n// NuGet.Frameworks, Version=5.10.0.7148, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n\t// Assembly reference loading information:\r\n\t// There were some problems during assembly reference load, see below for more information!\r\n\t// Error: Could not find reference: NuGet.Frameworks, Version=5.10.0.7148, Culture=neutral, PublicKeyToken=31bf3856ad364e35\r\n```\r\n\r\n`ProcessFrameworkReferences` is an sdk task, any ideas @dsplaisted?\r\n![image](https://user-images.githubusercontent.com/4691428/113220097-75137c80-9237-11eb-868e-6c04894a83a3.png)\r\n",
        "createdAt": "2021-03-31T22:40:48Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "Try merging in master?",
        "createdAt": "2021-03-31T22:54:39Z",
        "author": {
          "login": "Forgind"
        }
      },
      {
        "body": "@Forgind Not sure what you mean? latest/master into this branch? \r\n\r\nIt was updated to latest main recently.",
        "createdAt": "2021-03-31T23:41:18Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "The PR I was thinking might have fixed it went in this morning. Doesn't look like you've picked it up yet. I've seen some issues with NuGet.Frameworks that looked very similar to that from the change to assembly loading.",
        "createdAt": "2021-04-01T00:09:49Z",
        "author": {
          "login": "Forgind"
        }
      },
      {
        "body": "It's worth a shot!",
        "createdAt": "2021-04-01T18:28:12Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "/azp run",
        "createdAt": "2021-04-01T23:18:54Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "<samp>\nAzure Pipelines successfully started running 1 pipeline(s).<br>\r\n\n</samp>",
        "createdAt": "2021-04-01T23:19:04Z",
        "author": {
          "login": "azure-pipelines"
        }
      },
      {
        "body": "Tried building from a VM with a clean VS install and running `eng\\cibuild_bootstrapped_msbuild.cmd` and no repro.",
        "createdAt": "2021-04-28T23:50:28Z",
        "author": {
          "login": "benvillalobos"
        }
      },
      {
        "body": "Can this get merged now?  The one issue I saw mentioned as blocking appears to have been merged - #6408.  This is blocking https://github.com/dotnet/msbuild/pull/6387.  Thanks",
        "createdAt": "2021-05-21T15:48:33Z",
        "author": {
          "login": "MichaelSimons"
        }
      },
      {
        "body": "@MichaelSimons Not yet but Soon\u2122. We have finally gotten unblocked on checking in changes to VS and are working through backlog. This is high on the priority list.",
        "createdAt": "2021-05-21T15:58:22Z",
        "author": {
          "login": "rainersigwald"
        }
      }
    ]
  },
  "reviewThreads": {
    "nodes": [
      {
        "comments": {
          "nodes": [
            {
              "body": "Self, is this actually a _product_ dependency?",
              "createdAt": "2021-05-03T22:27:58Z",
              "path": "eng/Version.Details.xml",
              "diffHunk": "@@ -14,4 +14,10 @@\n       <Sha>e9fd4dc7d74932c0d4b042251bc5a88bb5b3c437</Sha>\n     </Dependency>\n   </ToolsetDependencies>\n+  <ProductDependencies>\n+    <Dependency Name=\"Microsoft.Extensions.DependencyModel\" Version=\"6.0.0-preview.2.21154.6\">",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Shouldn't darc have been doing this for us? Are we missing a subscription?",
              "createdAt": "2021-05-03T22:28:27Z",
              "path": "eng/Versions.props",
              "diffHunk": "@@ -21,13 +21,17 @@\n          Can be removed after Arcade moves up. -->\n     <MicrosoftVSSDKBuildToolsVersion>16.7.13</MicrosoftVSSDKBuildToolsVersion>\n   </PropertyGroup>\n+  <!-- Production Dependencies -->\n+  <PropertyGroup>\n+    <MicrosoftExtensionsDependencyModelVersion>6.0.0-preview.2.21154.6</MicrosoftExtensionsDependencyModelVersion>\n+  </PropertyGroup>\n   <!-- Toolset Dependencies -->\n   <PropertyGroup>\n     <!-- DotNetCliVersion MUST match the dotnet version in global.json.\n          Otherwise, this version of dotnet will not be installed and the build will error out. -->\n-    <DotNetCliVersion>5.0.102</DotNetCliVersion>\n+    <DotNetCliVersion>6.0.100-preview.2.21155.3</DotNetCliVersion>\n     <MicrosoftNetCompilersToolsetVersion>3.9.0-2.20574.26</MicrosoftNetCompilersToolsetVersion>\n-    <NuGetBuildTasksVersion>5.9.1-rc.8</NuGetBuildTasksVersion>\n+    <NuGetBuildTasksVersion>5.10.0-preview.1.7148</NuGetBuildTasksVersion>",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "You're right: https://github.com/dotnet/msbuild/pull/6327 looks to be the last time this version updated automatically. \r\n\r\nI'm thinking it was either the master->main rename or the switch from nuget.client.trusted to nuget.client that broke this. ",
              "createdAt": "2021-05-03T23:49:49Z",
              "path": "eng/Versions.props",
              "diffHunk": "@@ -21,13 +21,17 @@\n          Can be removed after Arcade moves up. -->\n     <MicrosoftVSSDKBuildToolsVersion>16.7.13</MicrosoftVSSDKBuildToolsVersion>\n   </PropertyGroup>\n+  <!-- Production Dependencies -->\n+  <PropertyGroup>\n+    <MicrosoftExtensionsDependencyModelVersion>6.0.0-preview.2.21154.6</MicrosoftExtensionsDependencyModelVersion>\n+  </PropertyGroup>\n   <!-- Toolset Dependencies -->\n   <PropertyGroup>\n     <!-- DotNetCliVersion MUST match the dotnet version in global.json.\n          Otherwise, this version of dotnet will not be installed and the build will error out. -->\n-    <DotNetCliVersion>5.0.102</DotNetCliVersion>\n+    <DotNetCliVersion>6.0.100-preview.2.21155.3</DotNetCliVersion>\n     <MicrosoftNetCompilersToolsetVersion>3.9.0-2.20574.26</MicrosoftNetCompilersToolsetVersion>\n-    <NuGetBuildTasksVersion>5.9.1-rc.8</NuGetBuildTasksVersion>\n+    <NuGetBuildTasksVersion>5.10.0-preview.1.7148</NuGetBuildTasksVersion>",
              "author": {
                "login": "benvillalobos"
              }
            },
            {
              "body": "Just going to log my thought process here.\r\n\r\nLikely not due to the switch from nuget.client.trusted since we got a few PR's since then. It's more likely that it's darc.",
              "createdAt": "2021-05-03T23:55:55Z",
              "path": "eng/Versions.props",
              "diffHunk": "@@ -21,13 +21,17 @@\n          Can be removed after Arcade moves up. -->\n     <MicrosoftVSSDKBuildToolsVersion>16.7.13</MicrosoftVSSDKBuildToolsVersion>\n   </PropertyGroup>\n+  <!-- Production Dependencies -->\n+  <PropertyGroup>\n+    <MicrosoftExtensionsDependencyModelVersion>6.0.0-preview.2.21154.6</MicrosoftExtensionsDependencyModelVersion>\n+  </PropertyGroup>\n   <!-- Toolset Dependencies -->\n   <PropertyGroup>\n     <!-- DotNetCliVersion MUST match the dotnet version in global.json.\n          Otherwise, this version of dotnet will not be installed and the build will error out. -->\n-    <DotNetCliVersion>5.0.102</DotNetCliVersion>\n+    <DotNetCliVersion>6.0.100-preview.2.21155.3</DotNetCliVersion>\n     <MicrosoftNetCompilersToolsetVersion>3.9.0-2.20574.26</MicrosoftNetCompilersToolsetVersion>\n-    <NuGetBuildTasksVersion>5.9.1-rc.8</NuGetBuildTasksVersion>\n+    <NuGetBuildTasksVersion>5.10.0-preview.1.7148</NuGetBuildTasksVersion>",
              "author": {
                "login": "benvillalobos"
              }
            },
            {
              "body": "Looks like there's no sub for it.\r\n`darc get-subscriptions --channel \"VS 16.10\"`\r\n```\r\nhttps://github.com/dotnet/fsharp (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('main')\r\n  - Id: 1b3ed604-a240-43c5-f3e6-08d8e97c775d\r\n  - Update Frequency: EveryDay\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies: []\r\n  - Last Build: 20210427.5 (b6a352ab0a11a0584348dd77811af7eecaf9d072)\r\nhttps://github.com/dotnet/fsharp (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/5.0.3xx')\r\n  - Id: 8d76063a-5130-4369-8278-08d8e9754760\r\n  - Update Frequency: EveryDay\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210430.7 (e411df7595bbe379f07dd2bcbb6e4046eca9eb31)\r\nhttps://github.com/dotnet/fsharp (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/6.0.1xx-preview4')\r\n  - Id: fec82357-f505-450c-c78c-08d8ff796cf5\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210430.7 (e411df7595bbe379f07dd2bcbb6e4046eca9eb31)\r\nhttps://github.com/dotnet/msbuild (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('main')\r\n  - Id: 9b9c2fc1-dee5-447e-827b-08d8e9754760\r\n  - Update Frequency: EveryDay\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210428.2 (5b9216a75e98e19eba84e04a5f30bd35a68f317a)\r\nhttps://github.com/dotnet/msbuild (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/5.0.3xx')\r\n  - Id: 08d8569c-a921-4400-1fc7-08d8c8766580\r\n  - Update Frequency: EveryDay\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210428.2 (5b9216a75e98e19eba84e04a5f30bd35a68f317a)\r\nhttps://github.com/dotnet/msbuild (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/6.0.1xx-preview4')\r\n  - Id: f3da650c-3ec0-4a87-5a84-08d8ff79a3bc\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210503.2 (fa96a2a81e0fb8c028057fa204bbf386bfb36aec)\r\nhttps://github.com/dotnet/roslyn (VS 16.10) ==> 'https://github.com/dotnet/arcade' ('main')\r\n  - Id: 71f51b42-1554-444f-7918-08d8e262a02c\r\n  - Update Frequency: EveryWeek\r\n  - Enabled: True\r\n  - Batchable: True\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 20210501.8 (4c32f5e4e9c0828a94fd4d1c9c0994082c85aaf3)\r\nhttps://github.com/microsoft/vstest (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/5.0.3xx')\r\n  - Id: b4754456-bab5-48e6-093c-08d8ff7930ba\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies: []\r\n  - Last Build: 20210429-01 (1050e72d7a92a5fb5737aa6a464e8e43e7dc52f4)\r\nhttps://github.com/nuget/nuget.client (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('main')\r\n  - Id: fcb199f6-ff33-44a0-f3ef-08d8e97c775d\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies: []\r\n  - Last Build: 5.10.0.7228 (d2bb0de35242b04802c1a7856ebb7718f674565c)\r\nhttps://github.com/nuget/nuget.client (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/5.0.3xx')\r\n  - Id: 61b07feb-68a2-4b3c-64a4-08d8e9757c68\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies: []\r\n  - Last Build: 5.10.0.7228 (d2bb0de35242b04802c1a7856ebb7718f674565c)\r\nhttps://github.com/nuget/nuget.client (VS 16.10) ==> 'https://github.com/dotnet/sdk' ('release/6.0.1xx-preview4')\r\n  - Id: 5184e9dc-a7d8-43a0-c78a-08d8ff796cf5\r\n  - Update Frequency: EveryBuild\r\n  - Enabled: True\r\n  - Batchable: False\r\n  - Merge Policies:\r\n    Standard\r\n  - Last Build: 5.10.0.7240 (dca1d060f38e1e02f6bfca41e25f081f19fd534b)\r\n```",
              "createdAt": "2021-05-04T00:11:45Z",
              "path": "eng/Versions.props",
              "diffHunk": "@@ -21,13 +21,17 @@\n          Can be removed after Arcade moves up. -->\n     <MicrosoftVSSDKBuildToolsVersion>16.7.13</MicrosoftVSSDKBuildToolsVersion>\n   </PropertyGroup>\n+  <!-- Production Dependencies -->\n+  <PropertyGroup>\n+    <MicrosoftExtensionsDependencyModelVersion>6.0.0-preview.2.21154.6</MicrosoftExtensionsDependencyModelVersion>\n+  </PropertyGroup>\n   <!-- Toolset Dependencies -->\n   <PropertyGroup>\n     <!-- DotNetCliVersion MUST match the dotnet version in global.json.\n          Otherwise, this version of dotnet will not be installed and the build will error out. -->\n-    <DotNetCliVersion>5.0.102</DotNetCliVersion>\n+    <DotNetCliVersion>6.0.100-preview.2.21155.3</DotNetCliVersion>\n     <MicrosoftNetCompilersToolsetVersion>3.9.0-2.20574.26</MicrosoftNetCompilersToolsetVersion>\n-    <NuGetBuildTasksVersion>5.9.1-rc.8</NuGetBuildTasksVersion>\n+    <NuGetBuildTasksVersion>5.10.0-preview.1.7148</NuGetBuildTasksVersion>",
              "author": {
                "login": "benvillalobos"
              }
            },
            {
              "body": "Correctomundo! `darc add-subscription --channel \"VS 16.10\" --source-repo \"https://github.com/nuget/nuget.client\" --target-repo \"https://github.com/dotnet/msbuild\" --target-branch main --update-frequency \"everyWeek\" --trigger`\r\n\r\nSee https://github.com/dotnet/msbuild/pull/6405\r\n",
              "createdAt": "2021-05-04T00:13:37Z",
              "path": "eng/Versions.props",
              "diffHunk": "@@ -21,13 +21,17 @@\n          Can be removed after Arcade moves up. -->\n     <MicrosoftVSSDKBuildToolsVersion>16.7.13</MicrosoftVSSDKBuildToolsVersion>\n   </PropertyGroup>\n+  <!-- Production Dependencies -->\n+  <PropertyGroup>\n+    <MicrosoftExtensionsDependencyModelVersion>6.0.0-preview.2.21154.6</MicrosoftExtensionsDependencyModelVersion>\n+  </PropertyGroup>\n   <!-- Toolset Dependencies -->\n   <PropertyGroup>\n     <!-- DotNetCliVersion MUST match the dotnet version in global.json.\n          Otherwise, this version of dotnet will not be installed and the build will error out. -->\n-    <DotNetCliVersion>5.0.102</DotNetCliVersion>\n+    <DotNetCliVersion>6.0.100-preview.2.21155.3</DotNetCliVersion>\n     <MicrosoftNetCompilersToolsetVersion>3.9.0-2.20574.26</MicrosoftNetCompilersToolsetVersion>\n-    <NuGetBuildTasksVersion>5.9.1-rc.8</NuGetBuildTasksVersion>\n+    <NuGetBuildTasksVersion>5.10.0-preview.1.7148</NuGetBuildTasksVersion>",
              "author": {
                "login": "benvillalobos"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Something's up here; this shouldn't be a new file.",
              "createdAt": "2021-05-03T22:29:08Z",
              "path": "ref/Microsoft.Build/Microsoft.Build.cs",
              "diffHunk": "@@ -0,0 +1,2158 @@\n+// Copyright (c) Microsoft. All rights reserved.",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "IIRC the SDK defines something much like this. Can we use that instead?",
              "createdAt": "2021-05-03T22:29:46Z",
              "path": "src/Directory.BeforeCommon.targets",
              "diffHunk": "@@ -122,9 +122,10 @@\n     <DefineConstants>$(DefineConstants);FEATURE_RUNTIMEINFORMATION</DefineConstants>\n     <DefineConstants>$(DefineConstants);USE_MSBUILD_DLL_EXTN</DefineConstants>\n     <DefineConstants>$(DefineConstants);WORKAROUND_COREFX_19110</DefineConstants>\n+    <DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net6.0'))\">$(DefineConstants);NET6_PLUS</DefineConstants>",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "running `rg -Fi \"<defineconstants\" -tmsbuild` in the sdk doesn't look promising. Sounds like something we can merge into the SDK to allow compiler directives in code for breaking changes between sdk versions. Something like:\r\n```xml\r\n<DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'netcoreapp3.1'))\">$(DefineConstants);NET31_PLUS</DefineConstants>\r\n<DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net5.0'))\">$(DefineConstants);NET5_PLUS</DefineConstants>\r\n<DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net6.0'))\">$(DefineConstants);NET6_PLUS</DefineConstants>\r\n```\r\n@dsplaisted does this sound reasonable?\r\n\r\nQuestions answered with some greppin'\r\n1. Where is DefineConstants even consumed?\r\n   - Looks like it's passed as an argument to the compiler. https://github.com/dotnet/msbuild/blob/main/src/Tasks/Microsoft.CSharp.CurrentVersion.targets#L249\r\n\r\n",
              "createdAt": "2021-05-03T23:41:11Z",
              "path": "src/Directory.BeforeCommon.targets",
              "diffHunk": "@@ -122,9 +122,10 @@\n     <DefineConstants>$(DefineConstants);FEATURE_RUNTIMEINFORMATION</DefineConstants>\n     <DefineConstants>$(DefineConstants);USE_MSBUILD_DLL_EXTN</DefineConstants>\n     <DefineConstants>$(DefineConstants);WORKAROUND_COREFX_19110</DefineConstants>\n+    <DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net6.0'))\">$(DefineConstants);NET6_PLUS</DefineConstants>",
              "author": {
                "login": "benvillalobos"
              }
            },
            {
              "body": "https://github.com/dotnet/sdk/pull/14798 added it; in this case it's `NET6_0_OR_GREATER`.",
              "createdAt": "2021-05-04T14:17:32Z",
              "path": "src/Directory.BeforeCommon.targets",
              "diffHunk": "@@ -122,9 +122,10 @@\n     <DefineConstants>$(DefineConstants);FEATURE_RUNTIMEINFORMATION</DefineConstants>\n     <DefineConstants>$(DefineConstants);USE_MSBUILD_DLL_EXTN</DefineConstants>\n     <DefineConstants>$(DefineConstants);WORKAROUND_COREFX_19110</DefineConstants>\n+    <DefineConstants Condition=\"$([MSBuild]::IsTargetFrameworkCompatible('$(TargetFramework)', 'net6.0'))\">$(DefineConstants);NET6_PLUS</DefineConstants>",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Do we own this/should we be specifying its version? Do we have a plan for keeping it up-to-date with the version specified in Versions.props?",
              "createdAt": "2021-05-10T17:29:15Z",
              "path": "eng/Version.Details.xml",
              "diffHunk": "@@ -1,14 +1,18 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <Dependencies>\n   <ToolsetDependencies>\n-    <Dependency Name=\"Microsoft.DotNet.Arcade.Sdk\" Version=\"5.0.0-beta.21226.1\">\n+    <Dependency Name=\"Microsoft.DotNet.Arcade.Sdk\" Version=\"6.0.0-beta.21227.1\">\n       <Uri>https://github.com/dotnet/arcade</Uri>\n-      <Sha>c58c5dd7f2e9e106368caafb0d4a7a29f4b2e1e9</Sha>\n+      <Sha>cca78ffe3eefdc217e43c2421f2f23355f16da2d</Sha>\n     </Dependency>\n     <Dependency Name=\"NuGet.Build.Tasks\" Version=\"5.10.0-rc.7240\">\n       <Uri>https://github.com/nuget/nuget.client</Uri>\n       <Sha>dca1d060f38e1e02f6bfca41e25f081f19fd534b</Sha>\n     </Dependency>\n+    <Dependency Name=\"Microsoft.Extensions.DependencyModel\" Version=\"6.0.0-preview.2.21154.6\">",
              "author": {
                "login": "Forgind"
              }
            },
            {
              "body": "yes: darc subscription. Can't set it up until this merges though.",
              "createdAt": "2021-05-10T17:41:04Z",
              "path": "eng/Version.Details.xml",
              "diffHunk": "@@ -1,14 +1,18 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <Dependencies>\n   <ToolsetDependencies>\n-    <Dependency Name=\"Microsoft.DotNet.Arcade.Sdk\" Version=\"5.0.0-beta.21226.1\">\n+    <Dependency Name=\"Microsoft.DotNet.Arcade.Sdk\" Version=\"6.0.0-beta.21227.1\">\n       <Uri>https://github.com/dotnet/arcade</Uri>\n-      <Sha>c58c5dd7f2e9e106368caafb0d4a7a29f4b2e1e9</Sha>\n+      <Sha>cca78ffe3eefdc217e43c2421f2f23355f16da2d</Sha>\n     </Dependency>\n     <Dependency Name=\"NuGet.Build.Tasks\" Version=\"5.10.0-rc.7240\">\n       <Uri>https://github.com/nuget/nuget.client</Uri>\n       <Sha>dca1d060f38e1e02f6bfca41e25f081f19fd534b</Sha>\n     </Dependency>\n+    <Dependency Name=\"Microsoft.Extensions.DependencyModel\" Version=\"6.0.0-preview.2.21154.6\">",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      }
    ]
  }
}