{
  "number": 11654,
  "title": "15.9 MicroBuild template with SBOM",
  "body": "Change the build pipeline using MicroBuild template for VS15.9.\r\n\r\nbuilding on https://github.com/dotnet/msbuild/pull/11629 adds SBOM embedding\r\n\r\nthe passing internal run: https://devdiv.visualstudio.com/DevDiv/_build/results?buildId=11305243&view=results\r\n\r\nThe commented tests: src\\Utilities.UnitTests\\TrackedDependencies\\FileTrackerTests.cs could find the namespace Microsoft.CodeAnalysis.BuildTasks.\r\n\r\nThe rest of the test projects were changed due to compatibility errors on the build.\r\n\r\n**NO functional changes were introduced**\r\n",
  "state": "CLOSED",
  "createdAt": "2025-04-01T10:59:38Z",
  "updatedAt": "2025-05-12T13:58:09Z",
  "closedAt": "2025-05-12T13:58:09Z",
  "mergedAt": null,
  "additions": 729,
  "deletions": 2734,
  "changedFiles": 14,
  "headRefName": "MicroBuildWithSBOM",
  "isDraft": false,
  "author": {
    "login": "JanProvaznik"
  },
  "milestone": null,
  "assignees": {
    "nodes": [
      {
        "login": "maridematte"
      }
    ]
  },
  "labels": [],
  "commits": {
    "nodes": [
      {
        "commit": {
          "oid": "9a4eb5675b061c9b6808b07e24938896545e45a6",
          "message": "Change the pipeline with MicroBuildTemplate",
          "committedDate": "2025-03-13T08:43:23Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "e0b38531345ca4f769aaa996678c6fdfa125a56e",
          "message": "Mitigate LASTEXITCODE issue",
          "committedDate": "2025-03-13T08:56:56Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "e736b11d52862469b43328475f96fc9b40578568",
          "message": "change xunit version",
          "committedDate": "2025-03-13T10:35:41Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "6bddf6ce53d7da11731b9f5cfa89dcf1061add4a",
          "message": "add missed xunit refs",
          "committedDate": "2025-03-13T10:51:36Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "a14c3c72d8e2cca029dcaa978db215c067536988",
          "message": "update more xunit packages",
          "committedDate": "2025-03-13T11:10:18Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f4f87b8d3c6a003d537881c174631b891b013c87",
          "message": "xunit hell",
          "committedDate": "2025-03-13T13:51:51Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "7835f704b9e0791af5d39c2df77283a46837131c",
          "message": "merge",
          "committedDate": "2025-03-13T13:53:18Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "a2678a9cae22df562c6cdd7f54d7bf812f3aab1a",
          "message": "resolve ref conflict in NetCore.Extensions",
          "committedDate": "2025-03-13T14:45:51Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "05514bc8519a7bfc3eb6b33fecc9785c2335e2b3",
          "message": "update plugins",
          "committedDate": "2025-03-13T14:54:01Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f00cd262aed85bc583fecf25a33b3f622b28e2bd",
          "message": "play with the package more",
          "committedDate": "2025-03-13T15:42:46Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "df9fd1aa34a5d45a3446a85f5ec6bfbdc7647f26",
          "message": "add more xunit",
          "committedDate": "2025-03-13T15:59:25Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "aaff92d9e88d71b8f7c05a775c88e8d2ed68a613",
          "message": "change packageref condition",
          "committedDate": "2025-03-13T16:31:59Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "4a8001c8ab404ef5130ca2b4aea4e9dd289d43e9",
          "message": "version change",
          "committedDate": "2025-03-13T16:51:58Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "bb6821d1e3579d857e7218e1e53df8ec7bdbe3c3",
          "message": "these versions are killing me",
          "committedDate": "2025-03-13T17:15:41Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "89360eceeb5c7649ff120bd6c2b96dd1bb97e227",
          "message": "update Authenticode to Microsoft400",
          "committedDate": "2025-03-13T17:44:17Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "037ed1f578478b0e3d80f294c620ce3104fd63b9",
          "message": "update certificate name",
          "committedDate": "2025-03-13T20:53:02Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "01b316cc82d56a194aed011db8277ff14a62edf7",
          "message": "return RoslynTools.RepoToolset 1.0.0-beta2-62901-01 to avoid GetVsixVersion",
          "committedDate": "2025-03-14T08:11:49Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "598a282bcaa36b410e52245729a7f4f16a5f26de",
          "message": "add dummy GetVsixVersion",
          "committedDate": "2025-03-14T09:18:06Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "44ddc195e6666081e1669e8c734366c886493c32",
          "message": "add UpdateRestoreSources target",
          "committedDate": "2025-03-14T10:02:30Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "d38eec1e51bec307666949782fdcf5b4b4deec7c",
          "message": "move UpdateRestoreSources to Version.props",
          "committedDate": "2025-03-14T10:21:34Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f7ec90dcde0597ae51c761019c259da525fe34b3",
          "message": "one more time with GetVsixVersion",
          "committedDate": "2025-03-14T10:38:03Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "c90ee77b46e1ee834c30ec6b718b3ada625fc717",
          "message": "disable Publish Symbols to Artifact Services",
          "committedDate": "2025-03-14T11:51:33Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "0e5a929a92b57bb6482362be04818a6fd069977a",
          "message": "Set options for VSTS Drop",
          "committedDate": "2025-03-17T08:41:16Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f8f5743d88fffcf4f2c7535d62d3a6749f077310",
          "message": "Set access token for publish symbols",
          "committedDate": "2025-03-17T10:02:16Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "3eacfa747e52b1156e066999210f9ca249e83783",
          "message": "Publish symbols",
          "committedDate": "2025-03-17T10:32:52Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "38b6e6e3270845cb3616d2b6e4753477ecc9ae51",
          "message": "Adjust the path to packages in SignTool data",
          "committedDate": "2025-03-20T06:56:22Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "9e19e35631cb70864aafdb68da86d41535dfa6ab",
          "message": "Generate SBOM for VS insertion",
          "committedDate": "2025-03-20T09:40:23Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "962a9ea50d2d4a7a5c5f3e446323193e54028105",
          "message": "Remove GenerateSbom",
          "committedDate": "2025-03-20T10:02:08Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "85700b43d7b6ead915a4bf0047e3ae483b91cec8",
          "message": "Enable SBOM plugin",
          "committedDate": "2025-03-24T02:16:24Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "43936d0b4eed1e98d202e99116257500a4d735bd",
          "message": "Try task MicroBuildSbomPlugin instead",
          "committedDate": "2025-03-24T06:26:50Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "ba6f4719b8cf454e5b28ade522a630d1930f4cc6",
          "message": "Try to generate SBOM",
          "committedDate": "2025-03-24T09:25:16Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "07a3232284b2ebc315a6598a25e951d4561969d1",
          "message": "Remove installing SBOM plugin",
          "committedDate": "2025-03-24T10:23:44Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "e221679e5c099353544bc876bffe5ab5cc674d19",
          "message": "Place SBOM files in VSSetup Insertion folder",
          "committedDate": "2025-03-24T11:03:47Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "5854541de2fc8ab8a8945d1af0343bf7fda1c37e",
          "message": "Try the package Microsoft.VisualStudio.Internal.MicroBuild.VisualStudio",
          "committedDate": "2025-03-26T08:57:02Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "13ff4e0cfa49abe69ef7e4eb4c3ffa4e3538bcad",
          "message": "Change the build pipeline using MicroBuild template",
          "committedDate": "2025-03-26T11:35:53Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "8e24179feb72e04fbcd28e7485baff57e323287b",
          "message": "Resolve the issues of xUnit packages",
          "committedDate": "2025-03-26T11:37:20Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "351e63787b2c1966a29f9d3208d6cab9d9839358",
          "message": "Comment out the test that could find the namespace",
          "committedDate": "2025-03-26T11:39:59Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "787351dd9060d909c07bd24329e81f6f6061ad8d",
          "message": "Revert back",
          "committedDate": "2025-03-26T11:48:43Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "5b4c9f979ce0420fd1fd92ac1cf66c66ed72f739",
          "message": "Update the images for PR pipeline",
          "committedDate": "2025-03-27T01:55:08Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "46a716ba3948a88637dc39aac4b94ab48b360d06",
          "message": "Change the VS path for running on Windows",
          "committedDate": "2025-03-27T08:35:48Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "0a520103b87c63cdb4d9a99d251ff1e571e38f49",
          "message": "Use public nuget feeds instead",
          "committedDate": "2025-03-27T08:36:56Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "194d43b13f9518287ba517fa99223201abe0e9ce",
          "message": "Revert 'Resolve the issues of xUnit packages'",
          "committedDate": "2025-03-27T09:55:14Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "b4c6d98e435ff73b1cbaa0c38b5a9605eee6164b",
          "message": "add drop name to upload in template",
          "committedDate": "2025-03-27T09:59:08Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "8d9462f2297a7d91bb67e1b8129eebfc2c4e4cb4",
          "message": "manually embed",
          "committedDate": "2025-03-28T12:31:32Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "7455ddd6df07cc08379076723495e5ff0e010b82",
          "message": "format",
          "committedDate": "2025-03-28T12:35:06Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "dbba1e7a422669a172a1ea0e941bf965a88c79c8",
          "message": "remove nuget dependency",
          "committedDate": "2025-03-28T13:33:31Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "01e89cbaf47f3e1535fa6d872220e49dd6ab824a",
          "message": "investigate",
          "committedDate": "2025-03-28T15:28:23Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "7f36acb0a91c9427627c722b755d0dcb78d13006",
          "message": "fix republishing",
          "committedDate": "2025-03-31T11:11:58Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "1c2efcd1de85d19f899aaf4582e11c4aea0aa125",
          "message": "fix vsix link in vsman",
          "committedDate": "2025-03-31T13:27:28Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "92c56dded08e498859631357b33b979e53efd21c",
          "message": "fix adding url",
          "committedDate": "2025-03-31T15:10:58Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "3298416f34743427cd75502f6e543aa101d34e44",
          "message": ";",
          "committedDate": "2025-03-31T16:19:18Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "c9b5f74c4bfdecb6dc0304f6fc44158eea9ce0fd",
          "message": "Merge branch 'pr-11629' into exp/janpro/15.9",
          "committedDate": "2025-04-01T10:41:57Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "4d31abba99d1998b039b66fadd58f34e84d4c43d",
          "message": "remove doubled steps in ci after merge",
          "committedDate": "2025-04-02T10:42:25Z",
          "author": {
            "name": "Jan Provazn\u00edk",
            "email": "janprovaznik@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "2eabf58343218c0cf6a664bff7dc229b0a024e56",
          "message": "disable PdbGit\n\nDisable PdbGit\r\n(backport https://devdiv.visualstudio.com/DevDiv/_git/DotNet-msbuild-Trusted/commit/6cd4ff89f498211440c4e05e78763c45db596557?_a=compare&path=/src/MSBuildTaskHost/MSBuildTaskHost.csproj&tab=details)\r\n\r\nIt looks like it wasn't working before, with the warning\r\n\r\n.nuget\\packages\\pdbgit\\3.0.41\\tools\\PdbGit.targets(9,5): warning : No source files found that are tracked in a git repo. [E:\\A\\_work\\102\\s\\src\\MSBuildTaskHost\\MSBuildTaskHost.csproj]\r\nAnd now it's producing many warnings like\r\n\r\n\r\nC:\\Users\\raines\\.nuget\\packages\\pdbgit\\3.0.41\\tools\\PdbGit.targets(9,5): warning : File \"s:\\msbuild2\\artifacts\\obj\\msbuildtaskhost\\release\\net35\\msbuildtaskhost.version.cs\" missing or changed since the PDB was compiled. [s:\\msbuild2\\src\\MSBuildTaskHost\\MSBuildTaskHost.csproj]\r\nC:\\Users\\raines\\.nuget\\packages\\pdbgit\\3.0.41\\tools\\PdbGit.targets(9,5): warning : File \"s:\\msbuild2\\src\\framework\\buildengineresult.cs\" missing or changed since the PDB was compiled. [s:\\msbuild2\\src\\MSBuildTaskHost\\MSBuildTaskHost.csproj]\r\nC:\\Users\\raines\\.nuget\\packages\\pdbgit\\3.0.41\\tools\\PdbGit.targets(9,5): warning : File \"s:\\msbuild2\\src\\framework\\runinstaattribute.cs\" missing or changed since the PDB was compiled. [s:\\msbuild2\\src\\MSBuildTaskHost\\MSBuildTaskHost.csproj]",
          "committedDate": "2025-04-07T14:38:53Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "95473390+YuliiaKovalova@users.noreply.github.com"
          }
        }
      },
      {
        "commit": {
          "oid": "999302da999b9adc1f80f6e9f6e7245263aec883",
          "message": "Revert the changes that resolve the issue of xunit packages",
          "committedDate": "2025-04-10T07:40:47Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "165e3c732e6467c100c74be7c7bf6f4cc6c55010",
          "message": "Remove the unnecessary target that is used for debugging Nerdbank.GitVersioning",
          "committedDate": "2025-04-10T08:55:53Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "dfc2358e6ef421667e01bf777ee11d7b226151db",
          "message": "Add comments",
          "committedDate": "2025-04-10T09:00:22Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "03350fcd161625b66381bb1c956d46e36462a94c",
          "message": "Remove the test because the namespace Microsoft.CodeAnalysis.BuildTasks is not able to find",
          "committedDate": "2025-04-10T09:43:45Z",
          "author": {
            "name": "Gang Wang",
            "email": "v-gaw@microsoft.com"
          }
        }
      },
      {
        "commit": {
          "oid": "f16e0e34ca900203caf230adbc5ea2d6f62c568c",
          "message": "fix binlog generation",
          "committedDate": "2025-04-22T09:47:02Z",
          "author": {
            "name": "YuliiaKovalova",
            "email": "ykovalova@microsoft.com"
          }
        }
      }
    ]
  },
  "comments": {
    "nodes": [
      {
        "body": "Hello! I noticed that you're targeting one of our servicing branches. Please consider updating the version.\n<!-- Policy app identification https://img.shields.io/static/v1?label=PullRequestIssueManagement. -->",
        "createdAt": "2025-04-01T11:00:11Z",
        "author": {
          "login": "dotnet-policy-service"
        }
      }
    ]
  },
  "reviewThreads": {
    "nodes": [
      {
        "comments": {
          "nodes": [
            {
              "body": "fyi: this target was added in the newer version of the RoslynTools.RepoToolset package. For current branch we should override it to avoid issues with the execution.",
              "createdAt": "2025-04-01T11:20:36Z",
              "path": "build/Versions.props",
              "diffHunk": "@@ -69,4 +66,6 @@\n     <ShouldlyVersion>3.0.0</ShouldlyVersion>\n   </PropertyGroup>\n \n-</Project>\n+  <Target Name=\"GetVsixVersion\" />",
              "author": {
                "login": "YuliiaKovalova"
              }
            },
            {
              "body": "Comment in code :)",
              "createdAt": "2025-04-07T14:24:18Z",
              "path": "build/Versions.props",
              "diffHunk": "@@ -69,4 +66,6 @@\n     <ShouldlyVersion>3.0.0</ShouldlyVersion>\n   </PropertyGroup>\n \n-</Project>\n+  <Target Name=\"GetVsixVersion\" />",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "fyi: the previous feeds are already dead",
              "createdAt": "2025-04-01T11:20:56Z",
              "path": "build/Versions.props",
              "diffHunk": "@@ -9,10 +9,7 @@\n     <RestoreSources>$(DotNetRestoreSources)</RestoreSources>\n     <RestoreSources  Condition=\"'$(DotNetBuildOffline)' != 'true'\">\n         $(RestoreSources);\n-        https://dotnet.myget.org/F/roslyn/api/v3/index.json;\n-        https://dotnet.myget.org/F/nuget-build/api/v3/index.json;\n-        https://dotnet.myget.org/F/roslyn-tools/api/v3/index.json;\n-        https://dotnet.myget.org/F/dotnet-buildtools/api/v3/index.json\n+        https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json;https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-public/nuget/v3/index.json",
              "author": {
                "login": "YuliiaKovalova"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "fyi: it helps to override the dead feeds from RoslynTools package",
              "createdAt": "2025-04-01T11:23:44Z",
              "path": "Directory.Build.props",
              "diffHunk": "@@ -3,6 +3,7 @@\n   <PropertyGroup>\n     <Configuration Condition=\"'$(Configuration)' == ''\">Debug</Configuration>\n     <Configurations>Debug;Release;Debug-MONO;Release-MONO</Configurations>\n+    <RestoreSources>https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json;https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-public/nuget/v3/index.json</RestoreSources>",
              "author": {
                "login": "YuliiaKovalova"
              }
            },
            {
              "body": "Comment in the code :)",
              "createdAt": "2025-04-07T14:23:00Z",
              "path": "Directory.Build.props",
              "diffHunk": "@@ -3,6 +3,7 @@\n   <PropertyGroup>\n     <Configuration Condition=\"'$(Configuration)' == ''\">Debug</Configuration>\n     <Configurations>Debug;Release;Debug-MONO;Release-MONO</Configurations>\n+    <RestoreSources>https://pkgs.dev.azure.com/dnceng/public/_packaging/myget-legacy/nuget/v3/index.json;https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-public/nuget/v3/index.json</RestoreSources>",
              "author": {
                "login": "rainersigwald"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Doesn't GitVersioning do this automatically?",
              "createdAt": "2025-04-07T14:23:42Z",
              "path": "build/SetMicrobuildVersion/SetMicrobuildVersion.csproj",
              "diffHunk": "@@ -1,22 +1,23 @@\n-<Project DefaultTargets=\"GetBuildVersion\">\n-\n-  <Import Project=\"..\\Versions.props\" />\n+<Project Sdk=\"Microsoft.NET.Sdk\" DefaultTargets=\"GetBuildVersion\">\n+  <Import Project=\"..\\Versions.props\"/>\n \n   <PropertyGroup>\n+    <TargetFramework>net46</TargetFramework>\n     <ImportDirectoryBuildProps>false</ImportDirectoryBuildProps>\n     <ImportDirectoryBuildTargets>false</ImportDirectoryBuildTargets>\n-  </PropertyGroup>\n \n-   <Import Project=\"Sdk.props\" Sdk=\"RoslynTools.RepoToolset\" />\n-\n-   <PropertyGroup>\n-    <TargetFramework>net46</TargetFramework>\n-    <RestoreSources>$(RestoreSources);https://api.nuget.org/v3/index.json</RestoreSources>\n   </PropertyGroup>\n \n-   <ItemGroup>\n-      <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n-   </ItemGroup>\n+  <ItemGroup>\n+    <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n+  </ItemGroup>\n \n-   <Import Project=\"Sdk.targets\" Sdk=\"RoslynTools.RepoToolset\" />\n+  <!-- Add a target that will output the version information -->",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "maybe it stayed here after debugging",
              "createdAt": "2025-04-09T14:27:08Z",
              "path": "build/SetMicrobuildVersion/SetMicrobuildVersion.csproj",
              "diffHunk": "@@ -1,22 +1,23 @@\n-<Project DefaultTargets=\"GetBuildVersion\">\n-\n-  <Import Project=\"..\\Versions.props\" />\n+<Project Sdk=\"Microsoft.NET.Sdk\" DefaultTargets=\"GetBuildVersion\">\n+  <Import Project=\"..\\Versions.props\"/>\n \n   <PropertyGroup>\n+    <TargetFramework>net46</TargetFramework>\n     <ImportDirectoryBuildProps>false</ImportDirectoryBuildProps>\n     <ImportDirectoryBuildTargets>false</ImportDirectoryBuildTargets>\n-  </PropertyGroup>\n \n-   <Import Project=\"Sdk.props\" Sdk=\"RoslynTools.RepoToolset\" />\n-\n-   <PropertyGroup>\n-    <TargetFramework>net46</TargetFramework>\n-    <RestoreSources>$(RestoreSources);https://api.nuget.org/v3/index.json</RestoreSources>\n   </PropertyGroup>\n \n-   <ItemGroup>\n-      <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n-   </ItemGroup>\n+  <ItemGroup>\n+    <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n+  </ItemGroup>\n \n-   <Import Project=\"Sdk.targets\" Sdk=\"RoslynTools.RepoToolset\" />\n+  <!-- Add a target that will output the version information -->",
              "author": {
                "login": "YuliiaKovalova"
              }
            },
            {
              "body": "Removed.",
              "createdAt": "2025-04-10T09:04:06Z",
              "path": "build/SetMicrobuildVersion/SetMicrobuildVersion.csproj",
              "diffHunk": "@@ -1,22 +1,23 @@\n-<Project DefaultTargets=\"GetBuildVersion\">\n-\n-  <Import Project=\"..\\Versions.props\" />\n+<Project Sdk=\"Microsoft.NET.Sdk\" DefaultTargets=\"GetBuildVersion\">\n+  <Import Project=\"..\\Versions.props\"/>\n \n   <PropertyGroup>\n+    <TargetFramework>net46</TargetFramework>\n     <ImportDirectoryBuildProps>false</ImportDirectoryBuildProps>\n     <ImportDirectoryBuildTargets>false</ImportDirectoryBuildTargets>\n-  </PropertyGroup>\n \n-   <Import Project=\"Sdk.props\" Sdk=\"RoslynTools.RepoToolset\" />\n-\n-   <PropertyGroup>\n-    <TargetFramework>net46</TargetFramework>\n-    <RestoreSources>$(RestoreSources);https://api.nuget.org/v3/index.json</RestoreSources>\n   </PropertyGroup>\n \n-   <ItemGroup>\n-      <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n-   </ItemGroup>\n+  <ItemGroup>\n+    <PackageReference Include=\"Nerdbank.GitVersioning\" Version=\"$(GitVersioningVersion)\" PrivateAssets=\"All\" />\n+  </ItemGroup>\n \n-   <Import Project=\"Sdk.targets\" Sdk=\"RoslynTools.RepoToolset\" />\n+  <!-- Add a target that will output the version information -->",
              "author": {
                "login": "GangWang01"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "Could we not update the centrally-defined XUnitVersion property instead?",
              "createdAt": "2025-04-07T14:26:12Z",
              "path": "src/Directory.Build.targets",
              "diffHunk": "@@ -45,8 +45,8 @@\n     <!-- MSBuild isn't xunit analyzer clean, so remove the reference to the xunit package added by the repo toolset and\n          replace it with references to xunit.core and xunit.assert. -->\n     <PackageReference Remove=\"xunit\" />\n-    <PackageReference Include=\"xunit.core\" Version=\"$(XUnitVersion)\" />",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "For some reason it didn't work @GangWang01 , could you please take a look?",
              "createdAt": "2025-04-09T14:26:30Z",
              "path": "src/Directory.Build.targets",
              "diffHunk": "@@ -45,8 +45,8 @@\n     <!-- MSBuild isn't xunit analyzer clean, so remove the reference to the xunit package added by the repo toolset and\n          replace it with references to xunit.core and xunit.assert. -->\n     <PackageReference Remove=\"xunit\" />\n-    <PackageReference Include=\"xunit.core\" Version=\"$(XUnitVersion)\" />",
              "author": {
                "login": "YuliiaKovalova"
              }
            },
            {
              "body": "With the public feeds I configured, the issue resulted from xUnit packages with different versions disappeared. See https://devdiv.visualstudio.com/DevDiv/_build/results?buildId=11373747&view=results. So I reverted the changes that resolve the issue of xUnit packages.",
              "createdAt": "2025-04-10T07:49:19Z",
              "path": "src/Directory.Build.targets",
              "diffHunk": "@@ -45,8 +45,8 @@\n     <!-- MSBuild isn't xunit analyzer clean, so remove the reference to the xunit package added by the repo toolset and\n          replace it with references to xunit.core and xunit.assert. -->\n     <PackageReference Remove=\"xunit\" />\n-    <PackageReference Include=\"xunit.core\" Version=\"$(XUnitVersion)\" />",
              "author": {
                "login": "GangWang01"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "What's the story on this one? Should we delete the file or remove it from the csproj instead, if it is totally bogus?",
              "createdAt": "2025-04-07T14:27:16Z",
              "path": "src/Utilities.UnitTests/TrackedDependencies/FileTrackerTests.cs",
              "diffHunk": "",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "Removed this test file because the namespace Microsoft.CodeAnalysis.BuildTasks used by it is not able to found while no change to the dependencies.",
              "createdAt": "2025-04-10T09:45:24Z",
              "path": "src/Utilities.UnitTests/TrackedDependencies/FileTrackerTests.cs",
              "diffHunk": "",
              "author": {
                "login": "GangWang01"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "These don't seem to be working; what's the plan?",
              "createdAt": "2025-04-07T14:27:36Z",
              "path": ".vsts-dotnet-ci.yml",
              "diffHunk": "@@ -5,10 +5,10 @@ pr:\n - vs15.9\n \n jobs:\n-- job: innerloop_OSX1013_CoreCLR\n-  displayName: OSX10.13 Build for CoreCLR\n+- job: innerloop_OSX_CoreCLR",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "it's a pipeline that works only in Github. I think we agreed not to touch it.",
              "createdAt": "2025-04-09T14:25:46Z",
              "path": ".vsts-dotnet-ci.yml",
              "diffHunk": "@@ -5,10 +5,10 @@ pr:\n - vs15.9\n \n jobs:\n-- job: innerloop_OSX1013_CoreCLR\n-  displayName: OSX10.13 Build for CoreCLR\n+- job: innerloop_OSX_CoreCLR",
              "author": {
                "login": "YuliiaKovalova"
              }
            }
          ]
        }
      },
      {
        "comments": {
          "nodes": [
            {
              "body": "This script is terrifying, is it copied from somewhere?",
              "createdAt": "2025-04-07T14:55:55Z",
              "path": ".vsts-dotnet.yml",
              "diffHunk": "@@ -1,135 +1,267 @@\n-queue:\n-  name: VSEng-MicroBuildVS2017\n-  timeoutInMinutes: 360\n-trigger: none\n variables:\n-  BuildConfiguration: 'Release'\n-  TeamName: MSBuild\n-steps:\n-- task: ms-vseng.MicroBuildTasks.30666190-6959-11e5-9f96-f56098202fef.MicroBuildSigningPlugin@1\n-  displayName: Install Signing Plugin\n-  inputs:\n-    signType: '$(SignType)'\n-\n-- task: ms-vseng.MicroBuildTasks.a9799c06-320f-4175-8756-31cd731bd5f3.MicroBuildIBCMergePlugin@0\n-  displayName: Install IBCMerge Plugin\n-\n-- task: CmdLine@1\n-  displayName: save build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Bogus build to have nerdbank.GitVersioning set the version for the swix plugin\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & msbuild /restore $(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj\"'\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Install Swix Plugin\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-\n-- task: CmdLine@1\n-  displayName: restore build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Run build.cmd\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n-\n-- task: CmdLine@1\n-  displayName: Print bin contents\n-  inputs:\n-    filename: dir\n-    arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n-  condition: always()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: logs'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\log'\n-    ArtifactName: logs\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: packages'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\packages'\n-    ArtifactName: packages\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: vsix'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-    ArtifactName: vsix\n-  condition: succeededOrFailed()\n-\n-- task: CopyFiles@2\n-  displayName: Collect Symbols\n-  inputs:\n-    Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n-    TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n-    CleanTargetFolder: true\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: symbols'\n-  inputs:\n-    PathtoPublish: '$(Build.ArtifactStagingDirectory)/symbols'\n-    ArtifactName: symbols\n-  condition: succeededOrFailed()\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Reinstall Swix Plugin (to pick up new build number)\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-  enabled: false\n-\n-- task: ms-vseng.MicroBuildTasks.4305a8de-ba66-4d8b-b2d1-0dc4ecbbf5e8.MicroBuildUploadVstsDropFolder@1\n-  displayName: Upload VSTS Drop\n-  inputs:\n-    DropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-\n-- task: PublishSymbols@1\n-  displayName: Index Sources\n-  inputs:\n-    SearchPattern: '**/*.pdb'\n-    SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n-\n-- task: ms-vscs-artifact.build-tasks.artifactSymbolTask-1.artifactSymbolTask@0\n-  displayName: Publish Symbols to Artifact Services\n-  inputs:\n-    symbolServiceURI: 'https://microsoft.artifacts.visualstudio.com/DefaultCollection'\n-    sourcePath: '$(Build.ArtifactStagingDirectory)\\symbols'\n-    usePat: false\n-\n-- task: PowerShell@1\n-  displayName: Microbuild health checks\n-  inputs:\n-    scriptName: 'build/MicrobuildTest.ps1'\n-  enabled: false\n-  continueOnError: true\n-\n-- task: ms-vseng.MicroBuildTasks.521a94ea-9e68-468a-8167-6dcf361ea776.MicroBuildCleanup@1\n-  displayName: Execute cleanup tasks\n+- name: BuildConfiguration\n+  value: 'Release'\n+- name: TeamName\n+  value: MSBuild\n \n+resources:\n+  repositories:\n+  - repository: MicroBuildTemplate\n+    type: git\n+    name: 1ESPipelineTemplates/MicroBuildTemplate\n+    ref: refs/tags/release\n+\n+extends:\n+  template: azure-pipelines/MicroBuild.1ES.Official.yml@MicroBuildTemplate\n+  parameters:\n+    pool:\n+      name: VSEngSS-MicroBuild2017-1ES\n+    stages:\n+    - stage: stage\n+      jobs:\n+      - job: buildjob \n+        templateContext:\n+          mb:\n+            signing:\n+              enabled: true\n+              signType: $(SignType)\n+            sbom:\n+              enabled: true\n+          outputs:\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: logs'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\log'\n+            artifactName: logs\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: packages'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\packages'\n+            artifactName: packages\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: vsix_pre_sbom'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+            artifactName: vsix_pre_sbom\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: symbols'\n+            targetPath: '$(Build.ArtifactStagingDirectory)/symbols'\n+            artifactName: symbols\n+            condition: succeededOrFailed()\n+          # - output: microBuildVstsDrop\n+          #   displayName: 'Upload VSTS Drop'\n+          #   dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          #   dropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+          #   dropRetentionDays: 90\n+          #   accessToken: '$(System.AccessToken)'\n+          #   dropServiceUri: 'https://devdiv.artifacts.visualstudio.com'\n+          #   vsDropServiceUri: 'https://vsdrop.corp.microsoft.com/file/v1'\n+        steps:        \n+        - task: MicroBuildIBCMergePlugin@1\n+          displayName: Install IBCMerge Plugin\n+\n+        - task: CmdLine@1\n+          displayName: save build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+\n+        - task: MSBuild@1\n+          displayName: 'Get version from Nerdbank.GitVersioning'\n+          inputs:\n+            solution: '$(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj'\n+            msbuildArguments: '/t:OutputVersionInfo /restore'\n+            platform: 'AnyCPU'\n+            configuration: 'Release'\n+\n+        - task: CmdLine@1\n+          displayName: restore build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+        \n+        - task: CmdLine@1\n+          displayName: Run build.cmd\n+          inputs:\n+            filename: '$(comspec)'\n+            arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n+        - task: CmdLine@1\n+          displayName: Print bin contents\n+          inputs:\n+            filename: dir\n+            arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n+          condition: always()\n+\n+        - task: CopyFiles@2\n+          displayName: Collect Symbols\n+          inputs:\n+            Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n+            TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n+            CleanTargetFolder: true\n+\n+        - task: MicroBuildSwixPlugin@4\n+          displayName: Reinstall Swix Plugin (to pick up new build number)\n+          inputs:\n+            dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          enabled: false\n+\n+        - task: PublishSymbols@2\n+          displayName: Index Sources & Publish Symbols to Artifact Services\n+          inputs:\n+            SearchPattern: '**/*.pdb'\n+            SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n+            SymbolServerType: 'TeamServices'\n+\n+        - task: PowerShell@1\n+          displayName: Microbuild health checks\n+          inputs:\n+            scriptName: 'build/MicrobuildTest.ps1'\n+          enabled: false\n+          continueOnError: true\n+\n+        - task: MicroBuildCleanup@1\n+          displayName: Execute cleanup tasks\n+\n+      - job: embedSBOM\n+        displayName: Embed SBOM\n+        dependsOn: buildjob\n+        pool:\n+          name: VSEngSS-MicroBuild2017-1ES\n+        steps:\n+        - task: DownloadPipelineArtifact@2\n+          inputs:\n+            artifactName: 'vsix_pre_sbom'\n+            targetPath: '$(System.ArtifactsDirectory)/vsix'\n+\n+        - task: PowerShell@2\n+          displayName: 'Debug - List downloaded files'\n+          inputs:\n+            targetType: 'inline'\n+            script: |\n+              Write-Host \"Files in $(System.ArtifactsDirectory)/vsix:\"\n+              Get-ChildItem -Path \"$(System.ArtifactsDirectory)/vsix\" -Recurse | Select-Object FullName\n+\n+        - task: PowerShell@2\n+          displayName: 'link sbom to Microsoft.Build.vsman in vsix folder'\n+          inputs:\n+            targetType: 'inline'",
              "author": {
                "login": "rainersigwald"
              }
            },
            {
              "body": "@JanProvaznik ",
              "createdAt": "2025-04-09T14:26:00Z",
              "path": ".vsts-dotnet.yml",
              "diffHunk": "@@ -1,135 +1,267 @@\n-queue:\n-  name: VSEng-MicroBuildVS2017\n-  timeoutInMinutes: 360\n-trigger: none\n variables:\n-  BuildConfiguration: 'Release'\n-  TeamName: MSBuild\n-steps:\n-- task: ms-vseng.MicroBuildTasks.30666190-6959-11e5-9f96-f56098202fef.MicroBuildSigningPlugin@1\n-  displayName: Install Signing Plugin\n-  inputs:\n-    signType: '$(SignType)'\n-\n-- task: ms-vseng.MicroBuildTasks.a9799c06-320f-4175-8756-31cd731bd5f3.MicroBuildIBCMergePlugin@0\n-  displayName: Install IBCMerge Plugin\n-\n-- task: CmdLine@1\n-  displayName: save build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Bogus build to have nerdbank.GitVersioning set the version for the swix plugin\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & msbuild /restore $(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj\"'\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Install Swix Plugin\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-\n-- task: CmdLine@1\n-  displayName: restore build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Run build.cmd\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n-\n-- task: CmdLine@1\n-  displayName: Print bin contents\n-  inputs:\n-    filename: dir\n-    arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n-  condition: always()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: logs'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\log'\n-    ArtifactName: logs\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: packages'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\packages'\n-    ArtifactName: packages\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: vsix'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-    ArtifactName: vsix\n-  condition: succeededOrFailed()\n-\n-- task: CopyFiles@2\n-  displayName: Collect Symbols\n-  inputs:\n-    Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n-    TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n-    CleanTargetFolder: true\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: symbols'\n-  inputs:\n-    PathtoPublish: '$(Build.ArtifactStagingDirectory)/symbols'\n-    ArtifactName: symbols\n-  condition: succeededOrFailed()\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Reinstall Swix Plugin (to pick up new build number)\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-  enabled: false\n-\n-- task: ms-vseng.MicroBuildTasks.4305a8de-ba66-4d8b-b2d1-0dc4ecbbf5e8.MicroBuildUploadVstsDropFolder@1\n-  displayName: Upload VSTS Drop\n-  inputs:\n-    DropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-\n-- task: PublishSymbols@1\n-  displayName: Index Sources\n-  inputs:\n-    SearchPattern: '**/*.pdb'\n-    SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n-\n-- task: ms-vscs-artifact.build-tasks.artifactSymbolTask-1.artifactSymbolTask@0\n-  displayName: Publish Symbols to Artifact Services\n-  inputs:\n-    symbolServiceURI: 'https://microsoft.artifacts.visualstudio.com/DefaultCollection'\n-    sourcePath: '$(Build.ArtifactStagingDirectory)\\symbols'\n-    usePat: false\n-\n-- task: PowerShell@1\n-  displayName: Microbuild health checks\n-  inputs:\n-    scriptName: 'build/MicrobuildTest.ps1'\n-  enabled: false\n-  continueOnError: true\n-\n-- task: ms-vseng.MicroBuildTasks.521a94ea-9e68-468a-8167-6dcf361ea776.MicroBuildCleanup@1\n-  displayName: Execute cleanup tasks\n+- name: BuildConfiguration\n+  value: 'Release'\n+- name: TeamName\n+  value: MSBuild\n \n+resources:\n+  repositories:\n+  - repository: MicroBuildTemplate\n+    type: git\n+    name: 1ESPipelineTemplates/MicroBuildTemplate\n+    ref: refs/tags/release\n+\n+extends:\n+  template: azure-pipelines/MicroBuild.1ES.Official.yml@MicroBuildTemplate\n+  parameters:\n+    pool:\n+      name: VSEngSS-MicroBuild2017-1ES\n+    stages:\n+    - stage: stage\n+      jobs:\n+      - job: buildjob \n+        templateContext:\n+          mb:\n+            signing:\n+              enabled: true\n+              signType: $(SignType)\n+            sbom:\n+              enabled: true\n+          outputs:\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: logs'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\log'\n+            artifactName: logs\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: packages'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\packages'\n+            artifactName: packages\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: vsix_pre_sbom'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+            artifactName: vsix_pre_sbom\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: symbols'\n+            targetPath: '$(Build.ArtifactStagingDirectory)/symbols'\n+            artifactName: symbols\n+            condition: succeededOrFailed()\n+          # - output: microBuildVstsDrop\n+          #   displayName: 'Upload VSTS Drop'\n+          #   dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          #   dropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+          #   dropRetentionDays: 90\n+          #   accessToken: '$(System.AccessToken)'\n+          #   dropServiceUri: 'https://devdiv.artifacts.visualstudio.com'\n+          #   vsDropServiceUri: 'https://vsdrop.corp.microsoft.com/file/v1'\n+        steps:        \n+        - task: MicroBuildIBCMergePlugin@1\n+          displayName: Install IBCMerge Plugin\n+\n+        - task: CmdLine@1\n+          displayName: save build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+\n+        - task: MSBuild@1\n+          displayName: 'Get version from Nerdbank.GitVersioning'\n+          inputs:\n+            solution: '$(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj'\n+            msbuildArguments: '/t:OutputVersionInfo /restore'\n+            platform: 'AnyCPU'\n+            configuration: 'Release'\n+\n+        - task: CmdLine@1\n+          displayName: restore build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+        \n+        - task: CmdLine@1\n+          displayName: Run build.cmd\n+          inputs:\n+            filename: '$(comspec)'\n+            arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n+        - task: CmdLine@1\n+          displayName: Print bin contents\n+          inputs:\n+            filename: dir\n+            arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n+          condition: always()\n+\n+        - task: CopyFiles@2\n+          displayName: Collect Symbols\n+          inputs:\n+            Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n+            TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n+            CleanTargetFolder: true\n+\n+        - task: MicroBuildSwixPlugin@4\n+          displayName: Reinstall Swix Plugin (to pick up new build number)\n+          inputs:\n+            dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          enabled: false\n+\n+        - task: PublishSymbols@2\n+          displayName: Index Sources & Publish Symbols to Artifact Services\n+          inputs:\n+            SearchPattern: '**/*.pdb'\n+            SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n+            SymbolServerType: 'TeamServices'\n+\n+        - task: PowerShell@1\n+          displayName: Microbuild health checks\n+          inputs:\n+            scriptName: 'build/MicrobuildTest.ps1'\n+          enabled: false\n+          continueOnError: true\n+\n+        - task: MicroBuildCleanup@1\n+          displayName: Execute cleanup tasks\n+\n+      - job: embedSBOM\n+        displayName: Embed SBOM\n+        dependsOn: buildjob\n+        pool:\n+          name: VSEngSS-MicroBuild2017-1ES\n+        steps:\n+        - task: DownloadPipelineArtifact@2\n+          inputs:\n+            artifactName: 'vsix_pre_sbom'\n+            targetPath: '$(System.ArtifactsDirectory)/vsix'\n+\n+        - task: PowerShell@2\n+          displayName: 'Debug - List downloaded files'\n+          inputs:\n+            targetType: 'inline'\n+            script: |\n+              Write-Host \"Files in $(System.ArtifactsDirectory)/vsix:\"\n+              Get-ChildItem -Path \"$(System.ArtifactsDirectory)/vsix\" -Recurse | Select-Object FullName\n+\n+        - task: PowerShell@2\n+          displayName: 'link sbom to Microsoft.Build.vsman in vsix folder'\n+          inputs:\n+            targetType: 'inline'",
              "author": {
                "login": "YuliiaKovalova"
              }
            },
            {
              "body": "No, handcrafted and tested by me. I agree it is terrifying, but I think it's a working workaround for the unfortunate tooling situation in 15.9.\r\n\r\nThe background:\r\nWe need SBOM for insertion.\r\nIn 17.x SBOM is generated as part of arcade build and then linked to the vsix manifests during build.\r\nHowever in 15.9 a concept of SBOM did not exist so this roslyntools build process can't embed it. We're achieving pipeline compliance through MicroBuild template, this template also creates a SBOM in one of it's steps and it seems valid.\r\n\r\nCircular logic in tooling: There should be a link to the sbom in the manifest created by the build, but the SBOM is created based on the build artifacts after the build.\r\n\r\nUncircularization:\r\n1. build -> creates packages/vsix and manifests (vsman)\r\n2. sbom -> takes the packages/vsix and creates SBOM\r\n3. fix_manifest -> manually stitch SBOM link to the manifest (that's the terrifying stuff in the format I reverse engineered from how manifests look in 17.x branches CRC32, SHA256, size, url)\r\n4. upload\r\n\r\nyou can see the result in the vsix folder https://devdiv.visualstudio.com/DevDiv/_build/results?buildId=11322438&view=artifacts&pathAsName=false&type=publishedArtifacts\r\nand it passes the SBOM check https://devdiv.visualstudio.com/DevDiv/_git/VS/pullrequest/624127\r\n\r\n",
              "createdAt": "2025-04-09T15:02:40Z",
              "path": ".vsts-dotnet.yml",
              "diffHunk": "@@ -1,135 +1,267 @@\n-queue:\n-  name: VSEng-MicroBuildVS2017\n-  timeoutInMinutes: 360\n-trigger: none\n variables:\n-  BuildConfiguration: 'Release'\n-  TeamName: MSBuild\n-steps:\n-- task: ms-vseng.MicroBuildTasks.30666190-6959-11e5-9f96-f56098202fef.MicroBuildSigningPlugin@1\n-  displayName: Install Signing Plugin\n-  inputs:\n-    signType: '$(SignType)'\n-\n-- task: ms-vseng.MicroBuildTasks.a9799c06-320f-4175-8756-31cd731bd5f3.MicroBuildIBCMergePlugin@0\n-  displayName: Install IBCMerge Plugin\n-\n-- task: CmdLine@1\n-  displayName: save build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Bogus build to have nerdbank.GitVersioning set the version for the swix plugin\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & msbuild /restore $(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj\"'\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Install Swix Plugin\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-\n-- task: CmdLine@1\n-  displayName: restore build number\n-  inputs:\n-    filename: echo\n-    arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Print Vars\n-  inputs:\n-    filename: set\n-  condition: always()\n-\n-- task: CmdLine@1\n-  displayName: Run build.cmd\n-  inputs:\n-    filename: '$(comspec)'\n-    arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n-\n-- task: CmdLine@1\n-  displayName: Print bin contents\n-  inputs:\n-    filename: dir\n-    arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n-  condition: always()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: logs'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\log'\n-    ArtifactName: logs\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: packages'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\packages'\n-    ArtifactName: packages\n-  condition: succeededOrFailed()\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: vsix'\n-  inputs:\n-    PathtoPublish: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-    ArtifactName: vsix\n-  condition: succeededOrFailed()\n-\n-- task: CopyFiles@2\n-  displayName: Collect Symbols\n-  inputs:\n-    Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n-    TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n-    CleanTargetFolder: true\n-\n-- task: PublishBuildArtifacts@1\n-  displayName: 'Publish Artifact: symbols'\n-  inputs:\n-    PathtoPublish: '$(Build.ArtifactStagingDirectory)/symbols'\n-    ArtifactName: symbols\n-  condition: succeededOrFailed()\n-\n-- task: ms-vseng.MicroBuildTasks.32f78468-e895-4f47-962c-58a699361df8.MicroBuildSwixPlugin@1\n-  displayName: Reinstall Swix Plugin (to pick up new build number)\n-  inputs:\n-    dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n-  enabled: false\n-\n-- task: ms-vseng.MicroBuildTasks.4305a8de-ba66-4d8b-b2d1-0dc4ecbbf5e8.MicroBuildUploadVstsDropFolder@1\n-  displayName: Upload VSTS Drop\n-  inputs:\n-    DropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n-\n-- task: PublishSymbols@1\n-  displayName: Index Sources\n-  inputs:\n-    SearchPattern: '**/*.pdb'\n-    SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n-\n-- task: ms-vscs-artifact.build-tasks.artifactSymbolTask-1.artifactSymbolTask@0\n-  displayName: Publish Symbols to Artifact Services\n-  inputs:\n-    symbolServiceURI: 'https://microsoft.artifacts.visualstudio.com/DefaultCollection'\n-    sourcePath: '$(Build.ArtifactStagingDirectory)\\symbols'\n-    usePat: false\n-\n-- task: PowerShell@1\n-  displayName: Microbuild health checks\n-  inputs:\n-    scriptName: 'build/MicrobuildTest.ps1'\n-  enabled: false\n-  continueOnError: true\n-\n-- task: ms-vseng.MicroBuildTasks.521a94ea-9e68-468a-8167-6dcf361ea776.MicroBuildCleanup@1\n-  displayName: Execute cleanup tasks\n+- name: BuildConfiguration\n+  value: 'Release'\n+- name: TeamName\n+  value: MSBuild\n \n+resources:\n+  repositories:\n+  - repository: MicroBuildTemplate\n+    type: git\n+    name: 1ESPipelineTemplates/MicroBuildTemplate\n+    ref: refs/tags/release\n+\n+extends:\n+  template: azure-pipelines/MicroBuild.1ES.Official.yml@MicroBuildTemplate\n+  parameters:\n+    pool:\n+      name: VSEngSS-MicroBuild2017-1ES\n+    stages:\n+    - stage: stage\n+      jobs:\n+      - job: buildjob \n+        templateContext:\n+          mb:\n+            signing:\n+              enabled: true\n+              signType: $(SignType)\n+            sbom:\n+              enabled: true\n+          outputs:\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: logs'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\log'\n+            artifactName: logs\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: packages'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\packages'\n+            artifactName: packages\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: vsix_pre_sbom'\n+            targetPath: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+            artifactName: vsix_pre_sbom\n+            condition: succeededOrFailed()\n+          - output: pipelineArtifact\n+            displayName: 'Publish Artifact: symbols'\n+            targetPath: '$(Build.ArtifactStagingDirectory)/symbols'\n+            artifactName: symbols\n+            condition: succeededOrFailed()\n+          # - output: microBuildVstsDrop\n+          #   displayName: 'Upload VSTS Drop'\n+          #   dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          #   dropFolder: 'artifacts\\$(BuildConfiguration)\\VSSetup\\Insertion'\n+          #   dropRetentionDays: 90\n+          #   accessToken: '$(System.AccessToken)'\n+          #   dropServiceUri: 'https://devdiv.artifacts.visualstudio.com'\n+          #   vsDropServiceUri: 'https://vsdrop.corp.microsoft.com/file/v1'\n+        steps:        \n+        - task: MicroBuildIBCMergePlugin@1\n+          displayName: Install IBCMerge Plugin\n+\n+        - task: CmdLine@1\n+          displayName: save build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[task.setvariable variable=BUILD_BUILDNUMBER_SAVED]%BUILD_BUILDNUMBER%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+\n+        - task: MSBuild@1\n+          displayName: 'Get version from Nerdbank.GitVersioning'\n+          inputs:\n+            solution: '$(Build.Repository.LocalPath)\\build\\SetMicrobuildVersion\\SetMicrobuildVersion.csproj'\n+            msbuildArguments: '/t:OutputVersionInfo /restore'\n+            platform: 'AnyCPU'\n+            configuration: 'Release'\n+\n+        - task: CmdLine@1\n+          displayName: restore build number\n+          inputs:\n+            filename: echo\n+            arguments: '##vso[build.updatebuildnumber]%BUILD_BUILDNUMBER_SAVED%'\n+          condition: always()\n+\n+        - task: CmdLine@1\n+          displayName: Print Vars\n+          inputs:\n+            filename: set\n+          condition: always()\n+        \n+        - task: CmdLine@1\n+          displayName: Run build.cmd\n+          inputs:\n+            filename: '$(comspec)'\n+            arguments: '/c \"call \"C:\\Program Files (x86)\\Microsoft Visual Studio\\2017\\Enterprise\\Common7\\Tools\\VsDevCmd.bat\" & $(Build.Repository.LocalPath)\\build.cmd -pack -sign -configuration Release -properties /p:SignType=$(SignType)\"'\n+        - task: CmdLine@1\n+          displayName: Print bin contents\n+          inputs:\n+            filename: dir\n+            arguments: '/s /b artifacts\\>artifacts\\$(BuildConfiguration)\\log\\BinFileListing.log'\n+          condition: always()\n+\n+        - task: CopyFiles@2\n+          displayName: Collect Symbols\n+          inputs:\n+            Contents: 'artifacts\\$(BuildConfiguration)\\bin\\**\\*.pdb'\n+            TargetFolder: '$(Build.ArtifactStagingDirectory)/symbols'\n+            CleanTargetFolder: true\n+\n+        - task: MicroBuildSwixPlugin@4\n+          displayName: Reinstall Swix Plugin (to pick up new build number)\n+          inputs:\n+            dropName: 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)/$(Build.BuildId)'\n+          enabled: false\n+\n+        - task: PublishSymbols@2\n+          displayName: Index Sources & Publish Symbols to Artifact Services\n+          inputs:\n+            SearchPattern: '**/*.pdb'\n+            SymbolsFolder: '$(Build.ArtifactStagingDirectory)\\symbols'\n+            SymbolServerType: 'TeamServices'\n+\n+        - task: PowerShell@1\n+          displayName: Microbuild health checks\n+          inputs:\n+            scriptName: 'build/MicrobuildTest.ps1'\n+          enabled: false\n+          continueOnError: true\n+\n+        - task: MicroBuildCleanup@1\n+          displayName: Execute cleanup tasks\n+\n+      - job: embedSBOM\n+        displayName: Embed SBOM\n+        dependsOn: buildjob\n+        pool:\n+          name: VSEngSS-MicroBuild2017-1ES\n+        steps:\n+        - task: DownloadPipelineArtifact@2\n+          inputs:\n+            artifactName: 'vsix_pre_sbom'\n+            targetPath: '$(System.ArtifactsDirectory)/vsix'\n+\n+        - task: PowerShell@2\n+          displayName: 'Debug - List downloaded files'\n+          inputs:\n+            targetType: 'inline'\n+            script: |\n+              Write-Host \"Files in $(System.ArtifactsDirectory)/vsix:\"\n+              Get-ChildItem -Path \"$(System.ArtifactsDirectory)/vsix\" -Recurse | Select-Object FullName\n+\n+        - task: PowerShell@2\n+          displayName: 'link sbom to Microsoft.Build.vsman in vsix folder'\n+          inputs:\n+            targetType: 'inline'",
              "author": {
                "login": "JanProvaznik"
              }
            }
          ]
        }
      }
    ]
  }
}